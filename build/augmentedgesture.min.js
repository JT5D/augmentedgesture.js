AugmentedGesture=function(){AugmentedGesture.hasUserMedia||alert("Panic: no UserMedia");console.assert(AugmentedGesture.hasUserMedia,"no usermedia available");this._video=this._videoCtor();this._frameCount=0;var a=document.createElement("canvas");this._canvas=a;a.width=this._video.width/4;a.height=this._video.height/4;this._pointerR={x:a.width/2,y:a.height/2};this._pointerL={x:a.width/2,y:a.height/2}};AugmentedGesture.prototype.destroy=function(){this.stop()};
AugmentedGesture.hasUserMedia=navigator.webkitGetUserMedia?!0:!1;
AugmentedGesture.MicroeventMixin=function(a){a.bind=function(a,c){void 0===this._events&&(this._events={});this._events[a]=this._events[a]||[];this._events[a].push(c);return c};a.unbind=function(a,c){void 0===this._events&&(this._events={});!1!==a in this._events&&this._events[a].splice(this._events[a].indexOf(c),1)};a.trigger=function(a){void 0===this._events&&(this._events={});if(void 0!==this._events[a])for(var c=this._events[a].slice(),b=0;b<c.length;b++)c[b].apply(this,Array.prototype.slice.call(arguments,
1))}};AugmentedGesture.MicroeventMixin(AugmentedGesture.prototype);AugmentedGesture.prototype.start=function(){var a=function(){this._reqAnimId=requestAnimationFrame(a);this._update()}.bind(this);a();return this};AugmentedGesture.prototype.stop=function(){cancelAnimationFrame(this._reqAnimId);return this};
AugmentedGesture.prototype.domElementFullpage=function(){var a=this.domElement();document.body.appendChild(a);a.style.position="absolute";a.style.top="0px";a.style.left="0px";a.style.width="100%";a.style.height="100%";return this};AugmentedGesture.prototype.domElementThumbnail=function(){var a=this.domElement();document.body.appendChild(a);a.style.position="absolute";a.style.top="0px";a.style.left="0px";a.style.width="320px";a.style.height="240px";return this};
AugmentedGesture.prototype.domElementRemove=function(){var a=this.domElement();a.parentNode&&a.parentNode.removeChild(a);return this};AugmentedGesture.prototype.domElement=function(){return this._canvas};AugmentedGesture.prototype.pointerR=function(){return this._pointerR};AugmentedGesture.prototype.pointerL=function(){return this._pointerL};
AugmentedGesture.prototype._videoCtor=function(){var a=document.createElement("video");a.width=320;a.height=240;a.autoplay=!0;navigator.webkitGetUserMedia("video",function(e){a.src=webkitURL.createObjectURL(e)},function(){alert("you got no WebRTC webcam")});return a};
AugmentedGesture.prototype._update=function(){var a=this._canvas,e=a.getContext("2d");this._frameCount++;if(0===this._frameCount%guiOpts.general.video.frameRate&&this._video.readyState===this._video.HAVE_ENOUGH_DATA){a.width!=guiOpts.general.video.w&&(a.width=guiOpts.general.video.w);a.height!=guiOpts.general.video.h&&(a.height=guiOpts.general.video.h);e.drawImage(this._video,0,0,a.width,a.height);a=e.getImageData(0,0,a.width,a.height);ImgProc.fliph(a);var c=ImgProc.duplicate(a,e);ImgProc.threshold(c,
guiOpts.right.colorFilter.r,guiOpts.right.colorFilter.g,guiOpts.right.colorFilter.b);guiOpts.right.disp.enable&&(a=c);var b=ImgProc.computeVerticalHistogram(c,function(a,b){return a[b+1]!==0?true:false});ImgProc.windowedAverageHistogram(b,guiOpts.right.smooth.vWidth);var d=ImgProc.getMaxHistogram(b);guiOpts.right.disp.VHist&&ImgProc.displayVerticalHistogram(a,b);b=ImgProc.computeHorizontalHistogram(c,function(a,b){return a[b+1]!==0?true:false});ImgProc.windowedAverageHistogram(b,guiOpts.right.smooth.hWidth);
var g=ImgProc.getMaxHistogram(b);guiOpts.right.disp.HHist&&ImgProc.displayHorizontalHistogram(a,b);var f=ImgProc.duplicate(a,e);ImgProc.threshold(f,guiOpts.left.colorFilter.r,guiOpts.left.colorFilter.g,guiOpts.left.colorFilter.b);guiOpts.left.disp.enable&&(a=f);b=ImgProc.computeVerticalHistogram(f,function(a,b){return a[b+1]!==0?true:false});ImgProc.windowedAverageHistogram(b,guiOpts.left.smooth.vWidth);c=ImgProc.getMaxHistogram(b);guiOpts.left.disp.VHist&&ImgProc.displayVerticalHistogram(a,b);b=
ImgProc.computeHorizontalHistogram(f,function(a,b){return a[b+1]!==0?true:false});ImgProc.windowedAverageHistogram(b,guiOpts.left.smooth.hWidth);f=ImgProc.getMaxHistogram(b);guiOpts.left.disp.HHist&&ImgProc.displayHorizontalHistogram(a,b);guiOpts.right.disp.VLine&&ImgProc.vline(a,d.idx,0,0,255);guiOpts.right.disp.HLine&&ImgProc.hline(a,g.idx,0,0,255);guiOpts.left.disp.VLine&&ImgProc.vline(a,c.idx,0,255,0);guiOpts.left.disp.HLine&&ImgProc.hline(a,f.idx,0,255,0);b=this._pointerR;b.x+=(d.idx-b.x)*guiOpts.right.pointer.coordSmoothV;
b.y+=(g.idx-b.y)*guiOpts.right.pointer.coordSmoothH;guiOpts.right.pointer.display&&(ImgProc.vline(a,Math.floor(b.x),255,0,255),ImgProc.hline(a,Math.floor(b.y),255,0,255));d=this._pointerL;d.x+=(c.idx-d.x)*guiOpts.left.pointer.coordSmoothV;d.y+=(f.idx-d.y)*guiOpts.left.pointer.coordSmoothH;guiOpts.left.pointer.display&&(ImgProc.vline(a,Math.floor(d.x),255,0,0),ImgProc.hline(a,Math.floor(d.y),255,0,0));e.putImageData(a,0,0);this.trigger("update",b,d)}};
AugmentedGesture=function(){AugmentedGesture.hasUserMedia||alert("Panic: no UserMedia");console.assert(AugmentedGesture.hasUserMedia,"no usermedia available");this._video=this._videoCtor();this._frameCount=0;var a=document.createElement("canvas");this._canvas=a;a.width=this._video.width/4;a.height=this._video.height/4;this._pointerR={x:a.width/2,y:a.height/2};this._pointerL={x:a.width/2,y:a.height/2}};AugmentedGesture.prototype.destroy=function(){this.stop()};
AugmentedGesture.hasUserMedia=navigator.webkitGetUserMedia?!0:!1;
AugmentedGesture.MicroeventMixin=function(a){a.bind=function(a,d){void 0===this._events&&(this._events={});this._events[a]=this._events[a]||[];this._events[a].push(d);return d};a.unbind=function(a,d){void 0===this._events&&(this._events={});!1!==a in this._events&&this._events[a].splice(this._events[a].indexOf(d),1)};a.trigger=function(a){void 0===this._events&&(this._events={});if(void 0!==this._events[a])for(var d=this._events[a].slice(),c=0;c<d.length;c++)d[c].apply(this,Array.prototype.slice.call(arguments,
1))}};AugmentedGesture.MicroeventMixin(AugmentedGesture.prototype);AugmentedGesture.prototype.start=function(){var a=function(){this._reqAnimId=requestAnimationFrame(a);this._update()}.bind(this);a();return this};AugmentedGesture.prototype.stop=function(){cancelAnimationFrame(this._reqAnimId);return this};
AugmentedGesture.prototype.domElementFullpage=function(){var a=this.domElement();document.body.appendChild(a);a.style.position="absolute";a.style.top="0px";a.style.left="0px";a.style.width="100%";a.style.height="100%";return this};AugmentedGesture.prototype.domElementThumbnail=function(){var a=this.domElement();document.body.appendChild(a);a.style.position="absolute";a.style.top="0px";a.style.left="0px";a.style.width="320px";a.style.height="240px";return this};
AugmentedGesture.prototype.domElementRemove=function(){var a=this.domElement();a.parentNode&&a.parentNode.removeChild(a);return this};AugmentedGesture.prototype.domElement=function(){return this._canvas};AugmentedGesture.prototype.pointerR=function(){return this._pointerR};AugmentedGesture.prototype.pointerL=function(){return this._pointerL};
AugmentedGesture.prototype._videoCtor=function(){var a=document.createElement("video");a.width=320;a.height=240;a.autoplay=!0;navigator.webkitGetUserMedia("video",function(b){a.src=webkitURL.createObjectURL(b)},function(){alert("you got no WebRTC webcam")});return a};
AugmentedGesture.prototype._update=function(){var a=this._canvas,b=a.getContext("2d");this._frameCount++;if(0===this._frameCount%guiOpts.general.video.frameRate&&this._video.readyState===this._video.HAVE_ENOUGH_DATA){a.width!=guiOpts.general.video.w&&(a.width=guiOpts.general.video.w);a.height!=guiOpts.general.video.h&&(a.height=guiOpts.general.video.h);b.drawImage(this._video,0,0,a.width,a.height);a=b.getImageData(0,0,a.width,a.height);ImgProc.fliph(a);var d=ImgProc.duplicate(a,b);ImgProc.threshold(d,
guiOpts.right.colorFilter.r,guiOpts.right.colorFilter.g,guiOpts.right.colorFilter.b);guiOpts.right.disp.enable&&(a=d);var c=ImgProc.computeVerticalHistogram(d,function(a,b){return a[b+1]!==0?true:false});ImgProc.windowedAverageHistogram(c,guiOpts.right.smooth.vWidth);var e=ImgProc.getMaxHistogram(c);guiOpts.right.disp.VHist&&ImgProc.displayVerticalHistogram(a,c);c=ImgProc.computeHorizontalHistogram(d,function(a,b){return a[b+1]!==0?true:false});ImgProc.windowedAverageHistogram(c,guiOpts.right.smooth.hWidth);
var g=ImgProc.getMaxHistogram(c);guiOpts.right.disp.HHist&&ImgProc.displayHorizontalHistogram(a,c);var f=ImgProc.duplicate(a,b);ImgProc.threshold(f,guiOpts.left.colorFilter.r,guiOpts.left.colorFilter.g,guiOpts.left.colorFilter.b);guiOpts.left.disp.enable&&(a=f);c=ImgProc.computeVerticalHistogram(f,function(a,b){return a[b+1]!==0?true:false});ImgProc.windowedAverageHistogram(c,guiOpts.left.smooth.vWidth);d=ImgProc.getMaxHistogram(c);guiOpts.left.disp.VHist&&ImgProc.displayVerticalHistogram(a,c);c=
ImgProc.computeHorizontalHistogram(f,function(a,b){return a[b+1]!==0?true:false});ImgProc.windowedAverageHistogram(c,guiOpts.left.smooth.hWidth);f=ImgProc.getMaxHistogram(c);guiOpts.left.disp.HHist&&ImgProc.displayHorizontalHistogram(a,c);guiOpts.right.disp.VLine&&ImgProc.vline(a,e.idx,0,0,255);guiOpts.right.disp.HLine&&ImgProc.hline(a,g.idx,0,0,255);guiOpts.left.disp.VLine&&ImgProc.vline(a,d.idx,0,255,0);guiOpts.left.disp.HLine&&ImgProc.hline(a,f.idx,0,255,0);c=this._pointerR;c.x+=(e.idx-c.x)*guiOpts.right.pointer.coordSmoothV;
c.y+=(g.idx-c.y)*guiOpts.right.pointer.coordSmoothH;guiOpts.right.pointer.display&&(ImgProc.vline(a,Math.floor(c.x),255,0,255),ImgProc.hline(a,Math.floor(c.y),255,0,255));e=this._pointerL;e.x+=(d.idx-e.x)*guiOpts.left.pointer.coordSmoothV;e.y+=(f.idx-e.y)*guiOpts.left.pointer.coordSmoothH;guiOpts.left.pointer.display&&(ImgProc.vline(a,Math.floor(e.x),255,0,0),ImgProc.hline(a,Math.floor(e.y),255,0,0));b.putImageData(a,0,0);this.trigger("update",c,e)}};
AugmentedGesture.GestureRecognition=function(){this._lastEvent=null};AugmentedGesture.GestureRecognition.prototype.update=function(a,b,d){b=d/3;d=null;d=a<1*b?"left":a<2*b?"middle":"right";d===this._lastEvent?d=null:this._lastEvent=d;return d};
var DatGuiOpts=function(){this.general={video:{w:80,h:60,frameRate:1}};this.right={pointer:{display:!0,coordSmoothV:0.3,coordSmoothH:0.3},disp:{enable:!1,VHist:!1,HHist:!1,VLine:!1,HLine:!1},colorFilter:{r:{min:125,max:255},g:{min:3,max:140},b:{min:10,max:90}},smooth:{vWidth:9,hWidth:9}};this.left={pointer:{display:!0,coordSmoothV:0.3,coordSmoothH:0.3},disp:{enable:!1,VHist:!1,HHist:!1,VLine:!1,HLine:!1},colorFilter:{r:{min:0,max:80},g:{min:70,max:255},b:{min:0,max:113}},smooth:{vWidth:9,hWidth:9}}},
guiOpts=new DatGuiOpts;
window.addEventListener("load",function(){var a=new dat.GUI,b=a.addFolder("General");b.add(guiOpts.general.video,"w",0,320).step(40).name("videoW");b.add(guiOpts.general.video,"h",0,240).step(30).name("videoH");b.add(guiOpts.general.video,"frameRate",1,30).step(1);b=a.addFolder("Right Pointer");b.add(guiOpts.right.pointer,"display");b.add(guiOpts.right.pointer,"coordSmoothV",0,1);b.add(guiOpts.right.pointer,"coordSmoothH",0,1);b=a.addFolder("Right Display");b.add(guiOpts.right.disp,"enable");b.add(guiOpts.right.disp,
"HHist");b.add(guiOpts.right.disp,"VHist");b.add(guiOpts.right.disp,"HLine");b.add(guiOpts.right.disp,"VLine");b=a.addFolder("Right Threshold");b.add(guiOpts.right.colorFilter.r,"min",0,255).name("red min");b.add(guiOpts.right.colorFilter.r,"max",0,255).name("red max");b.add(guiOpts.right.colorFilter.g,"min",0,255).name("green min");b.add(guiOpts.right.colorFilter.g,"max",0,255).name("green max");b.add(guiOpts.right.colorFilter.b,"min",0,255).name("blue min");b.add(guiOpts.right.colorFilter.b,"max",
0,255).name("blue max");b.add(guiOpts.right.smooth,"hWidth",0,20).step(1);b.add(guiOpts.right.smooth,"vWidth",0,20).step(1);b=a.addFolder("Left Pointer");b.add(guiOpts.left.pointer,"display");b.add(guiOpts.left.pointer,"coordSmoothV",0,1);b.add(guiOpts.left.pointer,"coordSmoothH",0,1);b=a.addFolder("Left Display");b.add(guiOpts.left.disp,"enable");b.add(guiOpts.left.disp,"VHist");b.add(guiOpts.left.disp,"HHist");b.add(guiOpts.left.disp,"VLine");b.add(guiOpts.left.disp,"HLine");b=a.addFolder("Left Threshold");
b.add(guiOpts.left.colorFilter.r,"min",0,255).name("red min");b.add(guiOpts.left.colorFilter.r,"max",0,255).name("red max");b.add(guiOpts.left.colorFilter.g,"min",0,255).name("green min");b.add(guiOpts.left.colorFilter.g,"max",0,255).name("green max");b.add(guiOpts.left.colorFilter.b,"min",0,255).name("blue min");b.add(guiOpts.left.colorFilter.b,"max",0,255).name("blue max");b.add(guiOpts.left.smooth,"vWidth",0,20).step(1);b.add(guiOpts.left.smooth,"hWidth",0,20).step(1)});
AugmentedGesture=function(){AugmentedGesture.hasUserMedia||alert("Panic: no UserMedia");console.assert(AugmentedGesture.hasUserMedia,"no usermedia available");this._video=this._videoCtor();this._frameCount=0;var a=document.createElement("canvas");this._canvas=a;a.width=this._video.width/4;a.height=this._video.height/4;this._pointerR={x:a.width/2,y:a.height/2};this._pointerL={x:a.width/2,y:a.height/2}};AugmentedGesture.prototype.destroy=function(){this.stop()};
AugmentedGesture.hasUserMedia=navigator.webkitGetUserMedia?!0:!1;
AugmentedGesture.MicroeventMixin=function(a){a.bind=function(a,d){void 0===this._events&&(this._events={});this._events[a]=this._events[a]||[];this._events[a].push(d);return d};a.unbind=function(a,d){void 0===this._events&&(this._events={});!1!==a in this._events&&this._events[a].splice(this._events[a].indexOf(d),1)};a.trigger=function(a){void 0===this._events&&(this._events={});if(void 0!==this._events[a])for(var d=this._events[a].slice(),c=0;c<d.length;c++)d[c].apply(this,Array.prototype.slice.call(arguments,
1))}};AugmentedGesture.MicroeventMixin(AugmentedGesture.prototype);AugmentedGesture.prototype.start=function(){var a=function(){this._reqAnimId=requestAnimationFrame(a);this._update()}.bind(this);a();return this};AugmentedGesture.prototype.stop=function(){cancelAnimationFrame(this._reqAnimId);return this};
AugmentedGesture.prototype.domElementFullpage=function(){var a=this.domElement();document.body.appendChild(a);a.style.position="absolute";a.style.top="0px";a.style.left="0px";a.style.width="100%";a.style.height="100%";return this};AugmentedGesture.prototype.domElementThumbnail=function(){var a=this.domElement();document.body.appendChild(a);a.style.position="absolute";a.style.top="0px";a.style.left="0px";a.style.width="320px";a.style.height="240px";return this};
AugmentedGesture.prototype.domElementRemove=function(){var a=this.domElement();a.parentNode&&a.parentNode.removeChild(a);return this};AugmentedGesture.prototype.domElement=function(){return this._canvas};AugmentedGesture.prototype.pointerR=function(){return this._pointerR};AugmentedGesture.prototype.pointerL=function(){return this._pointerL};
AugmentedGesture.prototype._videoCtor=function(){var a=document.createElement("video");a.width=320;a.height=240;a.autoplay=!0;navigator.webkitGetUserMedia("video",function(b){a.src=webkitURL.createObjectURL(b)},function(){alert("you got no WebRTC webcam")});return a};
AugmentedGesture.prototype._update=function(){var a=this._canvas,b=a.getContext("2d");this._frameCount++;if(0===this._frameCount%guiOpts.general.video.frameRate&&this._video.readyState===this._video.HAVE_ENOUGH_DATA){a.width!=guiOpts.general.video.w&&(a.width=guiOpts.general.video.w);a.height!=guiOpts.general.video.h&&(a.height=guiOpts.general.video.h);b.drawImage(this._video,0,0,a.width,a.height);a=b.getImageData(0,0,a.width,a.height);ImgProc.fliph(a);var d=ImgProc.duplicate(a,b);ImgProc.threshold(d,
guiOpts.right.colorFilter.r,guiOpts.right.colorFilter.g,guiOpts.right.colorFilter.b);guiOpts.right.disp.enable&&(a=d);var c=ImgProc.computeVerticalHistogram(d,function(a,b){return a[b+1]!==0?true:false});ImgProc.windowedAverageHistogram(c,guiOpts.right.smooth.vWidth);var e=ImgProc.getMaxHistogram(c);guiOpts.right.disp.VHist&&ImgProc.displayVerticalHistogram(a,c);c=ImgProc.computeHorizontalHistogram(d,function(a,b){return a[b+1]!==0?true:false});ImgProc.windowedAverageHistogram(c,guiOpts.right.smooth.hWidth);
var g=ImgProc.getMaxHistogram(c);guiOpts.right.disp.HHist&&ImgProc.displayHorizontalHistogram(a,c);var f=ImgProc.duplicate(a,b);ImgProc.threshold(f,guiOpts.left.colorFilter.r,guiOpts.left.colorFilter.g,guiOpts.left.colorFilter.b);guiOpts.left.disp.enable&&(a=f);c=ImgProc.computeVerticalHistogram(f,function(a,b){return a[b+1]!==0?true:false});ImgProc.windowedAverageHistogram(c,guiOpts.left.smooth.vWidth);d=ImgProc.getMaxHistogram(c);guiOpts.left.disp.VHist&&ImgProc.displayVerticalHistogram(a,c);c=
ImgProc.computeHorizontalHistogram(f,function(a,b){return a[b+1]!==0?true:false});ImgProc.windowedAverageHistogram(c,guiOpts.left.smooth.hWidth);f=ImgProc.getMaxHistogram(c);guiOpts.left.disp.HHist&&ImgProc.displayHorizontalHistogram(a,c);guiOpts.right.disp.VLine&&ImgProc.vline(a,e.idx,0,0,255);guiOpts.right.disp.HLine&&ImgProc.hline(a,g.idx,0,0,255);guiOpts.left.disp.VLine&&ImgProc.vline(a,d.idx,0,255,0);guiOpts.left.disp.HLine&&ImgProc.hline(a,f.idx,0,255,0);c=this._pointerR;c.x+=(e.idx-c.x)*guiOpts.right.pointer.coordSmoothV;
c.y+=(g.idx-c.y)*guiOpts.right.pointer.coordSmoothH;guiOpts.right.pointer.display&&(ImgProc.vline(a,Math.floor(c.x),255,0,255),ImgProc.hline(a,Math.floor(c.y),255,0,255));e=this._pointerL;e.x+=(d.idx-e.x)*guiOpts.left.pointer.coordSmoothV;e.y+=(f.idx-e.y)*guiOpts.left.pointer.coordSmoothH;guiOpts.left.pointer.display&&(ImgProc.vline(a,Math.floor(e.x),255,0,0),ImgProc.hline(a,Math.floor(e.y),255,0,0));b.putImageData(a,0,0);this.trigger("update",c,e)}};
AugmentedGesture.GestureRecognition=function(){this._lastEvent=null};AugmentedGesture.GestureRecognition.prototype.update=function(a,b,d){b=d/3;d=null;d=a<1*b?"left":a<2*b?"middle":"right";d===this._lastEvent?d=null:this._lastEvent=d;return d};
var DatGuiOpts=function(){this.general={video:{w:80,h:60,frameRate:1}};this.right={pointer:{display:!0,coordSmoothV:0.3,coordSmoothH:0.3},disp:{enable:!1,VHist:!1,HHist:!1,VLine:!1,HLine:!1},colorFilter:{r:{min:125,max:255},g:{min:3,max:140},b:{min:10,max:90}},smooth:{vWidth:9,hWidth:9}};this.left={pointer:{display:!0,coordSmoothV:0.3,coordSmoothH:0.3},disp:{enable:!1,VHist:!1,HHist:!1,VLine:!1,HLine:!1},colorFilter:{r:{min:0,max:80},g:{min:70,max:255},b:{min:0,max:113}},smooth:{vWidth:9,hWidth:9}}},
guiOpts=new DatGuiOpts;
window.addEventListener("load",function(){var a=new dat.GUI,b=a.addFolder("General");b.add(guiOpts.general.video,"w",0,320).step(40).name("videoW");b.add(guiOpts.general.video,"h",0,240).step(30).name("videoH");b.add(guiOpts.general.video,"frameRate",1,30).step(1);b=a.addFolder("Right Pointer");b.add(guiOpts.right.pointer,"display");b.add(guiOpts.right.pointer,"coordSmoothV",0,1);b.add(guiOpts.right.pointer,"coordSmoothH",0,1);b=a.addFolder("Right Display");b.add(guiOpts.right.disp,"enable");b.add(guiOpts.right.disp,
"HHist");b.add(guiOpts.right.disp,"VHist");b.add(guiOpts.right.disp,"HLine");b.add(guiOpts.right.disp,"VLine");b=a.addFolder("Right Threshold");b.add(guiOpts.right.colorFilter.r,"min",0,255).name("red min");b.add(guiOpts.right.colorFilter.r,"max",0,255).name("red max");b.add(guiOpts.right.colorFilter.g,"min",0,255).name("green min");b.add(guiOpts.right.colorFilter.g,"max",0,255).name("green max");b.add(guiOpts.right.colorFilter.b,"min",0,255).name("blue min");b.add(guiOpts.right.colorFilter.b,"max",
0,255).name("blue max");b.add(guiOpts.right.smooth,"hWidth",0,20).step(1);b.add(guiOpts.right.smooth,"vWidth",0,20).step(1);b=a.addFolder("Left Pointer");b.add(guiOpts.left.pointer,"display");b.add(guiOpts.left.pointer,"coordSmoothV",0,1);b.add(guiOpts.left.pointer,"coordSmoothH",0,1);b=a.addFolder("Left Display");b.add(guiOpts.left.disp,"enable");b.add(guiOpts.left.disp,"VHist");b.add(guiOpts.left.disp,"HHist");b.add(guiOpts.left.disp,"VLine");b.add(guiOpts.left.disp,"HLine");b=a.addFolder("Left Threshold");
b.add(guiOpts.left.colorFilter.r,"min",0,255).name("red min");b.add(guiOpts.left.colorFilter.r,"max",0,255).name("red max");b.add(guiOpts.left.colorFilter.g,"min",0,255).name("green min");b.add(guiOpts.left.colorFilter.g,"max",0,255).name("green max");b.add(guiOpts.left.colorFilter.b,"min",0,255).name("blue min");b.add(guiOpts.left.colorFilter.b,"max",0,255).name("blue max");b.add(guiOpts.left.smooth,"vWidth",0,20).step(1);b.add(guiOpts.left.smooth,"hWidth",0,20).step(1)});
AugmentedGesture=function(){AugmentedGesture.hasUserMedia||alert("Panic: no UserMedia");console.assert(AugmentedGesture.hasUserMedia,"no usermedia available");this._video=this._videoCtor();this._frameCount=0;var a=document.createElement("canvas");this._canvas=a;a.width=this._video.width/4;a.height=this._video.height/4;this._pointerR={x:a.width/2,y:a.height/2};this._pointerL={x:a.width/2,y:a.height/2}};AugmentedGesture.prototype.destroy=function(){this.stop()};
AugmentedGesture.hasUserMedia=navigator.webkitGetUserMedia?!0:!1;
AugmentedGesture.MicroeventMixin=function(a){a.bind=function(a,d){void 0===this._events&&(this._events={});this._events[a]=this._events[a]||[];this._events[a].push(d);return d};a.unbind=function(a,d){void 0===this._events&&(this._events={});!1!==a in this._events&&this._events[a].splice(this._events[a].indexOf(d),1)};a.trigger=function(a){void 0===this._events&&(this._events={});if(void 0!==this._events[a])for(var d=this._events[a].slice(),c=0;c<d.length;c++)d[c].apply(this,Array.prototype.slice.call(arguments,
1))}};AugmentedGesture.MicroeventMixin(AugmentedGesture.prototype);AugmentedGesture.prototype.start=function(){var a=function(){this._reqAnimId=requestAnimationFrame(a);this._update()}.bind(this);a();return this};AugmentedGesture.prototype.stop=function(){cancelAnimationFrame(this._reqAnimId);return this};
AugmentedGesture.prototype.domElementFullpage=function(){var a=this.domElement();document.body.appendChild(a);a.style.position="absolute";a.style.top="0px";a.style.left="0px";a.style.width="100%";a.style.height="100%";return this};AugmentedGesture.prototype.domElementThumbnail=function(){var a=this.domElement();document.body.appendChild(a);a.style.position="absolute";a.style.top="0px";a.style.left="0px";a.style.width="320px";a.style.height="240px";return this};
AugmentedGesture.prototype.domElementRemove=function(){var a=this.domElement();a.parentNode&&a.parentNode.removeChild(a);return this};AugmentedGesture.prototype.domElement=function(){return this._canvas};AugmentedGesture.prototype.pointerR=function(){return this._pointerR};AugmentedGesture.prototype.pointerL=function(){return this._pointerL};
AugmentedGesture.prototype._videoCtor=function(){var a=document.createElement("video");a.width=320;a.height=240;a.autoplay=!0;navigator.webkitGetUserMedia("video",function(b){a.src=webkitURL.createObjectURL(b)},function(){alert("you got no WebRTC webcam")});return a};
AugmentedGesture.prototype._update=function(){var a=this._canvas,b=a.getContext("2d");this._frameCount++;if(0===this._frameCount%guiOpts.general.video.frameRate&&this._video.readyState===this._video.HAVE_ENOUGH_DATA){a.width!=guiOpts.general.video.w&&(a.width=guiOpts.general.video.w);a.height!=guiOpts.general.video.h&&(a.height=guiOpts.general.video.h);b.drawImage(this._video,0,0,a.width,a.height);a=b.getImageData(0,0,a.width,a.height);ImgProc.fliph(a);var d=ImgProc.duplicate(a,b);ImgProc.threshold(d,
guiOpts.right.colorFilter.r,guiOpts.right.colorFilter.g,guiOpts.right.colorFilter.b);guiOpts.right.disp.enable&&(a=d);var c=ImgProc.computeVerticalHistogram(d,function(a,b){return a[b+1]!==0?true:false});ImgProc.windowedAverageHistogram(c,guiOpts.right.smooth.vWidth);var e=ImgProc.getMaxHistogram(c);guiOpts.right.disp.VHist&&ImgProc.displayVerticalHistogram(a,c);c=ImgProc.computeHorizontalHistogram(d,function(a,b){return a[b+1]!==0?true:false});ImgProc.windowedAverageHistogram(c,guiOpts.right.smooth.hWidth);
var g=ImgProc.getMaxHistogram(c);guiOpts.right.disp.HHist&&ImgProc.displayHorizontalHistogram(a,c);var f=ImgProc.duplicate(a,b);ImgProc.threshold(f,guiOpts.left.colorFilter.r,guiOpts.left.colorFilter.g,guiOpts.left.colorFilter.b);guiOpts.left.disp.enable&&(a=f);c=ImgProc.computeVerticalHistogram(f,function(a,b){return a[b+1]!==0?true:false});ImgProc.windowedAverageHistogram(c,guiOpts.left.smooth.vWidth);d=ImgProc.getMaxHistogram(c);guiOpts.left.disp.VHist&&ImgProc.displayVerticalHistogram(a,c);c=
ImgProc.computeHorizontalHistogram(f,function(a,b){return a[b+1]!==0?true:false});ImgProc.windowedAverageHistogram(c,guiOpts.left.smooth.hWidth);f=ImgProc.getMaxHistogram(c);guiOpts.left.disp.HHist&&ImgProc.displayHorizontalHistogram(a,c);guiOpts.right.disp.VLine&&ImgProc.vline(a,e.idx,0,0,255);guiOpts.right.disp.HLine&&ImgProc.hline(a,g.idx,0,0,255);guiOpts.left.disp.VLine&&ImgProc.vline(a,d.idx,0,255,0);guiOpts.left.disp.HLine&&ImgProc.hline(a,f.idx,0,255,0);c=this._pointerR;c.x+=(e.idx-c.x)*guiOpts.right.pointer.coordSmoothV;
c.y+=(g.idx-c.y)*guiOpts.right.pointer.coordSmoothH;guiOpts.right.pointer.display&&(ImgProc.vline(a,Math.floor(c.x),255,0,255),ImgProc.hline(a,Math.floor(c.y),255,0,255));e=this._pointerL;e.x+=(d.idx-e.x)*guiOpts.left.pointer.coordSmoothV;e.y+=(f.idx-e.y)*guiOpts.left.pointer.coordSmoothH;guiOpts.left.pointer.display&&(ImgProc.vline(a,Math.floor(e.x),255,0,0),ImgProc.hline(a,Math.floor(e.y),255,0,0));b.putImageData(a,0,0);this.trigger("update",c,e)}};
AugmentedGesture.GestureRecognition=function(){this._lastEvent=null};AugmentedGesture.GestureRecognition.prototype.update=function(a,b,d){b=d/3;d=null;d=a<1*b?"left":a<2*b?"middle":"right";d===this._lastEvent?d=null:this._lastEvent=d;return d};
var DatGuiOpts=function(){this.general={video:{w:80,h:60,frameRate:1}};this.right={pointer:{display:!0,coordSmoothV:0.3,coordSmoothH:0.3},disp:{enable:!1,VHist:!1,HHist:!1,VLine:!1,HLine:!1},colorFilter:{r:{min:125,max:255},g:{min:3,max:140},b:{min:10,max:90}},smooth:{vWidth:9,hWidth:9}};this.left={pointer:{display:!0,coordSmoothV:0.3,coordSmoothH:0.3},disp:{enable:!1,VHist:!1,HHist:!1,VLine:!1,HLine:!1},colorFilter:{r:{min:0,max:80},g:{min:70,max:255},b:{min:0,max:113}},smooth:{vWidth:9,hWidth:9}}},
guiOpts=new DatGuiOpts;
window.addEventListener("load",function(){var a=new dat.GUI,b=a.addFolder("General");b.add(guiOpts.general.video,"w",0,320).step(40).name("videoW");b.add(guiOpts.general.video,"h",0,240).step(30).name("videoH");b.add(guiOpts.general.video,"frameRate",1,30).step(1);b=a.addFolder("Right Pointer");b.add(guiOpts.right.pointer,"display");b.add(guiOpts.right.pointer,"coordSmoothV",0,1);b.add(guiOpts.right.pointer,"coordSmoothH",0,1);b=a.addFolder("Right Display");b.add(guiOpts.right.disp,"enable");b.add(guiOpts.right.disp,
"HHist");b.add(guiOpts.right.disp,"VHist");b.add(guiOpts.right.disp,"HLine");b.add(guiOpts.right.disp,"VLine");b=a.addFolder("Right Threshold");b.add(guiOpts.right.colorFilter.r,"min",0,255).name("red min");b.add(guiOpts.right.colorFilter.r,"max",0,255).name("red max");b.add(guiOpts.right.colorFilter.g,"min",0,255).name("green min");b.add(guiOpts.right.colorFilter.g,"max",0,255).name("green max");b.add(guiOpts.right.colorFilter.b,"min",0,255).name("blue min");b.add(guiOpts.right.colorFilter.b,"max",
0,255).name("blue max");b.add(guiOpts.right.smooth,"hWidth",0,20).step(1);b.add(guiOpts.right.smooth,"vWidth",0,20).step(1);b=a.addFolder("Left Pointer");b.add(guiOpts.left.pointer,"display");b.add(guiOpts.left.pointer,"coordSmoothV",0,1);b.add(guiOpts.left.pointer,"coordSmoothH",0,1);b=a.addFolder("Left Display");b.add(guiOpts.left.disp,"enable");b.add(guiOpts.left.disp,"VHist");b.add(guiOpts.left.disp,"HHist");b.add(guiOpts.left.disp,"VLine");b.add(guiOpts.left.disp,"HLine");b=a.addFolder("Left Threshold");
b.add(guiOpts.left.colorFilter.r,"min",0,255).name("red min");b.add(guiOpts.left.colorFilter.r,"max",0,255).name("red max");b.add(guiOpts.left.colorFilter.g,"min",0,255).name("green min");b.add(guiOpts.left.colorFilter.g,"max",0,255).name("green max");b.add(guiOpts.left.colorFilter.b,"min",0,255).name("blue min");b.add(guiOpts.left.colorFilter.b,"max",0,255).name("blue max");b.add(guiOpts.left.smooth,"vWidth",0,20).step(1);b.add(guiOpts.left.smooth,"hWidth",0,20).step(1)});
AugmentedGesture=function(a){this._opts=a||new AugmentedGesture.Options;AugmentedGesture.hasUserMedia||alert("Panic: no UserMedia");console.assert(AugmentedGesture.hasUserMedia,"no usermedia available");this._video=this._videoCtor();this._frameCount=0;this._canvas=a=document.createElement("canvas");a.width=this._video.width/4;a.height=this._video.height/4;this._pointerR={x:a.width/2,y:a.height/2};this._pointerL={x:a.width/2,y:a.height/2}};AugmentedGesture.prototype.destroy=function(){this.stop()};
AugmentedGesture.hasUserMedia=navigator.webkitGetUserMedia?!0:!1;
AugmentedGesture.MicroeventMixin=function(a){a.bind=function(a,b){void 0===this._events&&(this._events={});this._events[a]=this._events[a]||[];this._events[a].push(b);return b};a.unbind=function(a,b){void 0===this._events&&(this._events={});!1!==a in this._events&&this._events[a].splice(this._events[a].indexOf(b),1)};a.trigger=function(a){void 0===this._events&&(this._events={});if(void 0!==this._events[a])for(var b=this._events[a].slice(),f=0;f<b.length;f++)b[f].apply(this,Array.prototype.slice.call(arguments,
1))}};AugmentedGesture.MicroeventMixin(AugmentedGesture.prototype);AugmentedGesture.prototype.start=function(){var a=function(){this._reqAnimId=requestAnimationFrame(a);this._update()}.bind(this);a();return this};AugmentedGesture.prototype.stop=function(){cancelAnimationFrame(this._reqAnimId);return this};
AugmentedGesture.prototype.domElementFullpage=function(){var a=this.domElement();document.body.appendChild(a);a.style.position="absolute";a.style.top="0px";a.style.left="0px";a.style.width="100%";a.style.height="100%";return this};AugmentedGesture.prototype.domElementThumbnail=function(){var a=this.domElement();document.body.appendChild(a);a.style.position="absolute";a.style.top="0px";a.style.left="0px";a.style.width="320px";a.style.height="240px";return this};
AugmentedGesture.prototype.domElementRemove=function(){var a=this.domElement();a.parentNode&&a.parentNode.removeChild(a);return this};
AugmentedGesture.Options=function(){this.general={video:{w:80,h:60,frameRate:1}};this.right={pointer:{display:!0,coordSmoothV:0.3,coordSmoothH:0.3},disp:{enable:!1,VHist:!1,HHist:!1,VLine:!1,HLine:!1},colorFilter:{r:{min:125,max:255},g:{min:3,max:140},b:{min:10,max:90}},smooth:{vWidth:9,hWidth:9}};this.left={pointer:{display:!0,coordSmoothV:0.3,coordSmoothH:0.3},disp:{enable:!1,VHist:!1,HHist:!1,VLine:!1,HLine:!1},colorFilter:{r:{min:0,max:80},g:{min:70,max:255},b:{min:0,max:113}},smooth:{vWidth:9,
hWidth:9}}};
AugmentedGesture.prototype.enableDatGui=function(){var a=this._opts;window.addEventListener("load",function(){var c=new dat.GUI,b=c.addFolder("General");b.add(a.general.video,"w",0,320).step(40).name("videoW");b.add(a.general.video,"h",0,240).step(30).name("videoH");b.add(a.general.video,"frameRate",1,30).step(1);b=c.addFolder("Right Pointer");b.add(a.right.pointer,"display");b.add(a.right.pointer,"coordSmoothV",0,1);b.add(a.right.pointer,"coordSmoothH",0,1);b=c.addFolder("Right Display");b.add(a.right.disp,
"enable");b.add(a.right.disp,"HHist");b.add(a.right.disp,"VHist");b.add(a.right.disp,"HLine");b.add(a.right.disp,"VLine");b=c.addFolder("Right Threshold");b.add(a.right.colorFilter.r,"min",0,255).name("red min");b.add(a.right.colorFilter.r,"max",0,255).name("red max");b.add(a.right.colorFilter.g,"min",0,255).name("green min");b.add(a.right.colorFilter.g,"max",0,255).name("green max");b.add(a.right.colorFilter.b,"min",0,255).name("blue min");b.add(a.right.colorFilter.b,"max",0,255).name("blue max");
b.add(a.right.smooth,"hWidth",0,20).step(1);b.add(a.right.smooth,"vWidth",0,20).step(1);b=c.addFolder("Left Pointer");b.add(a.left.pointer,"display");b.add(a.left.pointer,"coordSmoothV",0,1);b.add(a.left.pointer,"coordSmoothH",0,1);b=c.addFolder("Left Display");b.add(a.left.disp,"enable");b.add(a.left.disp,"VHist");b.add(a.left.disp,"HHist");b.add(a.left.disp,"VLine");b.add(a.left.disp,"HLine");b=c.addFolder("Left Threshold");b.add(a.left.colorFilter.r,"min",0,255).name("red min");b.add(a.left.colorFilter.r,
"max",0,255).name("red max");b.add(a.left.colorFilter.g,"min",0,255).name("green min");b.add(a.left.colorFilter.g,"max",0,255).name("green max");b.add(a.left.colorFilter.b,"min",0,255).name("blue min");b.add(a.left.colorFilter.b,"max",0,255).name("blue max");b.add(a.left.smooth,"vWidth",0,20).step(1);b.add(a.left.smooth,"hWidth",0,20).step(1)});return this};AugmentedGesture.prototype.domElement=function(){return this._canvas};AugmentedGesture.prototype.pointerR=function(){return this._pointerR};
AugmentedGesture.prototype.pointerL=function(){return this._pointerL};AugmentedGesture.prototype._videoCtor=function(){var a=document.createElement("video");a.width=320;a.height=240;a.autoplay=!0;navigator.webkitGetUserMedia("video",function(c){a.src=webkitURL.createObjectURL(c)},function(){alert("you got no WebRTC webcam")});return a};
AugmentedGesture.prototype._update=function(){var a=this._opts,c=this._canvas,b=c.getContext("2d");this._frameCount++;if(0===this._frameCount%a.general.video.frameRate&&this._video.readyState===this._video.HAVE_ENOUGH_DATA){c.width!=a.general.video.w&&(c.width=a.general.video.w);c.height!=a.general.video.h&&(c.height=a.general.video.h);b.drawImage(this._video,0,0,c.width,c.height);c=b.getImageData(0,0,c.width,c.height);ImgProc.fliph(c);var f=ImgProc.duplicate(c,b);ImgProc.threshold(f,a.right.colorFilter.r,
a.right.colorFilter.g,a.right.colorFilter.b);a.right.disp.enable&&(c=f);var d=ImgProc.computeVerticalHistogram(f,function(a,b){return a[b+1]!==0?true:false});ImgProc.windowedAverageHistogram(d,a.right.smooth.vWidth);var e=ImgProc.getMaxHistogram(d);a.right.disp.VHist&&ImgProc.displayVerticalHistogram(c,d);d=ImgProc.computeHorizontalHistogram(f,function(a,b){return a[b+1]!==0?true:false});ImgProc.windowedAverageHistogram(d,a.right.smooth.hWidth);var h=ImgProc.getMaxHistogram(d);a.right.disp.HHist&&
ImgProc.displayHorizontalHistogram(c,d);var g=ImgProc.duplicate(c,b);ImgProc.threshold(g,a.left.colorFilter.r,a.left.colorFilter.g,a.left.colorFilter.b);a.left.disp.enable&&(c=g);d=ImgProc.computeVerticalHistogram(g,function(a,b){return a[b+1]!==0?true:false});ImgProc.windowedAverageHistogram(d,a.left.smooth.vWidth);f=ImgProc.getMaxHistogram(d);a.left.disp.VHist&&ImgProc.displayVerticalHistogram(c,d);d=ImgProc.computeHorizontalHistogram(g,function(a,b){return a[b+1]!==0?true:false});ImgProc.windowedAverageHistogram(d,
a.left.smooth.hWidth);g=ImgProc.getMaxHistogram(d);a.left.disp.HHist&&ImgProc.displayHorizontalHistogram(c,d);a.right.disp.VLine&&ImgProc.vline(c,e.idx,0,0,255);a.right.disp.HLine&&ImgProc.hline(c,h.idx,0,0,255);a.left.disp.VLine&&ImgProc.vline(c,f.idx,0,255,0);a.left.disp.HLine&&ImgProc.hline(c,g.idx,0,255,0);d=this._pointerR;d.x+=(e.idx-d.x)*a.right.pointer.coordSmoothV;d.y+=(h.idx-d.y)*a.right.pointer.coordSmoothH;a.right.pointer.display&&(ImgProc.vline(c,Math.floor(d.x),255,0,255),ImgProc.hline(c,
Math.floor(d.y),255,0,255));e=this._pointerL;e.x+=(f.idx-e.x)*a.left.pointer.coordSmoothV;e.y+=(g.idx-e.y)*a.left.pointer.coordSmoothH;a.left.pointer.display&&(ImgProc.vline(c,Math.floor(e.x),255,0,0),ImgProc.hline(c,Math.floor(e.y),255,0,0));b.putImageData(c,0,0);this.trigger("update",d,e)}};AugmentedGesture.GestureRecognition=function(){this._lastEvent=null};
AugmentedGesture.GestureRecognition.prototype.update=function(a,c,b){c=b/3;b=null;b=a<1*c?"left":a<2*c?"middle":"right";b===this._lastEvent?b=null:this._lastEvent=b;return b};
AugmentedGesture=function(a){this._opts=a||new AugmentedGesture.Options;AugmentedGesture.hasUserMedia||alert("Panic: no UserMedia");console.assert(AugmentedGesture.hasUserMedia,"no usermedia available");this._video=this._videoCtor();this._frameCount=0;this._canvas=a=document.createElement("canvas");a.width=this._video.width/4;a.height=this._video.height/4;this._pointersPos={}};AugmentedGesture.prototype.destroy=function(){this.stop();this.domElementRemove();this.statsRemove();this.disableDatGui()};
AugmentedGesture.hasUserMedia=navigator.webkitGetUserMedia?!0:!1;
AugmentedGesture.MicroeventMixin=function(a){a.bind=function(a,b){void 0===this._events&&(this._events={});this._events[a]=this._events[a]||[];this._events[a].push(b);return b};a.unbind=function(a,b){void 0===this._events&&(this._events={});!1!==a in this._events&&this._events[a].splice(this._events[a].indexOf(b),1)};a.trigger=function(a){void 0===this._events&&(this._events={});if(void 0!==this._events[a])for(var b=this._events[a].slice(),i=0;i<b.length;i++)b[i].apply(this,Array.prototype.slice.call(arguments,
1))}};AugmentedGesture.MicroeventMixin(AugmentedGesture.prototype);AugmentedGesture.prototype.start=function(){var a=function(){this._reqAnimId=requestAnimationFrame(a);this._update()}.bind(this);a();return this};AugmentedGesture.prototype.stop=function(){cancelAnimationFrame(this._reqAnimId);return this};AugmentedGesture.prototype.opts=function(){return this._opts};
AugmentedGesture.prototype.domElementFullpage=function(){var a=this.domElement();document.body.appendChild(a);a.style.position="absolute";a.style.top="0px";a.style.left="0px";a.style.width="100%";a.style.height="100%";return this};AugmentedGesture.prototype.domElementThumbnail=function(){var a=this.domElement();document.body.appendChild(a);a.style.position="absolute";a.style.top="0px";a.style.left="0px";a.style.width="320px";a.style.height="240px";return this};
AugmentedGesture.prototype.domElementRemove=function(){var a=this.domElement();a.parentNode&&a.parentNode.removeChild(a);return this};AugmentedGesture.prototype.statsInsert=function(){var a=this._stats=new Stats;a.getDomElement().style.position="absolute";a.getDomElement().style.left="0px";a.getDomElement().style.top="0px";document.body.appendChild(a.getDomElement());return this};
AugmentedGesture.prototype.statsRemove=function(){if(!this._stats)return this;var a=this._stats.getDomElement();a.parentNode&&a.parentNode.removeChild(a);this._stats=null;return this};AugmentedGesture.prototype._statsUpdate=function(){this._stats&&this._stats.update()};
AugmentedGesture.prototype.addPointer=function(a,c){console.assert(!this._pointersPos[a]);this._pointersPos[a]={x:this._canvas.width/2,y:this._canvas.height/2};console.assert(!this._opts.pointers[a]);this._opts.pointers[a]=c;this._datgui&&this._addDatGuiPointer(a)};AugmentedGesture.Options=function(){this.general={video:{w:80,h:60,frameRate:1}};this.pointers={}};
AugmentedGesture.OptionPointer=function(){this.pointer={display:!0,coordSmoothV:0.3,coordSmoothH:0.3,crossColor:{r:0,g:255,b:255}};this.disp={enable:!1,VHist:!1,HHist:!1,VLine:!1,HLine:!1};this.colorFilter={r:{min:0,max:255},g:{min:0,max:255},b:{min:0,max:255},minHist:{h:5,v:5}};this.smooth={vWidth:9,hWidth:9}};
AugmentedGesture.prototype.enableDatGui=function(){var a=this._opts;window.addEventListener("load",function(){var c=(this._datgui=new dat.GUI).addFolder("General");c.add(a.general.video,"w",0,320).step(40).name("videoW");c.add(a.general.video,"h",0,240).step(30).name("videoH");c.add(a.general.video,"frameRate",1,30).step(1);Object.keys(this._pointersPos).forEach(function(a){this._addDatGuiPointer(a)}.bind(this))}.bind(this));return this};
AugmentedGesture.prototype.disableDatGui=function(){this._datgui&&this._datgui.destroy()};
AugmentedGesture.prototype._addDatGuiPointer=function(a){console.assert(this._datgui);var c=this._opts.pointers[a],a=this._datgui.addFolder("Pointer: "+a),b=a.addFolder("Main");b.add(c.pointer,"display");b.add(c.pointer,"coordSmoothV",0,1);b.add(c.pointer,"coordSmoothH",0,1);b.add(c.pointer.crossColor,"r",0,255).name("Cross ColorR");b.add(c.pointer.crossColor,"g",0,255).name("Cross ColorG");b.add(c.pointer.crossColor,"b",0,255).name("Cross ColorB");b=a.addFolder("Display");b.add(c.disp,"enable");
b.add(c.disp,"HHist");b.add(c.disp,"VHist");b.add(c.disp,"HLine");b.add(c.disp,"VLine");b=a.addFolder("Threshold");b.open();b.add(c.colorFilter.r,"min",0,255).name("red min");b.add(c.colorFilter.r,"max",0,255).name("red max");b.add(c.colorFilter.g,"min",0,255).name("green min");b.add(c.colorFilter.g,"max",0,255).name("green max");b.add(c.colorFilter.b,"min",0,255).name("blue min");b.add(c.colorFilter.b,"max",0,255).name("blue max");b.add(c.colorFilter.minHist,"h",0,20).name("minHistH");b.add(c.colorFilter.minHist,
"v",0,20).name("minHistV");b.add(c.smooth,"hWidth",0,20).step(1);b.add(c.smooth,"vWidth",0,20).step(1)};AugmentedGesture.prototype.domElement=function(){return this._canvas};AugmentedGesture.prototype.pointers=function(){return this._pointersPos};
AugmentedGesture.prototype._videoCtor=function(){var a=document.createElement("video");a.width=320;a.height=240;a.autoplay=!0;navigator.webkitGetUserMedia({video:!0},function(c){a.src=webkitURL.createObjectURL(c)},function(){alert("you got no WebRTC webcam")});return a};
AugmentedGesture.prototype._update=function(){function a(a,b){var e=ImgProc.duplicate(a,i),d=c.pointers[b];ImgProc.threshold(e,d.colorFilter.r,d.colorFilter.g,d.colorFilter.b);d.disp.enable&&ImgProc.copy(e,a);var g=ImgProc.computeHorizontalHistogram(e,function(a,b){return 0!==a[b+1]?!0:!1});ImgProc.windowedAverageHistogram(g,d.smooth.hWidth);var h=d.colorFilter.minHist.h;ImgProc.filterHistogram(g,function(a,b,c){c[b]=c[b]>=h?c[b]:0});var j=ImgProc.getMaxHistogram(g);d.disp.VHist&&ImgProc.displayHorizontalHistogram(a,
g);g=ImgProc.computeVerticalHistogram(e,function(a,b){return 0!==a[b+1]?!0:!1});ImgProc.windowedAverageHistogram(g,d.smooth.vWidth);h=d.colorFilter.minHist.v;ImgProc.filterHistogram(g,function(a,b,c){c[b]=c[b]>=h?c[b]:0});e=ImgProc.getMaxHistogram(g);d.disp.HHist&&ImgProc.displayVerticalHistogram(a,g);return{h:j,v:e}}var c=this._opts,b=this._canvas,i=b.getContext("2d");this._frameCount++;if(0===this._frameCount%c.general.video.frameRate&&this._video.readyState===this._video.HAVE_ENOUGH_DATA){this._statsUpdate();
b.width!=c.general.video.w&&(b.width=c.general.video.w);b.height!=c.general.video.h&&(b.height=c.general.video.h);var j=b.width,k=b.height;i.drawImage(this._video,0,0,b.width,b.height);var h=i.getImageData(0,0,b.width,b.height);ImgProc.fliph(h);var l=function(b){var f=c.pointers[b],e=a(h,b);f.disp.HLine&&ImgProc.hline(h,e.h.idx,0,255,0);f.disp.VLine&&ImgProc.vline(h,e.v.idx,0,255,0);if(e.h.max===0||e.v.max===0){if(this._pointersPos[b]!==null){this._pointersPos[b]=null;this.trigger("mouseup."+b)}}else{if(!this._pointersPos[b]){this._pointersPos[b]=
{x:e.h.idx/j,y:e.v.idx/k};this.trigger("mousedown."+b,this._pointersPos[b]);this.trigger("click."+b,this._pointersPos[b])}var d=this._pointersPos[b],g=d.x,i=d.y;d.x=d.x+(e.h.idx/j-d.x)*f.pointer.coordSmoothH;d.y=d.y+(e.v.idx/k-d.y)*f.pointer.coordSmoothV;if(f.pointer.display){f=f.pointer.crossColor;ImgProc.vline(h,Math.floor(d.x*j),f.r,f.g,f.b);ImgProc.hline(h,Math.floor(d.y*k),f.r,f.g,f.b)}(g!==d.x||i!==d.y)&&this.trigger("mousemove."+b,d)}}.bind(this);Object.keys(this._pointersPos).forEach(function(a){l(a)});
i.putImageData(h,0,0)}};
