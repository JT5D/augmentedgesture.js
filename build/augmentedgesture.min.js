AugmentedGesture=function(){AugmentedGesture.hasUserMedia||alert("Panic: no UserMedia");console.assert(AugmentedGesture.hasUserMedia,"no usermedia available");this._video=this._videoCtor();this._frameCount=0;var a=document.createElement("canvas");this._canvas=a;a.width=this._video.width/4;a.height=this._video.height/4;this._pointerR={x:a.width/2,y:a.height/2};this._pointerL={x:a.width/2,y:a.height/2}};AugmentedGesture.prototype.destroy=function(){this.stop()};
AugmentedGesture.hasUserMedia=navigator.webkitGetUserMedia?!0:!1;
AugmentedGesture.MicroeventMixin=function(a){a.bind=function(a,c){void 0===this._events&&(this._events={});this._events[a]=this._events[a]||[];this._events[a].push(c);return c};a.unbind=function(a,c){void 0===this._events&&(this._events={});!1!==a in this._events&&this._events[a].splice(this._events[a].indexOf(c),1)};a.trigger=function(a){void 0===this._events&&(this._events={});if(void 0!==this._events[a])for(var c=this._events[a].slice(),b=0;b<c.length;b++)c[b].apply(this,Array.prototype.slice.call(arguments,
1))}};AugmentedGesture.MicroeventMixin(AugmentedGesture.prototype);AugmentedGesture.prototype.start=function(){var a=function(){this._reqAnimId=requestAnimationFrame(a);this._update()}.bind(this);a();return this};AugmentedGesture.prototype.stop=function(){cancelAnimationFrame(this._reqAnimId);return this};
AugmentedGesture.prototype.domElementFullpage=function(){var a=this.domElement();document.body.appendChild(a);a.style.position="absolute";a.style.top="0px";a.style.left="0px";a.style.width="100%";a.style.height="100%";return this};AugmentedGesture.prototype.domElementThumbnail=function(){var a=this.domElement();document.body.appendChild(a);a.style.position="absolute";a.style.top="0px";a.style.left="0px";a.style.width="320px";a.style.height="240px";return this};
AugmentedGesture.prototype.domElementRemove=function(){var a=this.domElement();a.parentNode&&a.parentNode.removeChild(a);return this};AugmentedGesture.prototype.domElement=function(){return this._canvas};AugmentedGesture.prototype.pointerR=function(){return this._pointerR};AugmentedGesture.prototype.pointerL=function(){return this._pointerL};
AugmentedGesture.prototype._videoCtor=function(){var a=document.createElement("video");a.width=320;a.height=240;a.autoplay=!0;navigator.webkitGetUserMedia("video",function(e){a.src=webkitURL.createObjectURL(e)},function(){alert("you got no WebRTC webcam")});return a};
AugmentedGesture.prototype._update=function(){var a=this._canvas,e=a.getContext("2d");this._frameCount++;if(0===this._frameCount%guiOpts.general.video.frameRate&&this._video.readyState===this._video.HAVE_ENOUGH_DATA){a.width!=guiOpts.general.video.w&&(a.width=guiOpts.general.video.w);a.height!=guiOpts.general.video.h&&(a.height=guiOpts.general.video.h);e.drawImage(this._video,0,0,a.width,a.height);a=e.getImageData(0,0,a.width,a.height);ImgProc.fliph(a);var c=ImgProc.duplicate(a,e);ImgProc.threshold(c,
guiOpts.right.colorFilter.r,guiOpts.right.colorFilter.g,guiOpts.right.colorFilter.b);guiOpts.right.disp.enable&&(a=c);var b=ImgProc.computeVerticalHistogram(c,function(a,b){return a[b+1]!==0?true:false});ImgProc.windowedAverageHistogram(b,guiOpts.right.smooth.vWidth);var d=ImgProc.getMaxHistogram(b);guiOpts.right.disp.VHist&&ImgProc.displayVerticalHistogram(a,b);b=ImgProc.computeHorizontalHistogram(c,function(a,b){return a[b+1]!==0?true:false});ImgProc.windowedAverageHistogram(b,guiOpts.right.smooth.hWidth);
var g=ImgProc.getMaxHistogram(b);guiOpts.right.disp.HHist&&ImgProc.displayHorizontalHistogram(a,b);var f=ImgProc.duplicate(a,e);ImgProc.threshold(f,guiOpts.left.colorFilter.r,guiOpts.left.colorFilter.g,guiOpts.left.colorFilter.b);guiOpts.left.disp.enable&&(a=f);b=ImgProc.computeVerticalHistogram(f,function(a,b){return a[b+1]!==0?true:false});ImgProc.windowedAverageHistogram(b,guiOpts.left.smooth.vWidth);c=ImgProc.getMaxHistogram(b);guiOpts.left.disp.VHist&&ImgProc.displayVerticalHistogram(a,b);b=
ImgProc.computeHorizontalHistogram(f,function(a,b){return a[b+1]!==0?true:false});ImgProc.windowedAverageHistogram(b,guiOpts.left.smooth.hWidth);f=ImgProc.getMaxHistogram(b);guiOpts.left.disp.HHist&&ImgProc.displayHorizontalHistogram(a,b);guiOpts.right.disp.VLine&&ImgProc.vline(a,d.idx,0,0,255);guiOpts.right.disp.HLine&&ImgProc.hline(a,g.idx,0,0,255);guiOpts.left.disp.VLine&&ImgProc.vline(a,c.idx,0,255,0);guiOpts.left.disp.HLine&&ImgProc.hline(a,f.idx,0,255,0);b=this._pointerR;b.x+=(d.idx-b.x)*guiOpts.right.pointer.coordSmoothV;
b.y+=(g.idx-b.y)*guiOpts.right.pointer.coordSmoothH;guiOpts.right.pointer.display&&(ImgProc.vline(a,Math.floor(b.x),255,0,255),ImgProc.hline(a,Math.floor(b.y),255,0,255));d=this._pointerL;d.x+=(c.idx-d.x)*guiOpts.left.pointer.coordSmoothV;d.y+=(f.idx-d.y)*guiOpts.left.pointer.coordSmoothH;guiOpts.left.pointer.display&&(ImgProc.vline(a,Math.floor(d.x),255,0,0),ImgProc.hline(a,Math.floor(d.y),255,0,0));e.putImageData(a,0,0);this.trigger("update",b,d)}};
AugmentedGesture=function(){AugmentedGesture.hasUserMedia||alert("Panic: no UserMedia");console.assert(AugmentedGesture.hasUserMedia,"no usermedia available");this._video=this._videoCtor();this._frameCount=0;var a=document.createElement("canvas");this._canvas=a;a.width=this._video.width/4;a.height=this._video.height/4;this._pointerR={x:a.width/2,y:a.height/2};this._pointerL={x:a.width/2,y:a.height/2}};AugmentedGesture.prototype.destroy=function(){this.stop()};
AugmentedGesture.hasUserMedia=navigator.webkitGetUserMedia?!0:!1;
AugmentedGesture.MicroeventMixin=function(a){a.bind=function(a,d){void 0===this._events&&(this._events={});this._events[a]=this._events[a]||[];this._events[a].push(d);return d};a.unbind=function(a,d){void 0===this._events&&(this._events={});!1!==a in this._events&&this._events[a].splice(this._events[a].indexOf(d),1)};a.trigger=function(a){void 0===this._events&&(this._events={});if(void 0!==this._events[a])for(var d=this._events[a].slice(),c=0;c<d.length;c++)d[c].apply(this,Array.prototype.slice.call(arguments,
1))}};AugmentedGesture.MicroeventMixin(AugmentedGesture.prototype);AugmentedGesture.prototype.start=function(){var a=function(){this._reqAnimId=requestAnimationFrame(a);this._update()}.bind(this);a();return this};AugmentedGesture.prototype.stop=function(){cancelAnimationFrame(this._reqAnimId);return this};
AugmentedGesture.prototype.domElementFullpage=function(){var a=this.domElement();document.body.appendChild(a);a.style.position="absolute";a.style.top="0px";a.style.left="0px";a.style.width="100%";a.style.height="100%";return this};AugmentedGesture.prototype.domElementThumbnail=function(){var a=this.domElement();document.body.appendChild(a);a.style.position="absolute";a.style.top="0px";a.style.left="0px";a.style.width="320px";a.style.height="240px";return this};
AugmentedGesture.prototype.domElementRemove=function(){var a=this.domElement();a.parentNode&&a.parentNode.removeChild(a);return this};AugmentedGesture.prototype.domElement=function(){return this._canvas};AugmentedGesture.prototype.pointerR=function(){return this._pointerR};AugmentedGesture.prototype.pointerL=function(){return this._pointerL};
AugmentedGesture.prototype._videoCtor=function(){var a=document.createElement("video");a.width=320;a.height=240;a.autoplay=!0;navigator.webkitGetUserMedia("video",function(b){a.src=webkitURL.createObjectURL(b)},function(){alert("you got no WebRTC webcam")});return a};
AugmentedGesture.prototype._update=function(){var a=this._canvas,b=a.getContext("2d");this._frameCount++;if(0===this._frameCount%guiOpts.general.video.frameRate&&this._video.readyState===this._video.HAVE_ENOUGH_DATA){a.width!=guiOpts.general.video.w&&(a.width=guiOpts.general.video.w);a.height!=guiOpts.general.video.h&&(a.height=guiOpts.general.video.h);b.drawImage(this._video,0,0,a.width,a.height);a=b.getImageData(0,0,a.width,a.height);ImgProc.fliph(a);var d=ImgProc.duplicate(a,b);ImgProc.threshold(d,
guiOpts.right.colorFilter.r,guiOpts.right.colorFilter.g,guiOpts.right.colorFilter.b);guiOpts.right.disp.enable&&(a=d);var c=ImgProc.computeVerticalHistogram(d,function(a,b){return a[b+1]!==0?true:false});ImgProc.windowedAverageHistogram(c,guiOpts.right.smooth.vWidth);var e=ImgProc.getMaxHistogram(c);guiOpts.right.disp.VHist&&ImgProc.displayVerticalHistogram(a,c);c=ImgProc.computeHorizontalHistogram(d,function(a,b){return a[b+1]!==0?true:false});ImgProc.windowedAverageHistogram(c,guiOpts.right.smooth.hWidth);
var g=ImgProc.getMaxHistogram(c);guiOpts.right.disp.HHist&&ImgProc.displayHorizontalHistogram(a,c);var f=ImgProc.duplicate(a,b);ImgProc.threshold(f,guiOpts.left.colorFilter.r,guiOpts.left.colorFilter.g,guiOpts.left.colorFilter.b);guiOpts.left.disp.enable&&(a=f);c=ImgProc.computeVerticalHistogram(f,function(a,b){return a[b+1]!==0?true:false});ImgProc.windowedAverageHistogram(c,guiOpts.left.smooth.vWidth);d=ImgProc.getMaxHistogram(c);guiOpts.left.disp.VHist&&ImgProc.displayVerticalHistogram(a,c);c=
ImgProc.computeHorizontalHistogram(f,function(a,b){return a[b+1]!==0?true:false});ImgProc.windowedAverageHistogram(c,guiOpts.left.smooth.hWidth);f=ImgProc.getMaxHistogram(c);guiOpts.left.disp.HHist&&ImgProc.displayHorizontalHistogram(a,c);guiOpts.right.disp.VLine&&ImgProc.vline(a,e.idx,0,0,255);guiOpts.right.disp.HLine&&ImgProc.hline(a,g.idx,0,0,255);guiOpts.left.disp.VLine&&ImgProc.vline(a,d.idx,0,255,0);guiOpts.left.disp.HLine&&ImgProc.hline(a,f.idx,0,255,0);c=this._pointerR;c.x+=(e.idx-c.x)*guiOpts.right.pointer.coordSmoothV;
c.y+=(g.idx-c.y)*guiOpts.right.pointer.coordSmoothH;guiOpts.right.pointer.display&&(ImgProc.vline(a,Math.floor(c.x),255,0,255),ImgProc.hline(a,Math.floor(c.y),255,0,255));e=this._pointerL;e.x+=(d.idx-e.x)*guiOpts.left.pointer.coordSmoothV;e.y+=(f.idx-e.y)*guiOpts.left.pointer.coordSmoothH;guiOpts.left.pointer.display&&(ImgProc.vline(a,Math.floor(e.x),255,0,0),ImgProc.hline(a,Math.floor(e.y),255,0,0));b.putImageData(a,0,0);this.trigger("update",c,e)}};
AugmentedGesture.GestureRecognition=function(){this._lastEvent=null};AugmentedGesture.GestureRecognition.prototype.update=function(a,b,d){b=d/3;d=null;d=a<1*b?"left":a<2*b?"middle":"right";d===this._lastEvent?d=null:this._lastEvent=d;return d};
var DatGuiOpts=function(){this.general={video:{w:80,h:60,frameRate:1}};this.right={pointer:{display:!0,coordSmoothV:0.3,coordSmoothH:0.3},disp:{enable:!1,VHist:!1,HHist:!1,VLine:!1,HLine:!1},colorFilter:{r:{min:125,max:255},g:{min:3,max:140},b:{min:10,max:90}},smooth:{vWidth:9,hWidth:9}};this.left={pointer:{display:!0,coordSmoothV:0.3,coordSmoothH:0.3},disp:{enable:!1,VHist:!1,HHist:!1,VLine:!1,HLine:!1},colorFilter:{r:{min:0,max:80},g:{min:70,max:255},b:{min:0,max:113}},smooth:{vWidth:9,hWidth:9}}},
guiOpts=new DatGuiOpts;
window.addEventListener("load",function(){var a=new dat.GUI,b=a.addFolder("General");b.add(guiOpts.general.video,"w",0,320).step(40).name("videoW");b.add(guiOpts.general.video,"h",0,240).step(30).name("videoH");b.add(guiOpts.general.video,"frameRate",1,30).step(1);b=a.addFolder("Right Pointer");b.add(guiOpts.right.pointer,"display");b.add(guiOpts.right.pointer,"coordSmoothV",0,1);b.add(guiOpts.right.pointer,"coordSmoothH",0,1);b=a.addFolder("Right Display");b.add(guiOpts.right.disp,"enable");b.add(guiOpts.right.disp,
"HHist");b.add(guiOpts.right.disp,"VHist");b.add(guiOpts.right.disp,"HLine");b.add(guiOpts.right.disp,"VLine");b=a.addFolder("Right Threshold");b.add(guiOpts.right.colorFilter.r,"min",0,255).name("red min");b.add(guiOpts.right.colorFilter.r,"max",0,255).name("red max");b.add(guiOpts.right.colorFilter.g,"min",0,255).name("green min");b.add(guiOpts.right.colorFilter.g,"max",0,255).name("green max");b.add(guiOpts.right.colorFilter.b,"min",0,255).name("blue min");b.add(guiOpts.right.colorFilter.b,"max",
0,255).name("blue max");b.add(guiOpts.right.smooth,"hWidth",0,20).step(1);b.add(guiOpts.right.smooth,"vWidth",0,20).step(1);b=a.addFolder("Left Pointer");b.add(guiOpts.left.pointer,"display");b.add(guiOpts.left.pointer,"coordSmoothV",0,1);b.add(guiOpts.left.pointer,"coordSmoothH",0,1);b=a.addFolder("Left Display");b.add(guiOpts.left.disp,"enable");b.add(guiOpts.left.disp,"VHist");b.add(guiOpts.left.disp,"HHist");b.add(guiOpts.left.disp,"VLine");b.add(guiOpts.left.disp,"HLine");b=a.addFolder("Left Threshold");
b.add(guiOpts.left.colorFilter.r,"min",0,255).name("red min");b.add(guiOpts.left.colorFilter.r,"max",0,255).name("red max");b.add(guiOpts.left.colorFilter.g,"min",0,255).name("green min");b.add(guiOpts.left.colorFilter.g,"max",0,255).name("green max");b.add(guiOpts.left.colorFilter.b,"min",0,255).name("blue min");b.add(guiOpts.left.colorFilter.b,"max",0,255).name("blue max");b.add(guiOpts.left.smooth,"vWidth",0,20).step(1);b.add(guiOpts.left.smooth,"hWidth",0,20).step(1)});
AugmentedGesture=function(){AugmentedGesture.hasUserMedia||alert("Panic: no UserMedia");console.assert(AugmentedGesture.hasUserMedia,"no usermedia available");this._video=this._videoCtor();this._frameCount=0;var a=document.createElement("canvas");this._canvas=a;a.width=this._video.width/4;a.height=this._video.height/4;this._pointerR={x:a.width/2,y:a.height/2};this._pointerL={x:a.width/2,y:a.height/2}};AugmentedGesture.prototype.destroy=function(){this.stop()};
AugmentedGesture.hasUserMedia=navigator.webkitGetUserMedia?!0:!1;
AugmentedGesture.MicroeventMixin=function(a){a.bind=function(a,d){void 0===this._events&&(this._events={});this._events[a]=this._events[a]||[];this._events[a].push(d);return d};a.unbind=function(a,d){void 0===this._events&&(this._events={});!1!==a in this._events&&this._events[a].splice(this._events[a].indexOf(d),1)};a.trigger=function(a){void 0===this._events&&(this._events={});if(void 0!==this._events[a])for(var d=this._events[a].slice(),c=0;c<d.length;c++)d[c].apply(this,Array.prototype.slice.call(arguments,
1))}};AugmentedGesture.MicroeventMixin(AugmentedGesture.prototype);AugmentedGesture.prototype.start=function(){var a=function(){this._reqAnimId=requestAnimationFrame(a);this._update()}.bind(this);a();return this};AugmentedGesture.prototype.stop=function(){cancelAnimationFrame(this._reqAnimId);return this};
AugmentedGesture.prototype.domElementFullpage=function(){var a=this.domElement();document.body.appendChild(a);a.style.position="absolute";a.style.top="0px";a.style.left="0px";a.style.width="100%";a.style.height="100%";return this};AugmentedGesture.prototype.domElementThumbnail=function(){var a=this.domElement();document.body.appendChild(a);a.style.position="absolute";a.style.top="0px";a.style.left="0px";a.style.width="320px";a.style.height="240px";return this};
AugmentedGesture.prototype.domElementRemove=function(){var a=this.domElement();a.parentNode&&a.parentNode.removeChild(a);return this};AugmentedGesture.prototype.domElement=function(){return this._canvas};AugmentedGesture.prototype.pointerR=function(){return this._pointerR};AugmentedGesture.prototype.pointerL=function(){return this._pointerL};
AugmentedGesture.prototype._videoCtor=function(){var a=document.createElement("video");a.width=320;a.height=240;a.autoplay=!0;navigator.webkitGetUserMedia("video",function(b){a.src=webkitURL.createObjectURL(b)},function(){alert("you got no WebRTC webcam")});return a};
AugmentedGesture.prototype._update=function(){var a=this._canvas,b=a.getContext("2d");this._frameCount++;if(0===this._frameCount%guiOpts.general.video.frameRate&&this._video.readyState===this._video.HAVE_ENOUGH_DATA){a.width!=guiOpts.general.video.w&&(a.width=guiOpts.general.video.w);a.height!=guiOpts.general.video.h&&(a.height=guiOpts.general.video.h);b.drawImage(this._video,0,0,a.width,a.height);a=b.getImageData(0,0,a.width,a.height);ImgProc.fliph(a);var d=ImgProc.duplicate(a,b);ImgProc.threshold(d,
guiOpts.right.colorFilter.r,guiOpts.right.colorFilter.g,guiOpts.right.colorFilter.b);guiOpts.right.disp.enable&&(a=d);var c=ImgProc.computeVerticalHistogram(d,function(a,b){return a[b+1]!==0?true:false});ImgProc.windowedAverageHistogram(c,guiOpts.right.smooth.vWidth);var e=ImgProc.getMaxHistogram(c);guiOpts.right.disp.VHist&&ImgProc.displayVerticalHistogram(a,c);c=ImgProc.computeHorizontalHistogram(d,function(a,b){return a[b+1]!==0?true:false});ImgProc.windowedAverageHistogram(c,guiOpts.right.smooth.hWidth);
var g=ImgProc.getMaxHistogram(c);guiOpts.right.disp.HHist&&ImgProc.displayHorizontalHistogram(a,c);var f=ImgProc.duplicate(a,b);ImgProc.threshold(f,guiOpts.left.colorFilter.r,guiOpts.left.colorFilter.g,guiOpts.left.colorFilter.b);guiOpts.left.disp.enable&&(a=f);c=ImgProc.computeVerticalHistogram(f,function(a,b){return a[b+1]!==0?true:false});ImgProc.windowedAverageHistogram(c,guiOpts.left.smooth.vWidth);d=ImgProc.getMaxHistogram(c);guiOpts.left.disp.VHist&&ImgProc.displayVerticalHistogram(a,c);c=
ImgProc.computeHorizontalHistogram(f,function(a,b){return a[b+1]!==0?true:false});ImgProc.windowedAverageHistogram(c,guiOpts.left.smooth.hWidth);f=ImgProc.getMaxHistogram(c);guiOpts.left.disp.HHist&&ImgProc.displayHorizontalHistogram(a,c);guiOpts.right.disp.VLine&&ImgProc.vline(a,e.idx,0,0,255);guiOpts.right.disp.HLine&&ImgProc.hline(a,g.idx,0,0,255);guiOpts.left.disp.VLine&&ImgProc.vline(a,d.idx,0,255,0);guiOpts.left.disp.HLine&&ImgProc.hline(a,f.idx,0,255,0);c=this._pointerR;c.x+=(e.idx-c.x)*guiOpts.right.pointer.coordSmoothV;
c.y+=(g.idx-c.y)*guiOpts.right.pointer.coordSmoothH;guiOpts.right.pointer.display&&(ImgProc.vline(a,Math.floor(c.x),255,0,255),ImgProc.hline(a,Math.floor(c.y),255,0,255));e=this._pointerL;e.x+=(d.idx-e.x)*guiOpts.left.pointer.coordSmoothV;e.y+=(f.idx-e.y)*guiOpts.left.pointer.coordSmoothH;guiOpts.left.pointer.display&&(ImgProc.vline(a,Math.floor(e.x),255,0,0),ImgProc.hline(a,Math.floor(e.y),255,0,0));b.putImageData(a,0,0);this.trigger("update",c,e)}};
AugmentedGesture.GestureRecognition=function(){this._lastEvent=null};AugmentedGesture.GestureRecognition.prototype.update=function(a,b,d){b=d/3;d=null;d=a<1*b?"left":a<2*b?"middle":"right";d===this._lastEvent?d=null:this._lastEvent=d;return d};
var DatGuiOpts=function(){this.general={video:{w:80,h:60,frameRate:1}};this.right={pointer:{display:!0,coordSmoothV:0.3,coordSmoothH:0.3},disp:{enable:!1,VHist:!1,HHist:!1,VLine:!1,HLine:!1},colorFilter:{r:{min:125,max:255},g:{min:3,max:140},b:{min:10,max:90}},smooth:{vWidth:9,hWidth:9}};this.left={pointer:{display:!0,coordSmoothV:0.3,coordSmoothH:0.3},disp:{enable:!1,VHist:!1,HHist:!1,VLine:!1,HLine:!1},colorFilter:{r:{min:0,max:80},g:{min:70,max:255},b:{min:0,max:113}},smooth:{vWidth:9,hWidth:9}}},
guiOpts=new DatGuiOpts;
window.addEventListener("load",function(){var a=new dat.GUI,b=a.addFolder("General");b.add(guiOpts.general.video,"w",0,320).step(40).name("videoW");b.add(guiOpts.general.video,"h",0,240).step(30).name("videoH");b.add(guiOpts.general.video,"frameRate",1,30).step(1);b=a.addFolder("Right Pointer");b.add(guiOpts.right.pointer,"display");b.add(guiOpts.right.pointer,"coordSmoothV",0,1);b.add(guiOpts.right.pointer,"coordSmoothH",0,1);b=a.addFolder("Right Display");b.add(guiOpts.right.disp,"enable");b.add(guiOpts.right.disp,
"HHist");b.add(guiOpts.right.disp,"VHist");b.add(guiOpts.right.disp,"HLine");b.add(guiOpts.right.disp,"VLine");b=a.addFolder("Right Threshold");b.add(guiOpts.right.colorFilter.r,"min",0,255).name("red min");b.add(guiOpts.right.colorFilter.r,"max",0,255).name("red max");b.add(guiOpts.right.colorFilter.g,"min",0,255).name("green min");b.add(guiOpts.right.colorFilter.g,"max",0,255).name("green max");b.add(guiOpts.right.colorFilter.b,"min",0,255).name("blue min");b.add(guiOpts.right.colorFilter.b,"max",
0,255).name("blue max");b.add(guiOpts.right.smooth,"hWidth",0,20).step(1);b.add(guiOpts.right.smooth,"vWidth",0,20).step(1);b=a.addFolder("Left Pointer");b.add(guiOpts.left.pointer,"display");b.add(guiOpts.left.pointer,"coordSmoothV",0,1);b.add(guiOpts.left.pointer,"coordSmoothH",0,1);b=a.addFolder("Left Display");b.add(guiOpts.left.disp,"enable");b.add(guiOpts.left.disp,"VHist");b.add(guiOpts.left.disp,"HHist");b.add(guiOpts.left.disp,"VLine");b.add(guiOpts.left.disp,"HLine");b=a.addFolder("Left Threshold");
b.add(guiOpts.left.colorFilter.r,"min",0,255).name("red min");b.add(guiOpts.left.colorFilter.r,"max",0,255).name("red max");b.add(guiOpts.left.colorFilter.g,"min",0,255).name("green min");b.add(guiOpts.left.colorFilter.g,"max",0,255).name("green max");b.add(guiOpts.left.colorFilter.b,"min",0,255).name("blue min");b.add(guiOpts.left.colorFilter.b,"max",0,255).name("blue max");b.add(guiOpts.left.smooth,"vWidth",0,20).step(1);b.add(guiOpts.left.smooth,"hWidth",0,20).step(1)});
AugmentedGesture=function(){AugmentedGesture.hasUserMedia||alert("Panic: no UserMedia");console.assert(AugmentedGesture.hasUserMedia,"no usermedia available");this._video=this._videoCtor();this._frameCount=0;var a=document.createElement("canvas");this._canvas=a;a.width=this._video.width/4;a.height=this._video.height/4;this._pointerR={x:a.width/2,y:a.height/2};this._pointerL={x:a.width/2,y:a.height/2}};AugmentedGesture.prototype.destroy=function(){this.stop()};
AugmentedGesture.hasUserMedia=navigator.webkitGetUserMedia?!0:!1;
AugmentedGesture.MicroeventMixin=function(a){a.bind=function(a,d){void 0===this._events&&(this._events={});this._events[a]=this._events[a]||[];this._events[a].push(d);return d};a.unbind=function(a,d){void 0===this._events&&(this._events={});!1!==a in this._events&&this._events[a].splice(this._events[a].indexOf(d),1)};a.trigger=function(a){void 0===this._events&&(this._events={});if(void 0!==this._events[a])for(var d=this._events[a].slice(),c=0;c<d.length;c++)d[c].apply(this,Array.prototype.slice.call(arguments,
1))}};AugmentedGesture.MicroeventMixin(AugmentedGesture.prototype);AugmentedGesture.prototype.start=function(){var a=function(){this._reqAnimId=requestAnimationFrame(a);this._update()}.bind(this);a();return this};AugmentedGesture.prototype.stop=function(){cancelAnimationFrame(this._reqAnimId);return this};
AugmentedGesture.prototype.domElementFullpage=function(){var a=this.domElement();document.body.appendChild(a);a.style.position="absolute";a.style.top="0px";a.style.left="0px";a.style.width="100%";a.style.height="100%";return this};AugmentedGesture.prototype.domElementThumbnail=function(){var a=this.domElement();document.body.appendChild(a);a.style.position="absolute";a.style.top="0px";a.style.left="0px";a.style.width="320px";a.style.height="240px";return this};
AugmentedGesture.prototype.domElementRemove=function(){var a=this.domElement();a.parentNode&&a.parentNode.removeChild(a);return this};AugmentedGesture.prototype.domElement=function(){return this._canvas};AugmentedGesture.prototype.pointerR=function(){return this._pointerR};AugmentedGesture.prototype.pointerL=function(){return this._pointerL};
AugmentedGesture.prototype._videoCtor=function(){var a=document.createElement("video");a.width=320;a.height=240;a.autoplay=!0;navigator.webkitGetUserMedia("video",function(b){a.src=webkitURL.createObjectURL(b)},function(){alert("you got no WebRTC webcam")});return a};
AugmentedGesture.prototype._update=function(){var a=this._canvas,b=a.getContext("2d");this._frameCount++;if(0===this._frameCount%guiOpts.general.video.frameRate&&this._video.readyState===this._video.HAVE_ENOUGH_DATA){a.width!=guiOpts.general.video.w&&(a.width=guiOpts.general.video.w);a.height!=guiOpts.general.video.h&&(a.height=guiOpts.general.video.h);b.drawImage(this._video,0,0,a.width,a.height);a=b.getImageData(0,0,a.width,a.height);ImgProc.fliph(a);var d=ImgProc.duplicate(a,b);ImgProc.threshold(d,
guiOpts.right.colorFilter.r,guiOpts.right.colorFilter.g,guiOpts.right.colorFilter.b);guiOpts.right.disp.enable&&(a=d);var c=ImgProc.computeVerticalHistogram(d,function(a,b){return a[b+1]!==0?true:false});ImgProc.windowedAverageHistogram(c,guiOpts.right.smooth.vWidth);var e=ImgProc.getMaxHistogram(c);guiOpts.right.disp.VHist&&ImgProc.displayVerticalHistogram(a,c);c=ImgProc.computeHorizontalHistogram(d,function(a,b){return a[b+1]!==0?true:false});ImgProc.windowedAverageHistogram(c,guiOpts.right.smooth.hWidth);
var g=ImgProc.getMaxHistogram(c);guiOpts.right.disp.HHist&&ImgProc.displayHorizontalHistogram(a,c);var f=ImgProc.duplicate(a,b);ImgProc.threshold(f,guiOpts.left.colorFilter.r,guiOpts.left.colorFilter.g,guiOpts.left.colorFilter.b);guiOpts.left.disp.enable&&(a=f);c=ImgProc.computeVerticalHistogram(f,function(a,b){return a[b+1]!==0?true:false});ImgProc.windowedAverageHistogram(c,guiOpts.left.smooth.vWidth);d=ImgProc.getMaxHistogram(c);guiOpts.left.disp.VHist&&ImgProc.displayVerticalHistogram(a,c);c=
ImgProc.computeHorizontalHistogram(f,function(a,b){return a[b+1]!==0?true:false});ImgProc.windowedAverageHistogram(c,guiOpts.left.smooth.hWidth);f=ImgProc.getMaxHistogram(c);guiOpts.left.disp.HHist&&ImgProc.displayHorizontalHistogram(a,c);guiOpts.right.disp.VLine&&ImgProc.vline(a,e.idx,0,0,255);guiOpts.right.disp.HLine&&ImgProc.hline(a,g.idx,0,0,255);guiOpts.left.disp.VLine&&ImgProc.vline(a,d.idx,0,255,0);guiOpts.left.disp.HLine&&ImgProc.hline(a,f.idx,0,255,0);c=this._pointerR;c.x+=(e.idx-c.x)*guiOpts.right.pointer.coordSmoothV;
c.y+=(g.idx-c.y)*guiOpts.right.pointer.coordSmoothH;guiOpts.right.pointer.display&&(ImgProc.vline(a,Math.floor(c.x),255,0,255),ImgProc.hline(a,Math.floor(c.y),255,0,255));e=this._pointerL;e.x+=(d.idx-e.x)*guiOpts.left.pointer.coordSmoothV;e.y+=(f.idx-e.y)*guiOpts.left.pointer.coordSmoothH;guiOpts.left.pointer.display&&(ImgProc.vline(a,Math.floor(e.x),255,0,0),ImgProc.hline(a,Math.floor(e.y),255,0,0));b.putImageData(a,0,0);this.trigger("update",c,e)}};
AugmentedGesture.GestureRecognition=function(){this._lastEvent=null};AugmentedGesture.GestureRecognition.prototype.update=function(a,b,d){b=d/3;d=null;d=a<1*b?"left":a<2*b?"middle":"right";d===this._lastEvent?d=null:this._lastEvent=d;return d};
var DatGuiOpts=function(){this.general={video:{w:80,h:60,frameRate:1}};this.right={pointer:{display:!0,coordSmoothV:0.3,coordSmoothH:0.3},disp:{enable:!1,VHist:!1,HHist:!1,VLine:!1,HLine:!1},colorFilter:{r:{min:125,max:255},g:{min:3,max:140},b:{min:10,max:90}},smooth:{vWidth:9,hWidth:9}};this.left={pointer:{display:!0,coordSmoothV:0.3,coordSmoothH:0.3},disp:{enable:!1,VHist:!1,HHist:!1,VLine:!1,HLine:!1},colorFilter:{r:{min:0,max:80},g:{min:70,max:255},b:{min:0,max:113}},smooth:{vWidth:9,hWidth:9}}},
guiOpts=new DatGuiOpts;
window.addEventListener("load",function(){var a=new dat.GUI,b=a.addFolder("General");b.add(guiOpts.general.video,"w",0,320).step(40).name("videoW");b.add(guiOpts.general.video,"h",0,240).step(30).name("videoH");b.add(guiOpts.general.video,"frameRate",1,30).step(1);b=a.addFolder("Right Pointer");b.add(guiOpts.right.pointer,"display");b.add(guiOpts.right.pointer,"coordSmoothV",0,1);b.add(guiOpts.right.pointer,"coordSmoothH",0,1);b=a.addFolder("Right Display");b.add(guiOpts.right.disp,"enable");b.add(guiOpts.right.disp,
"HHist");b.add(guiOpts.right.disp,"VHist");b.add(guiOpts.right.disp,"HLine");b.add(guiOpts.right.disp,"VLine");b=a.addFolder("Right Threshold");b.add(guiOpts.right.colorFilter.r,"min",0,255).name("red min");b.add(guiOpts.right.colorFilter.r,"max",0,255).name("red max");b.add(guiOpts.right.colorFilter.g,"min",0,255).name("green min");b.add(guiOpts.right.colorFilter.g,"max",0,255).name("green max");b.add(guiOpts.right.colorFilter.b,"min",0,255).name("blue min");b.add(guiOpts.right.colorFilter.b,"max",
0,255).name("blue max");b.add(guiOpts.right.smooth,"hWidth",0,20).step(1);b.add(guiOpts.right.smooth,"vWidth",0,20).step(1);b=a.addFolder("Left Pointer");b.add(guiOpts.left.pointer,"display");b.add(guiOpts.left.pointer,"coordSmoothV",0,1);b.add(guiOpts.left.pointer,"coordSmoothH",0,1);b=a.addFolder("Left Display");b.add(guiOpts.left.disp,"enable");b.add(guiOpts.left.disp,"VHist");b.add(guiOpts.left.disp,"HHist");b.add(guiOpts.left.disp,"VLine");b.add(guiOpts.left.disp,"HLine");b=a.addFolder("Left Threshold");
b.add(guiOpts.left.colorFilter.r,"min",0,255).name("red min");b.add(guiOpts.left.colorFilter.r,"max",0,255).name("red max");b.add(guiOpts.left.colorFilter.g,"min",0,255).name("green min");b.add(guiOpts.left.colorFilter.g,"max",0,255).name("green max");b.add(guiOpts.left.colorFilter.b,"min",0,255).name("blue min");b.add(guiOpts.left.colorFilter.b,"max",0,255).name("blue max");b.add(guiOpts.left.smooth,"vWidth",0,20).step(1);b.add(guiOpts.left.smooth,"hWidth",0,20).step(1)});
