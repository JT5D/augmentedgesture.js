AugmentedGesture=function(c){this._opts=c||new AugmentedGesture.Options;AugmentedGesture.hasUserMedia||alert("Panic: no UserMedia");console.assert(AugmentedGesture.hasUserMedia,"no usermedia available");this._video=this._videoCtor();this._frameCount=0;this._canvas=c=document.createElement("canvas");c.width=this._video.width/4;c.height=this._video.height/4;this._pointersPos={}};AugmentedGesture.prototype.destroy=function(){this.stop();this.domElementRemove();this.statsRemove();this.disableDatGui()};
AugmentedGesture.hasUserMedia=navigator.webkitGetUserMedia?!0:!1;
AugmentedGesture.MicroeventMixin=function(c){c.bind=function(b,a){void 0===this._events&&(this._events={});this._events[b]=this._events[b]||[];this._events[b].push(a);return a};c.unbind=function(b,a){void 0===this._events&&(this._events={});!1!==b in this._events&&this._events[b].splice(this._events[b].indexOf(a),1)};c.trigger=function(b){void 0===this._events&&(this._events={});if(void 0!==this._events[b])for(var a=this._events[b].slice(),c=0;c<a.length;c++)a[c].apply(this,Array.prototype.slice.call(arguments,
1))}};AugmentedGesture.MicroeventMixin(AugmentedGesture.prototype);AugmentedGesture.prototype.start=function(){var c=function(){this._reqAnimId=requestAnimationFrame(c);this._update()}.bind(this);c();return this};AugmentedGesture.prototype.stop=function(){cancelAnimationFrame(this._reqAnimId);return this};AugmentedGesture.prototype.opts=function(){return this._opts};
AugmentedGesture.prototype.domElementFullpage=function(){var c=this.domElement();document.body.appendChild(c);c.style.position="absolute";c.style.top="0px";c.style.left="0px";c.style.width="100%";c.style.height="100%";return this};AugmentedGesture.prototype.domElementThumbnail=function(){var c=this.domElement();document.body.appendChild(c);c.style.position="absolute";c.style.top="0px";c.style.left="0px";c.style.width="320px";c.style.height="240px";return this};
AugmentedGesture.prototype.domElementRemove=function(){var c=this.domElement();c.parentNode&&c.parentNode.removeChild(c);return this};AugmentedGesture.prototype.statsInsert=function(){var c=this._stats=new Stats;c.getDomElement().style.position="absolute";c.getDomElement().style.left="0px";c.getDomElement().style.top="0px";document.body.appendChild(c.getDomElement());return this};
AugmentedGesture.prototype.statsRemove=function(){if(!this._stats)return this;var c=this._stats.getDomElement();c.parentNode&&c.parentNode.removeChild(c);this._stats=null;return this};AugmentedGesture.prototype._statsUpdate=function(){this._stats&&this._stats.update()};
AugmentedGesture.prototype.addPointer=function(c,b){console.assert(!this._pointersPos[c]);this._pointersPos[c]={x:this._canvas.width/2,y:this._canvas.height/2};console.assert(!this._opts.pointers[c]);this._opts.pointers[c]=b;this._datgui&&this._addDatGuiPointer(c)};AugmentedGesture.Options=function(){this.general={video:{w:80,h:60,frameRate:1}};this.pointers={}};
AugmentedGesture.OptionPointer=function(){this.pointer={display:!0,coordSmoothV:0.3,coordSmoothH:0.3,crossColor:{r:0,g:255,b:255}};this.disp={enable:!1,VHist:!1,HHist:!1,VLine:!1,HLine:!1};this.colorFilter={r:{min:0,max:255},g:{min:0,max:255},b:{min:0,max:255},minHist:{h:5,v:5}};this.smooth={vWidth:9,hWidth:9}};
AugmentedGesture.prototype.enableDatGui=function(){var c=this._opts;window.addEventListener("load",function(){var b=(this._datgui=new dat.GUI).addFolder("General");b.add(c.general.video,"w",0,320).step(40).name("videoW");b.add(c.general.video,"h",0,240).step(30).name("videoH");b.add(c.general.video,"frameRate",1,30).step(1);Object.keys(this._pointersPos).forEach(function(a){this._addDatGuiPointer(a)}.bind(this))}.bind(this));return this};
AugmentedGesture.prototype.disableDatGui=function(){this._datgui&&this._datgui.destroy()};
AugmentedGesture.prototype._addDatGuiPointer=function(c){console.assert(this._datgui);var b=this._opts.pointers[c],c=this._datgui.addFolder("Pointer: "+c),a=c.addFolder("Main");a.add(b.pointer,"display");a.add(b.pointer,"coordSmoothV",0,1);a.add(b.pointer,"coordSmoothH",0,1);a.add(b.pointer.crossColor,"r",0,255).name("Cross ColorR");a.add(b.pointer.crossColor,"g",0,255).name("Cross ColorG");a.add(b.pointer.crossColor,"b",0,255).name("Cross ColorB");a=c.addFolder("Display");a.add(b.disp,"enable");
a.add(b.disp,"HHist");a.add(b.disp,"VHist");a.add(b.disp,"HLine");a.add(b.disp,"VLine");a=c.addFolder("Threshold");a.open();a.add(b.colorFilter.r,"min",0,255).name("red min");a.add(b.colorFilter.r,"max",0,255).name("red max");a.add(b.colorFilter.g,"min",0,255).name("green min");a.add(b.colorFilter.g,"max",0,255).name("green max");a.add(b.colorFilter.b,"min",0,255).name("blue min");a.add(b.colorFilter.b,"max",0,255).name("blue max");a.add(b.colorFilter.minHist,"h",0,20).name("minHistH");a.add(b.colorFilter.minHist,
"v",0,20).name("minHistV");a.add(b.smooth,"hWidth",0,20).step(1);a.add(b.smooth,"vWidth",0,20).step(1)};AugmentedGesture.prototype.domElement=function(){return this._canvas};AugmentedGesture.prototype.pointers=function(){return this._pointersPos};
AugmentedGesture.prototype._videoCtor=function(){var c=document.createElement("video");c.width=320;c.height=240;c.autoplay=!0;navigator.webkitGetUserMedia("video",function(b){c.src=webkitURL.createObjectURL(b)},function(){alert("you got no WebRTC webcam")});return c};
AugmentedGesture.prototype._update=function(){function c(a,g){var c=ImgProc.duplicate(a,d),e=b.pointers[g];ImgProc.threshold(c,e.colorFilter.r,e.colorFilter.g,e.colorFilter.b);e.disp.enable&&ImgProc.copy(c,a);var f=ImgProc.computeHorizontalHistogram(c,function(a,g){return 0!==a[g+1]?!0:!1});ImgProc.windowedAverageHistogram(f,e.smooth.hWidth);var h=e.colorFilter.minHist.h;ImgProc.filterHistogram(f,function(a,g,b){b[g]=b[g]>=h?b[g]:0});var m=ImgProc.getMaxHistogram(f);e.disp.VHist&&ImgProc.displayHorizontalHistogram(a,
f);f=ImgProc.computeVerticalHistogram(c,function(a,g){return 0!==a[g+1]?!0:!1});ImgProc.windowedAverageHistogram(f,e.smooth.vWidth);h=e.colorFilter.minHist.v;ImgProc.filterHistogram(f,function(a,g,b){b[g]=b[g]>=h?b[g]:0});c=ImgProc.getMaxHistogram(f);e.disp.HHist&&ImgProc.displayVerticalHistogram(a,f);return{h:m,v:c}}var b=this._opts,a=this._canvas,d=a.getContext("2d");this._frameCount++;if(0===this._frameCount%b.general.video.frameRate&&this._video.readyState===this._video.HAVE_ENOUGH_DATA){this._statsUpdate();
a.width!=b.general.video.w&&(a.width=b.general.video.w);a.height!=b.general.video.h&&(a.height=b.general.video.h);var e=a.width,g=a.height;d.drawImage(this._video,0,0,a.width,a.height);var f=d.getImageData(0,0,a.width,a.height);ImgProc.fliph(f);var h=function(a){var d=b.pointers[a],h=c(f,a);d.disp.HLine&&ImgProc.hline(f,h.h.idx,0,255,0);d.disp.VLine&&ImgProc.vline(f,h.v.idx,0,255,0);if(h.h.max===0||h.v.max===0){if(this._pointersPos[a]!==null){this._pointersPos[a]=null;this.trigger("mouseup."+a)}}else{if(!this._pointersPos[a]){this._pointersPos[a]=
{x:h.h.idx/e,y:h.v.idx/g};this.trigger("mousedown."+a,this._pointersPos[a]);this.trigger("click."+a,this._pointersPos[a])}var n=this._pointersPos[a],q=n.x,j=n.y;n.x=n.x+(h.h.idx/e-n.x)*d.pointer.coordSmoothH;n.y=n.y+(h.v.idx/g-n.y)*d.pointer.coordSmoothV;if(d.pointer.display){d=d.pointer.crossColor;ImgProc.vline(f,Math.floor(n.x*e),d.r,d.g,d.b);ImgProc.hline(f,Math.floor(n.y*g),d.r,d.g,d.b)}(q!==n.x||j!==n.y)&&this.trigger("mousemove."+a,n)}}.bind(this);Object.keys(this._pointersPos).forEach(function(a){h(a)});
d.putImageData(f,0,0)}};AugmentedGesture.GestureRecognition=function(){this._lastEvent=null};AugmentedGesture.GestureRecognition.prototype.update=function(c,b,a){b=a/3;a=null;a=c<1*b?"left":c<2*b?"middle":"right";a===this._lastEvent?a=null:this._lastEvent=a;return a};
var ImgProc={fliph:function(c){for(var b=c.data,a=c.width,c=c.height,d,e=0;e<c;e++)for(var g=0;g<a/2;g++){var f=4*(g+e*a),h=4*(a-1-g+e*a);d=b[f+0];b[f+0]=b[h+0];b[h+0]=d;d=b[f+1];b[f+1]=b[h+1];b[h+1]=d;d=b[f+2];b[f+2]=b[h+2];b[h+2]=d;d=b[f+3];b[f+3]=b[h+3];b[h+3]=d}},luminance:function(c,b){for(var b=void 0!==b?b:1,a=c.data,d=c.width,e=c.height,g=0,f=0;f<e;f++)for(var h=0;h<d;h++,g+=4){var i=0.2126*(a[g+0]/255)+0.7152*(a[g+1]/255)+0.0722*(a[g+2]/255),i=Math.floor(255*i*b);a[g+0]=i;a[g+1]=i;a[g+2]=
i}},duplicate:function(c,b){return ImgProc.copy(c,b.createImageData(c))},copy:function(c,b){console.assert(c.width===b.width);console.assert(c.height===b.height);for(var a=c.data,d=b.data,e=0;e<a.length;e++)d[e]=a[e];return b},sobel:function(c,b){for(var a=c.data,d=c.width,e=c.height,g=b.data,f=[[-1,0,1],[-2,0,2],[-1,0,1]],h=[[-1,-2,-1],[0,0,0],[1,2,1]],i=function(a,g,b){g=4*g+4*b*d;return 0.3*a[g]+0.59*a[g+1]+0.11*a[g+2]},l=1;l<d-2;l++)for(var k=1;k<e-2;k++){var n=f[0][0]*i(a,l-1,k-1)+f[0][1]*i(a,
l,k-1)+f[0][2]*i(a,l+1,k-1)+f[1][0]*i(a,l-1,k)+f[1][1]*i(a,l,k)+f[1][2]*i(a,l+1,k)+f[2][0]*i(a,l-1,k+1)+f[2][1]*i(a,l,k+1)+f[2][2]*i(a,l+1,k+1),q=h[0][0]*i(a,l-1,k-1)+h[0][1]*i(a,l,k-1)+h[0][2]*i(a,l+1,k-1)+h[1][0]*i(a,l-1,k)+h[1][1]*i(a,l,k)+h[1][2]*i(a,l+1,k)+h[2][0]*i(a,l-1,k+1)+h[2][1]*i(a,l,k+1)+h[2][2]*i(a,l+1,k+1),n=Math.ceil(Math.sqrt(n*n+q*q)),q=4*k*d+4*l;g[q+0]=n;g[q+1]=n;g[q+2]=n}},threshold:function(c,b,a,d){for(var e=c.data,g=c.width,c=c.height,f=0,h=0;h<c;h++)for(var i=0;i<g;i++,f+=
4)if(!(e[f+0]>=b.min&&e[f+0]<=b.max)||!(e[f+1]>=a.min&&e[f+1]<=a.max)||!(e[f+2]>=d.min&&e[f+2]<=d.max))e[f+0]=e[f+1]=e[f+2]=0},convert:function(c,b){for(var a=c.data,d=c.width,e=c.height,g=0,f=0;f<e;f++)for(var h=0;h<d;h++,g+=4)b(a,g,h,f,c)},hline:function(c,b,a,d,e,g){for(var f=c.data,c=c.width,b=4*b*c,a=void 0!==a?a:255,d=void 0!==d?d:255,e=void 0!==e?e:255,g=void 0!==g?g:255,h=0;h<c;h++,b+=4)f[b+0]=a,f[b+1]=d,f[b+2]=e,f[b+3]=g},vline:function(c,b,a,d,e,g){for(var f=c.data,h=c.width,c=c.height,
a=void 0!==a?a:255,d=void 0!==d?d:255,e=void 0!==e?e:255,g=void 0!==g?g:255,b=4*b,i=0;i<c;i++,b+=4*h)f[b+0]=a,f[b+1]=d,f[b+2]=e,f[b+3]=g},smoothHistogram:function(c,b){for(var a=0,d=0;d<c.length;d++)a+=(c[d]-a)*b,c[d]=a},windowedAverageHistogram:function(c,b){for(var a=Math.floor(b/2),d=0,e=0,g=Array(c.length),f=0;f<c.length;f++)g[f]=c[f];for(f=0;f<a;f++)d+=c[f],e++;for(f=0;f<c.length;f++)f+a<c.length&&(d+=g[f+a],e++),0<=f-a&&(d-=g[f-a],e--),c[f]=d/e},getMaxHistogram:function(c){for(var b=-Number.MAX_VALUE,
a=0,d=0;d<c.length;d++)c[d]>b&&(b=c[d],a=d);return{max:b,idx:a}},filterHistogram:function(c,b){for(var a=0;a<c.length;a++)b(c[a],a,c)},computeHorizontalHistogram:function(c,b){var a=c.data,d=c.width,e=c.height,g=new Float64Array(d);console.assert(b,"invalid parameter");for(var f=0;f<d;f++)for(var h=4*f,i=0;i<e;i++,h+=4*d)b(a,h,f,i,c)&&g[f]++;return g},displayHorizontalHistogram:function(c,b){var a=c.width,d=c.height;console.assert(b.length===a);var e=document.createElement("canvas");e.width=a;e.height=
d;var g=e.getContext("2d");g.fillStyle="red";for(var f=0;f<a;f++)g.fillRect(f,d-b[f],1,b[f]);a=g.getImageData(0,0,e.width,e.height).data;d=c.data;for(e=0;e<a.length;e+=4){if(0!==a[e+0]||0!==a[e+1]||0!==a[e+2])d[e+0]=a[e+0],d[e+1]=a[e+1],d[e+2]=a[e+2];d[e+3]=255}},computeVerticalHistogram:function(c,b){var a=c.data,d=c.width,e=c.height,g=new Float64Array(e);console.assert(b,"invalid parameter");for(var f=0,h=0;h<e;h++)for(var i=0;i<d;i++,f+=4)b(a,f,i,h,c)&&g[h]++;return g},displayVerticalHistogram:function(c,
b){var a=c.width,d=c.height;console.assert(b.length===d);var e=document.createElement("canvas");e.width=a;e.height=d;a=e.getContext("2d");a.fillStyle="red";for(var g=0;g<d;g++)a.fillRect(0,g,b[g],1);d=a.getImageData(0,0,e.width,e.height).data;e=c.data;for(a=0;a<d.length;a+=4){if(0!==d[a+0]||0!==d[a+1]||0!==d[a+2])e[a+0]=d[a+0],e[a+1]=d[a+1],e[a+2]=d[a+2];e[a+3]=255}},computeColorHistogram:function(c){for(var b=c.data,a=c.width,c=c.height,d={r:new Float64Array(256),g:new Float64Array(256),b:new Float64Array(256)},
e=0,g=0;g<c;g++)for(var f=0;f<a;f++,e+=4)d.r[b[e+0]]++,d.g[b[e+1]]++,d.b[b[e+2]]++;return d},normalizeColorHistogram:function(c){for(var b=-Number.MAX_VALUE,a=0;256>a;a++)b=Math.max(b,c.r[a]),b=Math.max(b,c.g[a]),b=Math.max(b,c.b[a]);for(a=0;256>a;a++)c.r[a]/=b,c.g[a]/=b,c.b[a]/=b;for(var d=0,e=0,g=0,a=0;256>a;a++)d+=c.r[a],e+=c.g[a],g+=c.b[a];console.log("sum",b,d,e,g)},displayColorHistogram:function(c,b){var a=c.width,d=c.height,e=document.createElement("canvas");e.width=a;e.height=d;var d=e.getContext("2d"),
g=e.width/256,f=e.height/3;d.fillStyle="red";for(var h=0*f,a=0;256>a;a++){var i=Math.floor(b.r[a]*f);d.fillRect(a*g,h+(f-i),g,i)}d.fillStyle="green";h=1*f;for(a=0;256>a;a++)i=Math.floor(b.g[a]*f),d.fillRect(a*g,h+(f-i),g,i);d.fillStyle="blue";h=2*f;for(a=0;256>a;a++)i=Math.floor(b.b[a]*f),d.fillRect(a*g,h+(f-i),g,i);e=d.getImageData(0,0,e.width,e.height).data;d=c.data;for(a=0;a<e.length;a+=4)if(0!==e[a+0]||0!==e[a+1]||0!==e[a+2])d[a+0]=e[a+0],d[a+1]=e[a+1],d[a+2]=e[a+2]}};
(function(){for(var c=0,b=["ms","moz","webkit","o"],a=0;a<b.length&&!window.requestAnimationFrame;++a)window.requestAnimationFrame=window[b[a]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[a]+"CancelAnimationFrame"]||window[b[a]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(a){var b=(new Date).getTime(),g=Math.max(0,16-(b-c)),f=window.setTimeout(function(){a(b+g)},g);c=b+g;return f});window.cancelAnimationFrame||(window.cancelAnimationFrame=
function(a){clearTimeout(a)})})();var dat=dat||{};dat.gui=dat.gui||{};dat.utils=dat.utils||{};dat.controllers=dat.controllers||{};dat.dom=dat.dom||{};dat.color=dat.color||{};dat.utils.css=function(){return{load:function(c,b){var b=b||document,a=b.createElement("link");a.type="text/css";a.rel="stylesheet";a.href=c;b.getElementsByTagName("head")[0].appendChild(a)},inject:function(c,b){var b=b||document,a=document.createElement("style");a.type="text/css";a.innerHTML=c;b.getElementsByTagName("head")[0].appendChild(a)}}}();
dat.utils.common=function(){var c=Array.prototype.forEach,b=Array.prototype.slice;return{BREAK:{},extend:function(a){this.each(b.call(arguments,1),function(b){for(var c in b)this.isUndefined(b[c])||(a[c]=b[c])},this);return a},defaults:function(a){this.each(b.call(arguments,1),function(b){for(var c in b)this.isUndefined(a[c])&&(a[c]=b[c])},this);return a},compose:function(){var a=b.call(arguments);return function(){for(var c=b.call(arguments),e=a.length-1;0<=e;e--)c=[a[e].apply(this,c)];return c[0]}},
each:function(a,b,e){if(c&&a.forEach===c)a.forEach(b,e);else if(a.length===a.length+0)for(var g=0,f=a.length;g<f&&!(g in a&&b.call(e,a[g],g)===this.BREAK);g++);else for(g in a)if(b.call(e,a[g],g)===this.BREAK)break},defer:function(a){setTimeout(a,0)},toArray:function(a){return a.toArray?a.toArray():b.call(a)},isUndefined:function(a){return void 0===a},isNull:function(a){return null===a},isNaN:function(a){return a!==a},isArray:Array.isArray||function(a){return a.constructor===Array},isObject:function(a){return a===
Object(a)},isNumber:function(a){return a===a+0},isString:function(a){return a===a+""},isBoolean:function(a){return!1===a||!0===a},isFunction:function(a){return"[object Function]"===Object.prototype.toString.call(a)}}}();
dat.controllers.Controller=function(c){var b=function(a,b){this.initialValue=a[b];this.domElement=document.createElement("div");this.object=a;this.property=b;this.__onFinishChange=this.__onChange=void 0};c.extend(b.prototype,{onChange:function(a){this.__onChange=a;return this},onFinishChange:function(a){this.__onFinishChange=a;return this},setValue:function(a){this.object[this.property]=a;this.__onChange&&this.__onChange.call(this,a);this.updateDisplay();return this},getValue:function(){return this.object[this.property]},
updateDisplay:function(){return this},isModified:function(){return this.initialValue!==this.getValue()}});return b}(dat.utils.common);
dat.dom.dom=function(c){function b(a){if("0"===a||c.isUndefined(a))return 0;a=a.match(d);return!c.isNull(a)?parseFloat(a[1]):0}var a={};c.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(b,d){c.each(b,function(b){a[b]=d})});var d=/(\d+(\.\d+)?)px/,e={makeSelectable:function(a,b){void 0===a||void 0===a.style||(a.onselectstart=b?function(){return!1}:function(){},a.style.MozUserSelect=b?"auto":"none",a.style.KhtmlUserSelect=
b?"auto":"none",a.unselectable=b?"on":"off")},makeFullscreen:function(a,b,d){c.isUndefined(b)&&(b=!0);c.isUndefined(d)&&(d=!0);a.style.position="absolute";b&&(a.style.left=0,a.style.right=0);d&&(a.style.top=0,a.style.bottom=0)},fakeEvent:function(b,d,e,i){var e=e||{},l=a[d];if(!l)throw Error("Event type "+d+" not supported.");var k=document.createEvent(l);switch(l){case "MouseEvents":k.initMouseEvent(d,e.bubbles||!1,e.cancelable||!0,window,e.clickCount||1,0,0,e.x||e.clientX||0,e.y||e.clientY||0,!1,
!1,!1,!1,0,null);break;case "KeyboardEvents":l=k.initKeyboardEvent||k.initKeyEvent;c.defaults(e,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0});l(d,e.bubbles||!1,e.cancelable,window,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.keyCode,e.charCode);break;default:k.initEvent(d,e.bubbles||!1,e.cancelable||!0)}c.defaults(k,i);b.dispatchEvent(k)},bind:function(a,b,c,d){a.addEventListener?a.addEventListener(b,c,d||!1):a.attachEvent&&a.attachEvent("on"+b,c);return e},
unbind:function(a,b,c,d){a.removeEventListener?a.removeEventListener(b,c,d||!1):a.detachEvent&&a.detachEvent("on"+b,c);return e},addClass:function(a,b){if(void 0===a.className)a.className=b;else if(a.className!==b){var c=a.className.split(/ +/);-1==c.indexOf(b)&&(c.push(b),a.className=c.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return e},removeClass:function(a,b){if(b){if(void 0!==a.className)if(a.className===b)a.removeAttribute("class");else{var c=a.className.split(/ +/),d=c.indexOf(b);-1!=
d&&(c.splice(d,1),a.className=c.join(" "))}}else a.className=void 0;return e},hasClass:function(a,b){return RegExp("(?:^|\\s+)"+b+"(?:\\s+|$)").test(a.className)||!1},getWidth:function(a){a=getComputedStyle(a);return b(a["border-left-width"])+b(a["border-right-width"])+b(a["padding-left"])+b(a["padding-right"])+b(a.width)},getHeight:function(a){a=getComputedStyle(a);return b(a["border-top-width"])+b(a["border-bottom-width"])+b(a["padding-top"])+b(a["padding-bottom"])+b(a.height)},getOffset:function(a){var b=
{left:0,top:0};if(a.offsetParent){do b.left+=a.offsetLeft,b.top+=a.offsetTop;while(a=a.offsetParent)}return b},isActive:function(a){return a===document.activeElement&&(a.type||a.href)}};return e}(dat.utils.common);
dat.controllers.OptionController=function(c,b,a){var d=function(c,g,f){d.superclass.call(this,c,g);var h=this;this.__select=document.createElement("select");if(a.isArray(f)){var i={};a.each(f,function(a){i[a]=a});f=i}a.each(f,function(a,b){var c=document.createElement("option");c.innerHTML=b;c.setAttribute("value",a);h.__select.appendChild(c)});this.updateDisplay();b.bind(this.__select,"change",function(){h.setValue(this.options[this.selectedIndex].value)});this.domElement.appendChild(this.__select)};
d.superclass=c;a.extend(d.prototype,c.prototype,{setValue:function(a){a=d.superclass.prototype.setValue.call(this,a);this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue());return a},updateDisplay:function(){this.__select.value=this.getValue();return d.superclass.prototype.updateDisplay.call(this)}});return d}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);
dat.controllers.NumberController=function(c,b){var a=function(c,e,g){a.superclass.call(this,c,e);g=g||{};this.__min=g.min;this.__max=g.max;this.__step=g.step;this.__impliedStep=b.isUndefined(this.__step)?0==this.initialValue?1:Math.pow(10,Math.floor(Math.log(this.initialValue)/Math.LN10))/10:this.__step;c=this.__impliedStep;c=c.toString();c=-1<c.indexOf(".")?c.length-c.indexOf(".")-1:0;this.__precision=c};a.superclass=c;b.extend(a.prototype,c.prototype,{setValue:function(b){void 0!==this.__min&&b<
this.__min?b=this.__min:void 0!==this.__max&&b>this.__max&&(b=this.__max);void 0!==this.__step&&0!=b%this.__step&&(b=Math.round(b/this.__step)*this.__step);return a.superclass.prototype.setValue.call(this,b)},min:function(a){this.__min=a;return this},max:function(a){this.__max=a;return this},step:function(a){this.__step=a;return this}});return a}(dat.controllers.Controller,dat.utils.common);
dat.controllers.NumberControllerBox=function(c,b,a){var d=function(c,g,f){function h(){var b=parseFloat(k.__input.value);a.isNaN(b)||k.setValue(b)}function i(a){var b=n-a.clientY;k.setValue(k.getValue()+b*k.__impliedStep);n=a.clientY}function l(){b.unbind(window,"mousemove",i);b.unbind(window,"mouseup",l)}this.__truncationSuspended=!1;d.superclass.call(this,c,g,f);var k=this,n;this.__input=document.createElement("input");this.__input.setAttribute("type","text");b.bind(this.__input,"change",h);b.bind(this.__input,
"blur",function(){h();k.__onFinishChange&&k.__onFinishChange.call(k,k.getValue())});b.bind(this.__input,"mousedown",function(a){b.bind(window,"mousemove",i);b.bind(window,"mouseup",l);n=a.clientY});b.bind(this.__input,"keydown",function(a){13===a.keyCode&&(k.__truncationSuspended=!0,this.blur(),k.__truncationSuspended=!1)});this.updateDisplay();this.domElement.appendChild(this.__input)};d.superclass=c;a.extend(d.prototype,c.prototype,{updateDisplay:function(){var a=this.__input,b;if(this.__truncationSuspended)b=
this.getValue();else{b=this.getValue();var c=Math.pow(10,this.__precision);b=Math.round(b*c)/c}a.value=b;return d.superclass.prototype.updateDisplay.call(this)}});return d}(dat.controllers.NumberController,dat.dom.dom,dat.utils.common);
dat.controllers.NumberControllerSlider=function(c,b,a,d,e){var g=function(a,c,d,e,k){function n(a){a.preventDefault();var c=b.getOffset(j.__background),g=b.getWidth(j.__background);j.setValue(j.__min+(j.__max-j.__min)*((a.clientX-c.left)/(c.left+g-c.left)));return!1}function q(){b.unbind(window,"mousemove",n);b.unbind(window,"mouseup",q);j.__onFinishChange&&j.__onFinishChange.call(j,j.getValue())}g.superclass.call(this,a,c,{min:d,max:e,step:k});var j=this;this.__background=document.createElement("div");
this.__foreground=document.createElement("div");b.bind(this.__background,"mousedown",function(a){b.bind(window,"mousemove",n);b.bind(window,"mouseup",q);n(a)});b.addClass(this.__background,"slider");b.addClass(this.__foreground,"slider-fg");this.updateDisplay();this.__background.appendChild(this.__foreground);this.domElement.appendChild(this.__background)};g.superclass=c;g.useDefaultStyles=function(){a.inject(e)};d.extend(g.prototype,c.prototype,{updateDisplay:function(){this.__foreground.style.width=
100*((this.getValue()-this.__min)/(this.__max-this.__min))+"%";return g.superclass.prototype.updateDisplay.call(this)}});return g}(dat.controllers.NumberController,dat.dom.dom,dat.utils.css,dat.utils.common,".slider {\n  box-shadow: inset 0 2px 4px rgba(0,0,0,0.15);\n  height: 1em;\n  border-radius: 1em;\n  background-color: #eee;\n  padding: 0 0.5em;\n  overflow: hidden;\n}\n\n.slider-fg {\n  padding: 1px 0 2px 0;\n  background-color: #aaa;\n  height: 1em;\n  margin-left: -0.5em;\n  padding-right: 0.5em;\n  border-radius: 1em 0 0 1em;\n}\n\n.slider-fg:after {\n  display: inline-block;\n  border-radius: 1em;\n  background-color: #fff;\n  border:  1px solid #aaa;\n  content: '';\n  float: right;\n  margin-right: -1em;\n  margin-top: -1px;\n  height: 0.9em;\n  width: 0.9em;\n}");
dat.controllers.FunctionController=function(c,b,a){var d=function(a,c,f){d.superclass.call(this,a,c);var h=this;this.__button=document.createElement("div");this.__button.innerHTML=void 0===f?"Fire":f;b.bind(this.__button,"click",function(a){a.preventDefault();h.fire();return!1});b.addClass(this.__button,"button");this.domElement.appendChild(this.__button)};d.superclass=c;a.extend(d.prototype,c.prototype,{fire:function(){this.__onChange&&this.__onChange.call(this);this.__onFinishChange&&this.__onFinishChange.call(this,
this.getValue());this.getValue().call(this.object)}});return d}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);
dat.controllers.BooleanController=function(c,b,a){var d=function(a,c){d.superclass.call(this,a,c);var f=this;this.__prev=this.getValue();this.__checkbox=document.createElement("input");this.__checkbox.setAttribute("type","checkbox");b.bind(this.__checkbox,"change",function(){f.setValue(!f.__prev)},!1);this.domElement.appendChild(this.__checkbox);this.updateDisplay()};d.superclass=c;a.extend(d.prototype,c.prototype,{setValue:function(a){a=d.superclass.prototype.setValue.call(this,a);this.__onFinishChange&&
this.__onFinishChange.call(this,this.getValue());this.__prev=this.getValue();return a},updateDisplay:function(){!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0):this.__checkbox.checked=!1;return d.superclass.prototype.updateDisplay.call(this)}});return d}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);
dat.color.toString=function(c){return function(b){if(1==b.a||c.isUndefined(b.a)){for(b=b.hex.toString(16);6>b.length;)b="0"+b;return"#"+b}return"rgba("+Math.round(b.r)+","+Math.round(b.g)+","+Math.round(b.b)+","+b.a+")"}}(dat.utils.common);
dat.color.interpret=function(c,b){var a,d,e=[{litmus:b.isString,conversions:{THREE_CHAR_HEX:{read:function(a){a=a.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null===a?!1:{space:"HEX",hex:parseInt("0x"+a[1].toString()+a[1].toString()+a[2].toString()+a[2].toString()+a[3].toString()+a[3].toString())}},write:c},SIX_CHAR_HEX:{read:function(a){a=a.match(/^#([A-F0-9]{6})$/i);return null===a?!1:{space:"HEX",hex:parseInt("0x"+a[1].toString())}},write:c},CSS_RGB:{read:function(a){a=a.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);
return null===a?!1:{space:"RGB",r:parseFloat(a[1]),g:parseFloat(a[2]),b:parseFloat(a[3])}},write:c},CSS_RGBA:{read:function(a){a=a.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\,\s*(.+)\s*\)/);return null===a?!1:{space:"RGB",r:parseFloat(a[1]),g:parseFloat(a[2]),b:parseFloat(a[3]),a:parseFloat(a[4])}},write:c}}},{litmus:b.isNumber,conversions:{HEX:{read:function(a){return{space:"HEX",hex:a,conversionName:"HEX"}},write:function(a){return a.hex}}}},{litmus:b.isArray,conversions:{RGB_ARRAY:{read:function(a){return 3!=
a.length?!1:{space:"RGB",r:a[0],g:a[1],b:a[2]}},write:function(a){return[a.r,a.g,a.b]}},RGBA_ARRAY:{read:function(a){return 4!=a.length?!1:{space:"RGB",r:a[0],g:a[1],b:a[2],a:a[3]}},write:function(a){return[a.r,a.g,a.b,a.a]}}}},{litmus:b.isObject,conversions:{RGBA_OBJ:{read:function(a){return b.isNumber(a.r)&&b.isNumber(a.g)&&b.isNumber(a.b)&&b.isNumber(a.a)?{space:"RGB",r:a.r,g:a.g,b:a.b,a:a.a}:!1},write:function(a){return{r:a.r,g:a.g,b:a.b,a:a.a}}},RGB_OBJ:{read:function(a){return b.isNumber(a.r)&&
b.isNumber(a.g)&&b.isNumber(a.b)?{space:"RGB",r:a.r,g:a.g,b:a.b}:!1},write:function(a){return{r:a.r,g:a.g,b:a.b}}},HSVA_OBJ:{read:function(a){return b.isNumber(a.h)&&b.isNumber(a.s)&&b.isNumber(a.v)&&b.isNumber(a.a)?{space:"HSV",h:a.h,s:a.s,v:a.v,a:a.a}:!1},write:function(a){return{h:a.h,s:a.s,v:a.v,a:a.a}}},HSV_OBJ:{read:function(a){return b.isNumber(a.h)&&b.isNumber(a.s)&&b.isNumber(a.v)?{space:"HSV",h:a.h,s:a.s,v:a.v}:!1},write:function(a){return{h:a.h,s:a.s,v:a.v}}}}}];return function(){d=!1;
var c=1<arguments.length?b.toArray(arguments):arguments[0];b.each(e,function(e){if(e.litmus(c))return b.each(e.conversions,function(e,f){a=e.read(c);if(!1===d&&!1!==a)return d=a,a.conversionName=f,a.conversion=e,b.BREAK}),b.BREAK});return d}}(dat.color.toString,dat.utils.common);
dat.GUI=dat.gui.GUI=function(c,b,a,d,e,g,f,h,i,l,k,n,q,j,m){function r(a,b,c,f){if(void 0===b[c])throw Error("Object "+b+' has no property "'+c+'"');f.color?b=new k(b,c):(b=[b,c].concat(f.factoryArgs),b=d.apply(a,b));f.before instanceof e&&(f.before=f.before.__li);t(a,b);j.addClass(b.domElement,"c");c=document.createElement("span");j.addClass(c,"property-name");c.innerHTML=b.property;var g=document.createElement("div");g.appendChild(c);g.appendChild(b.domElement);f=s(a,g,f.before);j.addClass(f,o.CLASS_CONTROLLER_ROW);
j.addClass(f,typeof b.getValue());p(a,f,b);a.__controllers.push(b);return b}function s(a,b,c){var d=document.createElement("li");b&&d.appendChild(b);c?a.__ul.insertBefore(d,params.before):a.__ul.appendChild(d);a.onResize();return d}function p(a,b,c){c.__li=b;c.__gui=a;m.extend(c,{options:function(b){if(1<arguments.length)return c.remove(),r(a,c.object,c.property,{before:c.__li.nextElementSibling,factoryArgs:[m.toArray(arguments)]});if(m.isArray(b)||m.isObject(b))return c.remove(),r(a,c.object,c.property,
{before:c.__li.nextElementSibling,factoryArgs:[b]})},name:function(a){c.__li.firstElementChild.firstElementChild.innerHTML=a;return c},listen:function(){c.__gui.listen(c);return c},remove:function(){c.__gui.remove(c);return c}});if(c instanceof i){var d=new h(c.object,c.property,{min:c.__min,max:c.__max,step:c.__step});m.each(["updateDisplay","onChange","onFinishChange"],function(a){var b=c[a],e=d[a];c[a]=d[a]=function(){var a=Array.prototype.slice.call(arguments);b.apply(c,a);return e.apply(d,a)}});
j.addClass(b,"has-slider");c.domElement.insertBefore(d.domElement,c.domElement.firstElementChild)}else if(c instanceof h){var e=function(b){return m.isNumber(c.__min)&&m.isNumber(c.__max)?(c.remove(),r(a,c.object,c.property,{before:c.__li.nextElementSibling,factoryArgs:[c.__min,c.__max,c.__step]})):b};c.min=m.compose(e,c.min);c.max=m.compose(e,c.max)}else c instanceof g?(j.bind(b,"click",function(){j.fakeEvent(c.__checkbox,"click")}),j.bind(c.__checkbox,"click",function(a){a.stopPropagation()})):
c instanceof f?(j.bind(b,"click",function(){j.fakeEvent(c.__button,"click")}),j.bind(b,"mouseover",function(){j.addClass(c.__button,"hover")}),j.bind(b,"mouseout",function(){j.removeClass(c.__button,"hover")})):c instanceof k&&(j.addClass(b,"color"),c.updateDisplay=m.compose(function(a){b.style.borderLeftColor=c.__color.toString();return a},c.updateDisplay),c.updateDisplay());c.setValue=m.compose(function(b){a.getRoot().__preset_select&&c.isModified()&&A(a.getRoot(),!0);return b},c.setValue)}function t(a,
b){var c=a.getRoot(),d=c.__rememberedObjects.indexOf(b.object);if(-1!=d){var e=c.__rememberedObjectIndecesToControllers[d];void 0===e&&(e={},c.__rememberedObjectIndecesToControllers[d]=e);e[b.property]=b;if(c.load&&c.load.remembered){c=c.load.remembered;if(c[a.preset])c=c[a.preset];else if(c[w])c=c[w];else return;c[d]&&void 0!==c[d][b.property]&&(d=c[d][b.property],b.initialValue=d,b.setValue(d))}}}function G(a){var b=a.__save_row=document.createElement("li");j.addClass(a.domElement,"has-save");a.__ul.insertBefore(b,
a.__ul.firstChild);j.addClass(b,"save-row");var c=document.createElement("span");c.innerHTML="&nbsp;";j.addClass(c,"button gears");var d=document.createElement("span");d.innerHTML="Save";j.addClass(d,"button");j.addClass(d,"save");var e=document.createElement("span");e.innerHTML="New";j.addClass(e,"button");j.addClass(e,"save-as");var f=document.createElement("span");f.innerHTML="Revert";j.addClass(f,"button");j.addClass(f,"revert");var g=a.__preset_select=document.createElement("select");a.load&&
a.load.remembered?m.each(a.load.remembered,function(b,c){B(a,c,c==a.preset)}):B(a,w,!1);j.bind(g,"change",function(){for(var b=0;b<a.__preset_select.length;b++)a.__preset_select[b].innerHTML=a.__preset_select[b].value;a.preset=this.value});b.appendChild(g);b.appendChild(c);b.appendChild(d);b.appendChild(e);b.appendChild(f);if(u){var b=document.getElementById("dg-save-locally"),h=document.getElementById("dg-local-explain");b.style.display="block";b=document.getElementById("dg-local-storage");"true"===
localStorage.getItem(document.location.href+".isLocal")&&b.setAttribute("checked","checked");var l=function(){h.style.display=a.useLocalStorage?"block":"none"};l();j.bind(b,"change",function(){a.useLocalStorage=!a.useLocalStorage;l()})}var i=document.getElementById("dg-new-constructor");j.bind(i,"keydown",function(a){a.metaKey&&(67===a.which||67==a.keyCode)&&x.hide()});j.bind(c,"click",function(){i.innerHTML=JSON.stringify(a.getSaveObject(),void 0,2);x.show();i.focus();i.select()});j.bind(d,"click",
function(){a.save()});j.bind(e,"click",function(){var b=prompt("Enter a new preset name.");b&&a.saveAs(b)});j.bind(f,"click",function(){a.revert()})}function H(a){function b(f){f.preventDefault();e=f.clientX;j.addClass(a.__closeButton,o.CLASS_DRAG);j.bind(window,"mousemove",c);j.bind(window,"mouseup",d);return!1}function c(b){b.preventDefault();a.width+=e-b.clientX;a.onResize();e=b.clientX;return!1}function d(){j.removeClass(a.__closeButton,o.CLASS_DRAG);j.unbind(window,"mousemove",c);j.unbind(window,
"mouseup",d)}a.__resize_handle=document.createElement("div");m.extend(a.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});var e;j.bind(a.__resize_handle,"mousedown",b);j.bind(a.__closeButton,"mousedown",b);a.domElement.insertBefore(a.__resize_handle,a.domElement.firstElementChild)}function C(a,b){a.domElement.style.width=b+"px";a.__save_row&&a.autoPlace&&(a.__save_row.style.width=b+"px");a.__closeButton&&(a.__closeButton.style.width=b+"px")}
function y(a,b){var c={};m.each(a.__rememberedObjects,function(d,e){var f={};m.each(a.__rememberedObjectIndecesToControllers[e],function(a,c){f[c]=b?a.initialValue:a.getValue()});c[e]=f});return c}function B(a,b,c){var d=document.createElement("option");d.innerHTML=b;d.value=b;a.__preset_select.appendChild(d);c&&(a.__preset_select.selectedIndex=a.__preset_select.length-1)}function A(a,b){var c=a.__preset_select[a.__preset_select.selectedIndex];c.innerHTML=b?c.value+"*":c.value}function D(a){0!=a.length&&
n(function(){D(a)});m.each(a,function(a){a.updateDisplay()})}c.inject(a);var w="Default",u;try{u="localStorage"in window&&null!==window.localStorage}catch(I){u=!1}var x,E=!0,v,z=!1,F=[],o=function(a){function b(){localStorage.setItem(document.location.href+".gui",JSON.stringify(d.getSaveObject()))}function c(){var a=d.getRoot();a.width+=1;m.defer(function(){a.width-=1})}var d=this;this.domElement=document.createElement("div");this.__ul=document.createElement("ul");this.domElement.appendChild(this.__ul);
j.addClass(this.domElement,"dg");this.__folders={};this.__controllers=[];this.__rememberedObjects=[];this.__rememberedObjectIndecesToControllers=[];this.__listening=[];a=a||{};a=m.defaults(a,{autoPlace:!0,width:o.DEFAULT_WIDTH});a=m.defaults(a,{resizable:a.autoPlace,hideable:a.autoPlace});m.isUndefined(a.load)?a.load={preset:w}:a.preset&&(a.load.preset=a.preset);m.isUndefined(a.parent)&&a.hideable&&F.push(this);a.resizable=m.isUndefined(a.parent)&&a.resizable;a.autoPlace&&m.isUndefined(a.scrollable)&&
(a.scrollable=!0);var e=u&&"true"===localStorage.getItem(document.location.href+".isLocal");Object.defineProperties(this,{parent:{get:function(){return a.parent}},scrollable:{get:function(){return a.scrollable}},autoPlace:{get:function(){return a.autoPlace}},preset:{get:function(){return d.parent?d.getRoot().preset:a.load.preset},set:function(b){d.parent?d.getRoot().preset=b:a.load.preset=b;for(b=0;b<this.__preset_select.length;b++)if(this.__preset_select[b].value==this.preset)this.__preset_select.selectedIndex=
b;d.revert()}},width:{get:function(){return a.width},set:function(b){a.width=b;C(d,b)}},name:{get:function(){return a.name},set:function(b){a.name=b;if(g)g.innerHTML=a.name}},closed:{get:function(){return a.closed},set:function(b){a.closed=b;a.closed?j.addClass(d.__ul,o.CLASS_CLOSED):j.removeClass(d.__ul,o.CLASS_CLOSED);this.onResize();if(d.__closeButton)d.__closeButton.innerHTML=b?o.TEXT_OPEN:o.TEXT_CLOSED}},load:{get:function(){return a.load}},useLocalStorage:{get:function(){return e},set:function(a){if(u){(e=
a)?j.bind(window,"unload",b):j.unbind(window,"unload",b);localStorage.setItem(document.location.href+".isLocal",a)}}}});if(m.isUndefined(a.parent)){a.closed=!1;j.addClass(this.domElement,o.CLASS_MAIN);j.makeSelectable(this.domElement,!1);if(u&&e){d.useLocalStorage=!0;var f=localStorage.getItem(document.location.href+".gui");f&&(a.load=JSON.parse(f))}this.__closeButton=document.createElement("div");this.__closeButton.innerHTML=o.TEXT_CLOSED;j.addClass(this.__closeButton,o.CLASS_CLOSE_BUTTON);this.domElement.appendChild(this.__closeButton);
j.bind(this.__closeButton,"click",function(){d.closed=!d.closed})}else{void 0===a.closed&&(a.closed=!0);var g=document.createTextNode(a.name);j.addClass(g,"controller-name");f=s(d,g);j.addClass(this.__ul,o.CLASS_CLOSED);j.addClass(f,"title");j.bind(f,"click",function(a){a.preventDefault();d.closed=!d.closed;return false});a.closed||(this.closed=!1)}a.autoPlace&&(m.isUndefined(a.parent)&&(E&&(v=document.createElement("div"),j.addClass(v,"dg"),j.addClass(v,o.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(v),
E=!1),v.appendChild(this.domElement),j.addClass(this.domElement,o.CLASS_AUTO_PLACE)),this.parent||C(d,a.width));j.bind(window,"resize",function(){d.onResize()});j.bind(this.__ul,"webkitTransitionEnd",function(){d.onResize()});j.bind(this.__ul,"transitionend",function(){d.onResize()});j.bind(this.__ul,"oTransitionEnd",function(){d.onResize()});this.onResize();a.resizable&&H(this);d.getRoot();a.parent||c()};o.toggleHide=function(){z=!z;m.each(F,function(a){a.domElement.style.zIndex=z?-999:999;a.domElement.style.opacity=
z?0:1})};o.CLASS_AUTO_PLACE="a";o.CLASS_AUTO_PLACE_CONTAINER="ac";o.CLASS_MAIN="main";o.CLASS_CONTROLLER_ROW="cr";o.CLASS_TOO_TALL="taller-than-window";o.CLASS_CLOSED="closed";o.CLASS_CLOSE_BUTTON="close-button";o.CLASS_DRAG="drag";o.DEFAULT_WIDTH=245;o.TEXT_CLOSED="Close Controls";o.TEXT_OPEN="Open Controls";j.bind(window,"keydown",function(a){"text"!==document.activeElement.type&&(72===a.which||72==a.keyCode)&&o.toggleHide()},!1);m.extend(o.prototype,{add:function(a,b){return r(this,a,b,{factoryArgs:Array.prototype.slice.call(arguments,
2)})},addColor:function(a,b){return r(this,a,b,{color:!0})},remove:function(a){this.__ul.removeChild(a.__li);this.__controllers.slice(this.__controllers.indexOf(a),1);var b=this;m.defer(function(){b.onResize()})},destroy:function(){this.autoPlace&&v.removeChild(this.domElement)},addFolder:function(a){if(void 0!==this.__folders[a])throw Error('You already have a folder in this GUI by the name "'+a+'"');var b={name:a,parent:this};b.autoPlace=this.autoPlace;this.load&&(this.load.folders&&this.load.folders[a])&&
(b.closed=this.load.folders[a].closed,b.load=this.load.folders[a]);b=new o(b);this.__folders[a]=b;a=s(this,b.domElement);j.addClass(a,"folder");return b},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var a=this.getRoot();if(a.scrollable){var b=j.getOffset(a.__ul).top,c=0;m.each(a.__ul.childNodes,function(b){a.autoPlace&&b===a.__save_row||(c+=j.getHeight(b))});window.innerHeight-b-20<c?(j.addClass(a.domElement,o.CLASS_TOO_TALL),a.__ul.style.height=window.innerHeight-
b-20+"px"):(j.removeClass(a.domElement,o.CLASS_TOO_TALL),a.__ul.style.height="auto")}a.__resize_handle&&m.defer(function(){a.__resize_handle.style.height=a.__ul.offsetHeight+"px"});a.__closeButton&&(a.__closeButton.style.width=a.width+"px")},remember:function(){m.isUndefined(x)&&(x=new q,x.domElement.innerHTML=b);if(this.parent)throw Error("You can only call remember on a top level GUI.");var a=this;m.each(Array.prototype.slice.call(arguments),function(b){a.__rememberedObjects.length==0&&G(a);a.__rememberedObjects.indexOf(b)==
-1&&a.__rememberedObjects.push(b)});this.autoPlace&&C(this,this.width)},getRoot:function(){for(var a=this;a.parent;)a=a.parent;return a},getSaveObject:function(){var a=this.load;a.closed=this.closed;0<this.__rememberedObjects.length&&(a.preset=this.preset,a.remembered||(a.remembered={}),a.remembered[this.preset]=y(this));a.folders={};m.each(this.__folders,function(b,c){a.folders[c]=b.getSaveObject()});return a},save:function(){this.load.remembered||(this.load.remembered={});this.load.remembered[this.preset]=
y(this);A(this,!1)},saveAs:function(a){this.load.remembered||(this.load.remembered={},this.load.remembered[w]=y(this,!0));this.load.remembered[a]=y(this);this.preset=a;B(this,a,!0)},revert:function(a){m.each(this.__controllers,function(b){this.getRoot().load.remembered?t(a||this.getRoot(),b):b.setValue(b.initialValue)},this);m.each(this.__folders,function(a){a.revert(a)});a||A(this.getRoot(),!1)},listen:function(a){var b=0==this.__listening.length;this.__listening.push(a);b&&D(this.__listening)}});
return o}(dat.utils.css,'<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n      \n    </div>\n    \n  </div>\n\n</div>',
".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear;border:0;position:absolute;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-x:hidden}.dg.a.has-save ul{margin-top:27px}.dg.a.has-save ul.closed{margin-top:0}.dg.a .save-row{position:fixed;top:0;z-index:1002}.dg li{-webkit-transition:height 0.1s ease-out;-o-transition:height 0.1s ease-out;-moz-transition:height 0.1s ease-out;transition:height 0.1s ease-out}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;overflow:hidden;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li > *{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:9px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2fa1d6}.dg .cr.number input[type=text]{color:#2fa1d6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2fa1d6}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n",
dat.controllers.factory=function(c,b,a,d,e,g,f){return function(h,i,l,k){var n=h[i];if(f.isArray(l)||f.isObject(l))return new c(h,i,l);if(f.isNumber(n))return f.isNumber(l)&&f.isNumber(k)?new a(h,i,l,k):new b(h,i,{min:l,max:k});if(f.isString(n))return new d(h,i);if(f.isFunction(n))return new e(h,i,"");if(f.isBoolean(n))return new g(h,i)}}(dat.controllers.OptionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.StringController=function(c,b,a){var d=
function(a,c){function f(){h.setValue(h.__input.value)}d.superclass.call(this,a,c);var h=this;this.__input=document.createElement("input");this.__input.setAttribute("type","text");b.bind(this.__input,"keyup",f);b.bind(this.__input,"change",f);b.bind(this.__input,"blur",function(){h.__onFinishChange&&h.__onFinishChange.call(h,h.getValue())});b.bind(this.__input,"keydown",function(a){13===a.keyCode&&this.blur()});this.updateDisplay();this.domElement.appendChild(this.__input)};d.superclass=c;a.extend(d.prototype,
c.prototype,{updateDisplay:function(){b.isActive(this.__input)||(this.__input.value=this.getValue());return d.superclass.prototype.updateDisplay.call(this)}});return d}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.controllers.FunctionController,dat.controllers.BooleanController,dat.utils.common),dat.controllers.Controller,dat.controllers.BooleanController,dat.controllers.FunctionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.OptionController,
dat.controllers.ColorController=function(c,b,a,d,e){function g(a,b,c,d){a.style.background="";e.each(i,function(e){a.style.cssText+="background: "+e+"linear-gradient("+b+", "+c+" 0%, "+d+" 100%); "})}function f(a){a.style.background="";a.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);";a.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";
a.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";a.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";a.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var h=function(c,i){function n(a){r(a);b.bind(window,"mousemove",r);b.bind(window,
"mouseup",q)}function q(){b.unbind(window,"mousemove",r);b.unbind(window,"mouseup",q)}function j(){var a=d(this.value);!1!==a?(p.__color.__state=a,p.setValue(p.__color.toOriginal())):this.value=p.__color.toString()}function m(){b.unbind(window,"mousemove",s);b.unbind(window,"mouseup",m)}function r(a){a.preventDefault();var c=b.getWidth(p.__saturation_field),d=b.getOffset(p.__saturation_field),e=(a.clientX-d.left+document.body.scrollLeft)/c,a=1-(a.clientY-d.top+document.body.scrollTop)/c;1<a?a=1:0>
a&&(a=0);1<e?e=1:0>e&&(e=0);p.__color.v=a;p.__color.s=e;p.setValue(p.__color.toOriginal());return!1}function s(a){a.preventDefault();var c=b.getHeight(p.__hue_field),d=b.getOffset(p.__hue_field),a=1-(a.clientY-d.top+document.body.scrollTop)/c;1<a?a=1:0>a&&(a=0);p.__color.h=360*a;p.setValue(p.__color.toOriginal());return!1}h.superclass.call(this,c,i);this.__color=new a(this.getValue());this.__temp=new a(0);var p=this;this.domElement=document.createElement("div");b.makeSelectable(this.domElement,!1);
this.__selector=document.createElement("div");this.__selector.className="selector";this.__saturation_field=document.createElement("div");this.__saturation_field.className="saturation-field";this.__field_knob=document.createElement("div");this.__field_knob.className="field-knob";this.__field_knob_border="2px solid ";this.__hue_knob=document.createElement("div");this.__hue_knob.className="hue-knob";this.__hue_field=document.createElement("div");this.__hue_field.className="hue-field";this.__input=document.createElement("input");
this.__input.type="text";this.__input_textShadow="0 1px 1px ";b.bind(this.__input,"keydown",function(a){13===a.keyCode&&j.call(this)});b.bind(this.__input,"blur",j);b.bind(this.__selector,"mousedown",function(){b.addClass(this,"drag").bind(window,"mouseup",function(){b.removeClass(p.__selector,"drag")})});var t=document.createElement("div");e.extend(this.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"});e.extend(this.__field_knob.style,
{position:"absolute",width:"12px",height:"12px",border:this.__field_knob_border+(0.5>this.__color.v?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1});e.extend(this.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1});e.extend(this.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"});e.extend(t.style,{width:"100%",height:"100%",
background:"none"});g(t,"top","rgba(0,0,0,0)","#000");e.extend(this.__hue_field.style,{width:"15px",height:"100px",display:"inline-block",border:"1px solid #555",cursor:"ns-resize"});f(this.__hue_field);e.extend(this.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:this.__input_textShadow+"rgba(0,0,0,0.7)"});b.bind(this.__saturation_field,"mousedown",n);b.bind(this.__field_knob,"mousedown",n);b.bind(this.__hue_field,"mousedown",function(a){s(a);b.bind(window,
"mousemove",s);b.bind(window,"mouseup",m)});this.__saturation_field.appendChild(t);this.__selector.appendChild(this.__field_knob);this.__selector.appendChild(this.__saturation_field);this.__selector.appendChild(this.__hue_field);this.__hue_field.appendChild(this.__hue_knob);this.domElement.appendChild(this.__input);this.domElement.appendChild(this.__selector);this.updateDisplay()};h.superclass=c;e.extend(h.prototype,c.prototype,{updateDisplay:function(){var b=d(this.getValue());if(!1!==b){var c=!1;
e.each(a.COMPONENTS,function(a){if(!e.isUndefined(b[a])&&!e.isUndefined(this.__color.__state[a])&&b[a]!==this.__color.__state[a])return c=!0,{}},this);c&&e.extend(this.__color.__state,b)}e.extend(this.__temp.__state,this.__color.__state);this.__temp.a=1;var f=0.5>this.__color.v||0.5<this.__color.s?255:0,h=255-f;e.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toString(),border:this.__field_knob_border+"rgb("+
f+","+f+","+f+")"});this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px";this.__temp.s=1;this.__temp.v=1;g(this.__saturation_field,"left","#fff",this.__temp.toString());e.extend(this.__input.style,{backgroundColor:this.__input.value=this.__color.toString(),color:"rgb("+f+","+f+","+f+")",textShadow:this.__input_textShadow+"rgba("+h+","+h+","+h+",.7)"})}});var i=["-moz-","-o-","-webkit-","-ms-",""];return h}(dat.controllers.Controller,dat.dom.dom,dat.color.Color=function(c,b,a,d){function e(a,
b,c){Object.defineProperty(a,b,{get:function(){if("RGB"===this.__state.space)return this.__state[b];f(this,b,c);return this.__state[b]},set:function(a){"RGB"!==this.__state.space&&(f(this,b,c),this.__state.space="RGB");this.__state[b]=a}})}function g(a,b){Object.defineProperty(a,b,{get:function(){if("HSV"===this.__state.space)return this.__state[b];h(this);return this.__state[b]},set:function(a){"HSV"!==this.__state.space&&(h(this),this.__state.space="HSV");this.__state[b]=a}})}function f(a,c,e){if("HEX"===
a.__state.space)a.__state[c]=b.component_from_hex(a.__state.hex,e);else if("HSV"===a.__state.space)d.extend(a.__state,b.hsv_to_rgb(a.__state.h,a.__state.s,a.__state.v));else throw"Corrupted color state";}function h(a){var c=b.rgb_to_hsv(a.r,a.g,a.b);d.extend(a.__state,{s:c.s,v:c.v});d.isNaN(c.h)?d.isUndefined(a.__state.h)&&(a.__state.h=0):a.__state.h=c.h}var i=function(){this.__state=c.apply(this,arguments);if(!1===this.__state)throw"Failed to interpret color arguments";this.__state.a=this.__state.a||
1};i.COMPONENTS="r g b h s v hex a".split(" ");d.extend(i.prototype,{toString:function(){return a(this)},toOriginal:function(){return this.__state.conversion.write(this)}});e(i.prototype,"r",2);e(i.prototype,"g",1);e(i.prototype,"b",0);g(i.prototype,"h");g(i.prototype,"s");g(i.prototype,"v");Object.defineProperty(i.prototype,"a",{get:function(){return this.__state.a},set:function(a){this.__state.a=a}});Object.defineProperty(i.prototype,"hex",{get:function(){"HEX"!==!this.__state.space&&(this.__state.hex=
b.rgb_to_hex(this.r,this.g,this.b));return this.__state.hex},set:function(a){this.__state.space="HEX";this.__state.hex=a}});return i}(dat.color.interpret,dat.color.math=function(){var c;return{hsv_to_rgb:function(b,a,c){var e=b/60-Math.floor(b/60),g=c*(1-a),f=c*(1-e*a),a=c*(1-(1-e)*a),b=[[c,a,g],[f,c,g],[g,c,a],[g,f,c],[a,g,c],[c,g,f]][Math.floor(b/60)%6];return{r:255*b[0],g:255*b[1],b:255*b[2]}},rgb_to_hsv:function(b,a,c){var e=Math.min(b,a,c),g=Math.max(b,a,c),e=g-e;if(0==g)return{h:NaN,s:0,v:0};
b=(b==g?(a-c)/e:a==g?2+(c-b)/e:4+(b-a)/e)/6;0>b&&(b+=1);return{h:360*b,s:e/g,v:g/255}},rgb_to_hex:function(b,a,c){b=this.hex_with_component(0,2,b);b=this.hex_with_component(b,1,a);return b=this.hex_with_component(b,0,c)},component_from_hex:function(b,a){return b>>8*a&255},hex_with_component:function(b,a,d){return d<<(c=8*a)|b&~(255<<c)}}}(),dat.color.toString,dat.utils.common),dat.color.interpret,dat.utils.common),dat.utils.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||
window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(c){window.setTimeout(c,1E3/60)}}(),dat.dom.CenteredDiv=function(c,b){var a=function(){this.backgroundElement=document.createElement("div");b.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear"});c.makeFullscreen(this.backgroundElement);this.backgroundElement.style.position="fixed";this.domElement=
document.createElement("div");b.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear"});document.body.appendChild(this.backgroundElement);document.body.appendChild(this.domElement);var a=this;c.bind(this.backgroundElement,"click",function(){a.hide()})};a.prototype.show=function(){var a=this;this.backgroundElement.style.display="block";this.domElement.style.display="block";this.domElement.style.opacity=
0;this.domElement.style.webkitTransform="scale(1.1)";this.layout();b.defer(function(){a.backgroundElement.style.opacity=1;a.domElement.style.opacity=1;a.domElement.style.webkitTransform="scale(1)"})};a.prototype.hide=function(){var a=this,b=function(){a.domElement.style.display="none";a.backgroundElement.style.display="none";c.unbind(a.domElement,"webkitTransitionEnd",b);c.unbind(a.domElement,"transitionend",b);c.unbind(a.domElement,"oTransitionEnd",b)};c.bind(this.domElement,"webkitTransitionEnd",
b);c.bind(this.domElement,"transitionend",b);c.bind(this.domElement,"oTransitionEnd",b);this.backgroundElement.style.opacity=0;this.domElement.style.opacity=0;this.domElement.style.webkitTransform="scale(1.1)"};a.prototype.layout=function(){this.domElement.style.left=window.innerWidth/2-c.getWidth(this.domElement)/2+"px";this.domElement.style.top=window.innerHeight/2-c.getHeight(this.domElement)/2+"px"};return a}(dat.dom.dom,dat.utils.common),dat.dom.dom,dat.utils.common);
AugmentedGesture=function(c){this._opts=c||new AugmentedGesture.Options;AugmentedGesture.hasUserMedia||alert("Panic: no UserMedia");console.assert(AugmentedGesture.hasUserMedia,"no usermedia available");this._video=this._videoCtor();this._frameCount=0;this._canvas=c=document.createElement("canvas");c.width=this._video.width/4;c.height=this._video.height/4;this._pointersPos={}};AugmentedGesture.prototype.destroy=function(){this.stop();this.domElementRemove();this.statsRemove();this.disableDatGui()};
AugmentedGesture.hasUserMedia=navigator.webkitGetUserMedia?!0:!1;
AugmentedGesture.MicroeventMixin=function(c){c.bind=function(b,a){void 0===this._events&&(this._events={});this._events[b]=this._events[b]||[];this._events[b].push(a);return a};c.unbind=function(b,a){void 0===this._events&&(this._events={});!1!==b in this._events&&this._events[b].splice(this._events[b].indexOf(a),1)};c.trigger=function(b){void 0===this._events&&(this._events={});if(void 0!==this._events[b])for(var a=this._events[b].slice(),c=0;c<a.length;c++)a[c].apply(this,Array.prototype.slice.call(arguments,
1))}};AugmentedGesture.MicroeventMixin(AugmentedGesture.prototype);AugmentedGesture.prototype.start=function(){var c=function(){this._reqAnimId=requestAnimationFrame(c);this._update()}.bind(this);c();return this};AugmentedGesture.prototype.stop=function(){cancelAnimationFrame(this._reqAnimId);return this};AugmentedGesture.prototype.opts=function(){return this._opts};
AugmentedGesture.prototype.domElementFullpage=function(){var c=this.domElement();document.body.appendChild(c);c.style.position="absolute";c.style.top="0px";c.style.left="0px";c.style.width="100%";c.style.height="100%";return this};AugmentedGesture.prototype.domElementThumbnail=function(){var c=this.domElement();document.body.appendChild(c);c.style.position="absolute";c.style.top="0px";c.style.left="0px";c.style.width="320px";c.style.height="240px";return this};
AugmentedGesture.prototype.domElementRemove=function(){var c=this.domElement();c.parentNode&&c.parentNode.removeChild(c);return this};AugmentedGesture.prototype.statsInsert=function(){var c=this._stats=new Stats;c.getDomElement().style.position="absolute";c.getDomElement().style.left="0px";c.getDomElement().style.top="0px";document.body.appendChild(c.getDomElement());return this};
AugmentedGesture.prototype.statsRemove=function(){if(!this._stats)return this;var c=this._stats.getDomElement();c.parentNode&&c.parentNode.removeChild(c);this._stats=null;return this};AugmentedGesture.prototype._statsUpdate=function(){this._stats&&this._stats.update()};
AugmentedGesture.prototype.addPointer=function(c,b){console.assert(!this._pointersPos[c]);this._pointersPos[c]={x:this._canvas.width/2,y:this._canvas.height/2};console.assert(!this._opts.pointers[c]);this._opts.pointers[c]=b;this._datgui&&this._addDatGuiPointer(c)};AugmentedGesture.Options=function(){this.general={video:{w:80,h:60,frameRate:1}};this.pointers={}};
AugmentedGesture.OptionPointer=function(){this.pointer={display:!0,coordSmoothV:0.3,coordSmoothH:0.3,crossColor:{r:0,g:255,b:255}};this.disp={enable:!1,VHist:!1,HHist:!1,VLine:!1,HLine:!1};this.colorFilter={r:{min:0,max:255},g:{min:0,max:255},b:{min:0,max:255},minHist:{h:5,v:5}};this.smooth={vWidth:9,hWidth:9}};
AugmentedGesture.prototype.enableDatGui=function(){var c=this._opts;window.addEventListener("load",function(){var b=(this._datgui=new dat.GUI).addFolder("General");b.add(c.general.video,"w",0,320).step(40).name("videoW");b.add(c.general.video,"h",0,240).step(30).name("videoH");b.add(c.general.video,"frameRate",1,30).step(1);Object.keys(this._pointersPos).forEach(function(a){this._addDatGuiPointer(a)}.bind(this))}.bind(this));return this};
AugmentedGesture.prototype.disableDatGui=function(){this._datgui&&this._datgui.destroy()};
AugmentedGesture.prototype._addDatGuiPointer=function(c){console.assert(this._datgui);var b=this._opts.pointers[c],c=this._datgui.addFolder("Pointer: "+c),a=c.addFolder("Main");a.add(b.pointer,"display");a.add(b.pointer,"coordSmoothV",0,1);a.add(b.pointer,"coordSmoothH",0,1);a.add(b.pointer.crossColor,"r",0,255).name("Cross ColorR");a.add(b.pointer.crossColor,"g",0,255).name("Cross ColorG");a.add(b.pointer.crossColor,"b",0,255).name("Cross ColorB");a=c.addFolder("Display");a.add(b.disp,"enable");
a.add(b.disp,"HHist");a.add(b.disp,"VHist");a.add(b.disp,"HLine");a.add(b.disp,"VLine");a=c.addFolder("Threshold");a.open();a.add(b.colorFilter.r,"min",0,255).name("red min");a.add(b.colorFilter.r,"max",0,255).name("red max");a.add(b.colorFilter.g,"min",0,255).name("green min");a.add(b.colorFilter.g,"max",0,255).name("green max");a.add(b.colorFilter.b,"min",0,255).name("blue min");a.add(b.colorFilter.b,"max",0,255).name("blue max");a.add(b.colorFilter.minHist,"h",0,20).name("minHistH");a.add(b.colorFilter.minHist,
"v",0,20).name("minHistV");a.add(b.smooth,"hWidth",0,20).step(1);a.add(b.smooth,"vWidth",0,20).step(1)};AugmentedGesture.prototype.domElement=function(){return this._canvas};AugmentedGesture.prototype.pointers=function(){return this._pointersPos};
AugmentedGesture.prototype._videoCtor=function(){var c=document.createElement("video");c.width=320;c.height=240;c.autoplay=!0;navigator.webkitGetUserMedia("video",function(b){c.src=webkitURL.createObjectURL(b)},function(){alert("you got no WebRTC webcam")});return c};
AugmentedGesture.prototype._update=function(){function c(a,g){var c=ImgProc.duplicate(a,d),e=b.pointers[g];ImgProc.threshold(c,e.colorFilter.r,e.colorFilter.g,e.colorFilter.b);e.disp.enable&&ImgProc.copy(c,a);var f=ImgProc.computeHorizontalHistogram(c,function(a,g){return 0!==a[g+1]?!0:!1});ImgProc.windowedAverageHistogram(f,e.smooth.hWidth);var h=e.colorFilter.minHist.h;ImgProc.filterHistogram(f,function(a,g,b){b[g]=b[g]>=h?b[g]:0});var m=ImgProc.getMaxHistogram(f);e.disp.VHist&&ImgProc.displayHorizontalHistogram(a,
f);f=ImgProc.computeVerticalHistogram(c,function(a,g){return 0!==a[g+1]?!0:!1});ImgProc.windowedAverageHistogram(f,e.smooth.vWidth);h=e.colorFilter.minHist.v;ImgProc.filterHistogram(f,function(a,g,b){b[g]=b[g]>=h?b[g]:0});c=ImgProc.getMaxHistogram(f);e.disp.HHist&&ImgProc.displayVerticalHistogram(a,f);return{h:m,v:c}}var b=this._opts,a=this._canvas,d=a.getContext("2d");this._frameCount++;if(0===this._frameCount%b.general.video.frameRate&&this._video.readyState===this._video.HAVE_ENOUGH_DATA){this._statsUpdate();
a.width!=b.general.video.w&&(a.width=b.general.video.w);a.height!=b.general.video.h&&(a.height=b.general.video.h);var e=a.width,g=a.height;d.drawImage(this._video,0,0,a.width,a.height);var f=d.getImageData(0,0,a.width,a.height);ImgProc.fliph(f);var h=function(a){var d=b.pointers[a],h=c(f,a);d.disp.HLine&&ImgProc.hline(f,h.h.idx,0,255,0);d.disp.VLine&&ImgProc.vline(f,h.v.idx,0,255,0);if(h.h.max===0||h.v.max===0){if(this._pointersPos[a]!==null){this._pointersPos[a]=null;this.trigger("mouseup."+a)}}else{if(!this._pointersPos[a]){this._pointersPos[a]=
{x:h.h.idx/e,y:h.v.idx/g};this.trigger("mousedown."+a,this._pointersPos[a]);this.trigger("click."+a,this._pointersPos[a])}var n=this._pointersPos[a],q=n.x,j=n.y;n.x=n.x+(h.h.idx/e-n.x)*d.pointer.coordSmoothH;n.y=n.y+(h.v.idx/g-n.y)*d.pointer.coordSmoothV;if(d.pointer.display){d=d.pointer.crossColor;ImgProc.vline(f,Math.floor(n.x*e),d.r,d.g,d.b);ImgProc.hline(f,Math.floor(n.y*g),d.r,d.g,d.b)}(q!==n.x||j!==n.y)&&this.trigger("mousemove."+a,n)}}.bind(this);Object.keys(this._pointersPos).forEach(function(a){h(a)});
d.putImageData(f,0,0)}};AugmentedGesture.GestureRecognition=function(){this._lastEvent=null};AugmentedGesture.GestureRecognition.prototype.update=function(c,b,a){b=a/3;a=null;a=c<1*b?"left":c<2*b?"middle":"right";a===this._lastEvent?a=null:this._lastEvent=a;return a};
var ImgProc={fliph:function(c){for(var b=c.data,a=c.width,c=c.height,d,e=0;e<c;e++)for(var g=0;g<a/2;g++){var f=4*(g+e*a),h=4*(a-1-g+e*a);d=b[f+0];b[f+0]=b[h+0];b[h+0]=d;d=b[f+1];b[f+1]=b[h+1];b[h+1]=d;d=b[f+2];b[f+2]=b[h+2];b[h+2]=d;d=b[f+3];b[f+3]=b[h+3];b[h+3]=d}},luminance:function(c,b){for(var b=void 0!==b?b:1,a=c.data,d=c.width,e=c.height,g=0,f=0;f<e;f++)for(var h=0;h<d;h++,g+=4){var i=0.2126*(a[g+0]/255)+0.7152*(a[g+1]/255)+0.0722*(a[g+2]/255),i=Math.floor(255*i*b);a[g+0]=i;a[g+1]=i;a[g+2]=
i}},duplicate:function(c,b){return ImgProc.copy(c,b.createImageData(c))},copy:function(c,b){console.assert(c.width===b.width);console.assert(c.height===b.height);for(var a=c.data,d=b.data,e=0;e<a.length;e++)d[e]=a[e];return b},sobel:function(c,b){for(var a=c.data,d=c.width,e=c.height,g=b.data,f=[[-1,0,1],[-2,0,2],[-1,0,1]],h=[[-1,-2,-1],[0,0,0],[1,2,1]],i=function(a,g,b){g=4*g+4*b*d;return 0.3*a[g]+0.59*a[g+1]+0.11*a[g+2]},l=1;l<d-2;l++)for(var k=1;k<e-2;k++){var n=f[0][0]*i(a,l-1,k-1)+f[0][1]*i(a,
l,k-1)+f[0][2]*i(a,l+1,k-1)+f[1][0]*i(a,l-1,k)+f[1][1]*i(a,l,k)+f[1][2]*i(a,l+1,k)+f[2][0]*i(a,l-1,k+1)+f[2][1]*i(a,l,k+1)+f[2][2]*i(a,l+1,k+1),q=h[0][0]*i(a,l-1,k-1)+h[0][1]*i(a,l,k-1)+h[0][2]*i(a,l+1,k-1)+h[1][0]*i(a,l-1,k)+h[1][1]*i(a,l,k)+h[1][2]*i(a,l+1,k)+h[2][0]*i(a,l-1,k+1)+h[2][1]*i(a,l,k+1)+h[2][2]*i(a,l+1,k+1),n=Math.ceil(Math.sqrt(n*n+q*q)),q=4*k*d+4*l;g[q+0]=n;g[q+1]=n;g[q+2]=n}},threshold:function(c,b,a,d){for(var e=c.data,g=c.width,c=c.height,f=0,h=0;h<c;h++)for(var i=0;i<g;i++,f+=
4)if(!(e[f+0]>=b.min&&e[f+0]<=b.max)||!(e[f+1]>=a.min&&e[f+1]<=a.max)||!(e[f+2]>=d.min&&e[f+2]<=d.max))e[f+0]=e[f+1]=e[f+2]=0},convert:function(c,b){for(var a=c.data,d=c.width,e=c.height,g=0,f=0;f<e;f++)for(var h=0;h<d;h++,g+=4)b(a,g,h,f,c)},hline:function(c,b,a,d,e,g){for(var f=c.data,c=c.width,b=4*b*c,a=void 0!==a?a:255,d=void 0!==d?d:255,e=void 0!==e?e:255,g=void 0!==g?g:255,h=0;h<c;h++,b+=4)f[b+0]=a,f[b+1]=d,f[b+2]=e,f[b+3]=g},vline:function(c,b,a,d,e,g){for(var f=c.data,h=c.width,c=c.height,
a=void 0!==a?a:255,d=void 0!==d?d:255,e=void 0!==e?e:255,g=void 0!==g?g:255,b=4*b,i=0;i<c;i++,b+=4*h)f[b+0]=a,f[b+1]=d,f[b+2]=e,f[b+3]=g},smoothHistogram:function(c,b){for(var a=0,d=0;d<c.length;d++)a+=(c[d]-a)*b,c[d]=a},windowedAverageHistogram:function(c,b){for(var a=Math.floor(b/2),d=0,e=0,g=Array(c.length),f=0;f<c.length;f++)g[f]=c[f];for(f=0;f<a;f++)d+=c[f],e++;for(f=0;f<c.length;f++)f+a<c.length&&(d+=g[f+a],e++),0<=f-a&&(d-=g[f-a],e--),c[f]=d/e},getMaxHistogram:function(c){for(var b=-Number.MAX_VALUE,
a=0,d=0;d<c.length;d++)c[d]>b&&(b=c[d],a=d);return{max:b,idx:a}},filterHistogram:function(c,b){for(var a=0;a<c.length;a++)b(c[a],a,c)},computeHorizontalHistogram:function(c,b){var a=c.data,d=c.width,e=c.height,g=new Float64Array(d);console.assert(b,"invalid parameter");for(var f=0;f<d;f++)for(var h=4*f,i=0;i<e;i++,h+=4*d)b(a,h,f,i,c)&&g[f]++;return g},displayHorizontalHistogram:function(c,b){var a=c.width,d=c.height;console.assert(b.length===a);var e=document.createElement("canvas");e.width=a;e.height=
d;var g=e.getContext("2d");g.fillStyle="red";for(var f=0;f<a;f++)g.fillRect(f,d-b[f],1,b[f]);a=g.getImageData(0,0,e.width,e.height).data;d=c.data;for(e=0;e<a.length;e+=4){if(0!==a[e+0]||0!==a[e+1]||0!==a[e+2])d[e+0]=a[e+0],d[e+1]=a[e+1],d[e+2]=a[e+2];d[e+3]=255}},computeVerticalHistogram:function(c,b){var a=c.data,d=c.width,e=c.height,g=new Float64Array(e);console.assert(b,"invalid parameter");for(var f=0,h=0;h<e;h++)for(var i=0;i<d;i++,f+=4)b(a,f,i,h,c)&&g[h]++;return g},displayVerticalHistogram:function(c,
b){var a=c.width,d=c.height;console.assert(b.length===d);var e=document.createElement("canvas");e.width=a;e.height=d;a=e.getContext("2d");a.fillStyle="red";for(var g=0;g<d;g++)a.fillRect(0,g,b[g],1);d=a.getImageData(0,0,e.width,e.height).data;e=c.data;for(a=0;a<d.length;a+=4){if(0!==d[a+0]||0!==d[a+1]||0!==d[a+2])e[a+0]=d[a+0],e[a+1]=d[a+1],e[a+2]=d[a+2];e[a+3]=255}},computeColorHistogram:function(c){for(var b=c.data,a=c.width,c=c.height,d={r:new Float64Array(256),g:new Float64Array(256),b:new Float64Array(256)},
e=0,g=0;g<c;g++)for(var f=0;f<a;f++,e+=4)d.r[b[e+0]]++,d.g[b[e+1]]++,d.b[b[e+2]]++;return d},normalizeColorHistogram:function(c){for(var b=-Number.MAX_VALUE,a=0;256>a;a++)b=Math.max(b,c.r[a]),b=Math.max(b,c.g[a]),b=Math.max(b,c.b[a]);for(a=0;256>a;a++)c.r[a]/=b,c.g[a]/=b,c.b[a]/=b;for(var d=0,e=0,g=0,a=0;256>a;a++)d+=c.r[a],e+=c.g[a],g+=c.b[a];console.log("sum",b,d,e,g)},displayColorHistogram:function(c,b){var a=c.width,d=c.height,e=document.createElement("canvas");e.width=a;e.height=d;var d=e.getContext("2d"),
g=e.width/256,f=e.height/3;d.fillStyle="red";for(var h=0*f,a=0;256>a;a++){var i=Math.floor(b.r[a]*f);d.fillRect(a*g,h+(f-i),g,i)}d.fillStyle="green";h=1*f;for(a=0;256>a;a++)i=Math.floor(b.g[a]*f),d.fillRect(a*g,h+(f-i),g,i);d.fillStyle="blue";h=2*f;for(a=0;256>a;a++)i=Math.floor(b.b[a]*f),d.fillRect(a*g,h+(f-i),g,i);e=d.getImageData(0,0,e.width,e.height).data;d=c.data;for(a=0;a<e.length;a+=4)if(0!==e[a+0]||0!==e[a+1]||0!==e[a+2])d[a+0]=e[a+0],d[a+1]=e[a+1],d[a+2]=e[a+2]}};
(function(){for(var c=0,b=["ms","moz","webkit","o"],a=0;a<b.length&&!window.requestAnimationFrame;++a)window.requestAnimationFrame=window[b[a]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[a]+"CancelAnimationFrame"]||window[b[a]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(a){var b=(new Date).getTime(),g=Math.max(0,16-(b-c)),f=window.setTimeout(function(){a(b+g)},g);c=b+g;return f});window.cancelAnimationFrame||(window.cancelAnimationFrame=
function(a){clearTimeout(a)})})();var dat=dat||{};dat.gui=dat.gui||{};dat.utils=dat.utils||{};dat.controllers=dat.controllers||{};dat.dom=dat.dom||{};dat.color=dat.color||{};dat.utils.css=function(){return{load:function(c,b){var b=b||document,a=b.createElement("link");a.type="text/css";a.rel="stylesheet";a.href=c;b.getElementsByTagName("head")[0].appendChild(a)},inject:function(c,b){var b=b||document,a=document.createElement("style");a.type="text/css";a.innerHTML=c;b.getElementsByTagName("head")[0].appendChild(a)}}}();
dat.utils.common=function(){var c=Array.prototype.forEach,b=Array.prototype.slice;return{BREAK:{},extend:function(a){this.each(b.call(arguments,1),function(b){for(var c in b)this.isUndefined(b[c])||(a[c]=b[c])},this);return a},defaults:function(a){this.each(b.call(arguments,1),function(b){for(var c in b)this.isUndefined(a[c])&&(a[c]=b[c])},this);return a},compose:function(){var a=b.call(arguments);return function(){for(var c=b.call(arguments),e=a.length-1;0<=e;e--)c=[a[e].apply(this,c)];return c[0]}},
each:function(a,b,e){if(c&&a.forEach===c)a.forEach(b,e);else if(a.length===a.length+0)for(var g=0,f=a.length;g<f&&!(g in a&&b.call(e,a[g],g)===this.BREAK);g++);else for(g in a)if(b.call(e,a[g],g)===this.BREAK)break},defer:function(a){setTimeout(a,0)},toArray:function(a){return a.toArray?a.toArray():b.call(a)},isUndefined:function(a){return void 0===a},isNull:function(a){return null===a},isNaN:function(a){return a!==a},isArray:Array.isArray||function(a){return a.constructor===Array},isObject:function(a){return a===
Object(a)},isNumber:function(a){return a===a+0},isString:function(a){return a===a+""},isBoolean:function(a){return!1===a||!0===a},isFunction:function(a){return"[object Function]"===Object.prototype.toString.call(a)}}}();
dat.controllers.Controller=function(c){var b=function(a,b){this.initialValue=a[b];this.domElement=document.createElement("div");this.object=a;this.property=b;this.__onFinishChange=this.__onChange=void 0};c.extend(b.prototype,{onChange:function(a){this.__onChange=a;return this},onFinishChange:function(a){this.__onFinishChange=a;return this},setValue:function(a){this.object[this.property]=a;this.__onChange&&this.__onChange.call(this,a);this.updateDisplay();return this},getValue:function(){return this.object[this.property]},
updateDisplay:function(){return this},isModified:function(){return this.initialValue!==this.getValue()}});return b}(dat.utils.common);
dat.dom.dom=function(c){function b(a){if("0"===a||c.isUndefined(a))return 0;a=a.match(d);return!c.isNull(a)?parseFloat(a[1]):0}var a={};c.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(b,d){c.each(b,function(b){a[b]=d})});var d=/(\d+(\.\d+)?)px/,e={makeSelectable:function(a,b){void 0===a||void 0===a.style||(a.onselectstart=b?function(){return!1}:function(){},a.style.MozUserSelect=b?"auto":"none",a.style.KhtmlUserSelect=
b?"auto":"none",a.unselectable=b?"on":"off")},makeFullscreen:function(a,b,d){c.isUndefined(b)&&(b=!0);c.isUndefined(d)&&(d=!0);a.style.position="absolute";b&&(a.style.left=0,a.style.right=0);d&&(a.style.top=0,a.style.bottom=0)},fakeEvent:function(b,d,e,i){var e=e||{},l=a[d];if(!l)throw Error("Event type "+d+" not supported.");var k=document.createEvent(l);switch(l){case "MouseEvents":k.initMouseEvent(d,e.bubbles||!1,e.cancelable||!0,window,e.clickCount||1,0,0,e.x||e.clientX||0,e.y||e.clientY||0,!1,
!1,!1,!1,0,null);break;case "KeyboardEvents":l=k.initKeyboardEvent||k.initKeyEvent;c.defaults(e,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0});l(d,e.bubbles||!1,e.cancelable,window,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.keyCode,e.charCode);break;default:k.initEvent(d,e.bubbles||!1,e.cancelable||!0)}c.defaults(k,i);b.dispatchEvent(k)},bind:function(a,b,c,d){a.addEventListener?a.addEventListener(b,c,d||!1):a.attachEvent&&a.attachEvent("on"+b,c);return e},
unbind:function(a,b,c,d){a.removeEventListener?a.removeEventListener(b,c,d||!1):a.detachEvent&&a.detachEvent("on"+b,c);return e},addClass:function(a,b){if(void 0===a.className)a.className=b;else if(a.className!==b){var c=a.className.split(/ +/);-1==c.indexOf(b)&&(c.push(b),a.className=c.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return e},removeClass:function(a,b){if(b){if(void 0!==a.className)if(a.className===b)a.removeAttribute("class");else{var c=a.className.split(/ +/),d=c.indexOf(b);-1!=
d&&(c.splice(d,1),a.className=c.join(" "))}}else a.className=void 0;return e},hasClass:function(a,b){return RegExp("(?:^|\\s+)"+b+"(?:\\s+|$)").test(a.className)||!1},getWidth:function(a){a=getComputedStyle(a);return b(a["border-left-width"])+b(a["border-right-width"])+b(a["padding-left"])+b(a["padding-right"])+b(a.width)},getHeight:function(a){a=getComputedStyle(a);return b(a["border-top-width"])+b(a["border-bottom-width"])+b(a["padding-top"])+b(a["padding-bottom"])+b(a.height)},getOffset:function(a){var b=
{left:0,top:0};if(a.offsetParent){do b.left+=a.offsetLeft,b.top+=a.offsetTop;while(a=a.offsetParent)}return b},isActive:function(a){return a===document.activeElement&&(a.type||a.href)}};return e}(dat.utils.common);
dat.controllers.OptionController=function(c,b,a){var d=function(c,g,f){d.superclass.call(this,c,g);var h=this;this.__select=document.createElement("select");if(a.isArray(f)){var i={};a.each(f,function(a){i[a]=a});f=i}a.each(f,function(a,b){var c=document.createElement("option");c.innerHTML=b;c.setAttribute("value",a);h.__select.appendChild(c)});this.updateDisplay();b.bind(this.__select,"change",function(){h.setValue(this.options[this.selectedIndex].value)});this.domElement.appendChild(this.__select)};
d.superclass=c;a.extend(d.prototype,c.prototype,{setValue:function(a){a=d.superclass.prototype.setValue.call(this,a);this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue());return a},updateDisplay:function(){this.__select.value=this.getValue();return d.superclass.prototype.updateDisplay.call(this)}});return d}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);
dat.controllers.NumberController=function(c,b){var a=function(c,e,g){a.superclass.call(this,c,e);g=g||{};this.__min=g.min;this.__max=g.max;this.__step=g.step;this.__impliedStep=b.isUndefined(this.__step)?0==this.initialValue?1:Math.pow(10,Math.floor(Math.log(this.initialValue)/Math.LN10))/10:this.__step;c=this.__impliedStep;c=c.toString();c=-1<c.indexOf(".")?c.length-c.indexOf(".")-1:0;this.__precision=c};a.superclass=c;b.extend(a.prototype,c.prototype,{setValue:function(b){void 0!==this.__min&&b<
this.__min?b=this.__min:void 0!==this.__max&&b>this.__max&&(b=this.__max);void 0!==this.__step&&0!=b%this.__step&&(b=Math.round(b/this.__step)*this.__step);return a.superclass.prototype.setValue.call(this,b)},min:function(a){this.__min=a;return this},max:function(a){this.__max=a;return this},step:function(a){this.__step=a;return this}});return a}(dat.controllers.Controller,dat.utils.common);
dat.controllers.NumberControllerBox=function(c,b,a){var d=function(c,g,f){function h(){var b=parseFloat(k.__input.value);a.isNaN(b)||k.setValue(b)}function i(a){var b=n-a.clientY;k.setValue(k.getValue()+b*k.__impliedStep);n=a.clientY}function l(){b.unbind(window,"mousemove",i);b.unbind(window,"mouseup",l)}this.__truncationSuspended=!1;d.superclass.call(this,c,g,f);var k=this,n;this.__input=document.createElement("input");this.__input.setAttribute("type","text");b.bind(this.__input,"change",h);b.bind(this.__input,
"blur",function(){h();k.__onFinishChange&&k.__onFinishChange.call(k,k.getValue())});b.bind(this.__input,"mousedown",function(a){b.bind(window,"mousemove",i);b.bind(window,"mouseup",l);n=a.clientY});b.bind(this.__input,"keydown",function(a){13===a.keyCode&&(k.__truncationSuspended=!0,this.blur(),k.__truncationSuspended=!1)});this.updateDisplay();this.domElement.appendChild(this.__input)};d.superclass=c;a.extend(d.prototype,c.prototype,{updateDisplay:function(){var a=this.__input,b;if(this.__truncationSuspended)b=
this.getValue();else{b=this.getValue();var c=Math.pow(10,this.__precision);b=Math.round(b*c)/c}a.value=b;return d.superclass.prototype.updateDisplay.call(this)}});return d}(dat.controllers.NumberController,dat.dom.dom,dat.utils.common);
dat.controllers.NumberControllerSlider=function(c,b,a,d,e){var g=function(a,c,d,e,k){function n(a){a.preventDefault();var c=b.getOffset(j.__background),g=b.getWidth(j.__background);j.setValue(j.__min+(j.__max-j.__min)*((a.clientX-c.left)/(c.left+g-c.left)));return!1}function q(){b.unbind(window,"mousemove",n);b.unbind(window,"mouseup",q);j.__onFinishChange&&j.__onFinishChange.call(j,j.getValue())}g.superclass.call(this,a,c,{min:d,max:e,step:k});var j=this;this.__background=document.createElement("div");
this.__foreground=document.createElement("div");b.bind(this.__background,"mousedown",function(a){b.bind(window,"mousemove",n);b.bind(window,"mouseup",q);n(a)});b.addClass(this.__background,"slider");b.addClass(this.__foreground,"slider-fg");this.updateDisplay();this.__background.appendChild(this.__foreground);this.domElement.appendChild(this.__background)};g.superclass=c;g.useDefaultStyles=function(){a.inject(e)};d.extend(g.prototype,c.prototype,{updateDisplay:function(){this.__foreground.style.width=
100*((this.getValue()-this.__min)/(this.__max-this.__min))+"%";return g.superclass.prototype.updateDisplay.call(this)}});return g}(dat.controllers.NumberController,dat.dom.dom,dat.utils.css,dat.utils.common,".slider {\n  box-shadow: inset 0 2px 4px rgba(0,0,0,0.15);\n  height: 1em;\n  border-radius: 1em;\n  background-color: #eee;\n  padding: 0 0.5em;\n  overflow: hidden;\n}\n\n.slider-fg {\n  padding: 1px 0 2px 0;\n  background-color: #aaa;\n  height: 1em;\n  margin-left: -0.5em;\n  padding-right: 0.5em;\n  border-radius: 1em 0 0 1em;\n}\n\n.slider-fg:after {\n  display: inline-block;\n  border-radius: 1em;\n  background-color: #fff;\n  border:  1px solid #aaa;\n  content: '';\n  float: right;\n  margin-right: -1em;\n  margin-top: -1px;\n  height: 0.9em;\n  width: 0.9em;\n}");
dat.controllers.FunctionController=function(c,b,a){var d=function(a,c,f){d.superclass.call(this,a,c);var h=this;this.__button=document.createElement("div");this.__button.innerHTML=void 0===f?"Fire":f;b.bind(this.__button,"click",function(a){a.preventDefault();h.fire();return!1});b.addClass(this.__button,"button");this.domElement.appendChild(this.__button)};d.superclass=c;a.extend(d.prototype,c.prototype,{fire:function(){this.__onChange&&this.__onChange.call(this);this.__onFinishChange&&this.__onFinishChange.call(this,
this.getValue());this.getValue().call(this.object)}});return d}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);
dat.controllers.BooleanController=function(c,b,a){var d=function(a,c){d.superclass.call(this,a,c);var f=this;this.__prev=this.getValue();this.__checkbox=document.createElement("input");this.__checkbox.setAttribute("type","checkbox");b.bind(this.__checkbox,"change",function(){f.setValue(!f.__prev)},!1);this.domElement.appendChild(this.__checkbox);this.updateDisplay()};d.superclass=c;a.extend(d.prototype,c.prototype,{setValue:function(a){a=d.superclass.prototype.setValue.call(this,a);this.__onFinishChange&&
this.__onFinishChange.call(this,this.getValue());this.__prev=this.getValue();return a},updateDisplay:function(){!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0):this.__checkbox.checked=!1;return d.superclass.prototype.updateDisplay.call(this)}});return d}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);
dat.color.toString=function(c){return function(b){if(1==b.a||c.isUndefined(b.a)){for(b=b.hex.toString(16);6>b.length;)b="0"+b;return"#"+b}return"rgba("+Math.round(b.r)+","+Math.round(b.g)+","+Math.round(b.b)+","+b.a+")"}}(dat.utils.common);
dat.color.interpret=function(c,b){var a,d,e=[{litmus:b.isString,conversions:{THREE_CHAR_HEX:{read:function(a){a=a.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null===a?!1:{space:"HEX",hex:parseInt("0x"+a[1].toString()+a[1].toString()+a[2].toString()+a[2].toString()+a[3].toString()+a[3].toString())}},write:c},SIX_CHAR_HEX:{read:function(a){a=a.match(/^#([A-F0-9]{6})$/i);return null===a?!1:{space:"HEX",hex:parseInt("0x"+a[1].toString())}},write:c},CSS_RGB:{read:function(a){a=a.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);
return null===a?!1:{space:"RGB",r:parseFloat(a[1]),g:parseFloat(a[2]),b:parseFloat(a[3])}},write:c},CSS_RGBA:{read:function(a){a=a.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\,\s*(.+)\s*\)/);return null===a?!1:{space:"RGB",r:parseFloat(a[1]),g:parseFloat(a[2]),b:parseFloat(a[3]),a:parseFloat(a[4])}},write:c}}},{litmus:b.isNumber,conversions:{HEX:{read:function(a){return{space:"HEX",hex:a,conversionName:"HEX"}},write:function(a){return a.hex}}}},{litmus:b.isArray,conversions:{RGB_ARRAY:{read:function(a){return 3!=
a.length?!1:{space:"RGB",r:a[0],g:a[1],b:a[2]}},write:function(a){return[a.r,a.g,a.b]}},RGBA_ARRAY:{read:function(a){return 4!=a.length?!1:{space:"RGB",r:a[0],g:a[1],b:a[2],a:a[3]}},write:function(a){return[a.r,a.g,a.b,a.a]}}}},{litmus:b.isObject,conversions:{RGBA_OBJ:{read:function(a){return b.isNumber(a.r)&&b.isNumber(a.g)&&b.isNumber(a.b)&&b.isNumber(a.a)?{space:"RGB",r:a.r,g:a.g,b:a.b,a:a.a}:!1},write:function(a){return{r:a.r,g:a.g,b:a.b,a:a.a}}},RGB_OBJ:{read:function(a){return b.isNumber(a.r)&&
b.isNumber(a.g)&&b.isNumber(a.b)?{space:"RGB",r:a.r,g:a.g,b:a.b}:!1},write:function(a){return{r:a.r,g:a.g,b:a.b}}},HSVA_OBJ:{read:function(a){return b.isNumber(a.h)&&b.isNumber(a.s)&&b.isNumber(a.v)&&b.isNumber(a.a)?{space:"HSV",h:a.h,s:a.s,v:a.v,a:a.a}:!1},write:function(a){return{h:a.h,s:a.s,v:a.v,a:a.a}}},HSV_OBJ:{read:function(a){return b.isNumber(a.h)&&b.isNumber(a.s)&&b.isNumber(a.v)?{space:"HSV",h:a.h,s:a.s,v:a.v}:!1},write:function(a){return{h:a.h,s:a.s,v:a.v}}}}}];return function(){d=!1;
var c=1<arguments.length?b.toArray(arguments):arguments[0];b.each(e,function(e){if(e.litmus(c))return b.each(e.conversions,function(e,f){a=e.read(c);if(!1===d&&!1!==a)return d=a,a.conversionName=f,a.conversion=e,b.BREAK}),b.BREAK});return d}}(dat.color.toString,dat.utils.common);
dat.GUI=dat.gui.GUI=function(c,b,a,d,e,g,f,h,i,l,k,n,q,j,m){function r(a,b,c,f){if(void 0===b[c])throw Error("Object "+b+' has no property "'+c+'"');f.color?b=new k(b,c):(b=[b,c].concat(f.factoryArgs),b=d.apply(a,b));f.before instanceof e&&(f.before=f.before.__li);t(a,b);j.addClass(b.domElement,"c");c=document.createElement("span");j.addClass(c,"property-name");c.innerHTML=b.property;var g=document.createElement("div");g.appendChild(c);g.appendChild(b.domElement);f=s(a,g,f.before);j.addClass(f,o.CLASS_CONTROLLER_ROW);
j.addClass(f,typeof b.getValue());p(a,f,b);a.__controllers.push(b);return b}function s(a,b,c){var d=document.createElement("li");b&&d.appendChild(b);c?a.__ul.insertBefore(d,params.before):a.__ul.appendChild(d);a.onResize();return d}function p(a,b,c){c.__li=b;c.__gui=a;m.extend(c,{options:function(b){if(1<arguments.length)return c.remove(),r(a,c.object,c.property,{before:c.__li.nextElementSibling,factoryArgs:[m.toArray(arguments)]});if(m.isArray(b)||m.isObject(b))return c.remove(),r(a,c.object,c.property,
{before:c.__li.nextElementSibling,factoryArgs:[b]})},name:function(a){c.__li.firstElementChild.firstElementChild.innerHTML=a;return c},listen:function(){c.__gui.listen(c);return c},remove:function(){c.__gui.remove(c);return c}});if(c instanceof i){var d=new h(c.object,c.property,{min:c.__min,max:c.__max,step:c.__step});m.each(["updateDisplay","onChange","onFinishChange"],function(a){var b=c[a],e=d[a];c[a]=d[a]=function(){var a=Array.prototype.slice.call(arguments);b.apply(c,a);return e.apply(d,a)}});
j.addClass(b,"has-slider");c.domElement.insertBefore(d.domElement,c.domElement.firstElementChild)}else if(c instanceof h){var e=function(b){return m.isNumber(c.__min)&&m.isNumber(c.__max)?(c.remove(),r(a,c.object,c.property,{before:c.__li.nextElementSibling,factoryArgs:[c.__min,c.__max,c.__step]})):b};c.min=m.compose(e,c.min);c.max=m.compose(e,c.max)}else c instanceof g?(j.bind(b,"click",function(){j.fakeEvent(c.__checkbox,"click")}),j.bind(c.__checkbox,"click",function(a){a.stopPropagation()})):
c instanceof f?(j.bind(b,"click",function(){j.fakeEvent(c.__button,"click")}),j.bind(b,"mouseover",function(){j.addClass(c.__button,"hover")}),j.bind(b,"mouseout",function(){j.removeClass(c.__button,"hover")})):c instanceof k&&(j.addClass(b,"color"),c.updateDisplay=m.compose(function(a){b.style.borderLeftColor=c.__color.toString();return a},c.updateDisplay),c.updateDisplay());c.setValue=m.compose(function(b){a.getRoot().__preset_select&&c.isModified()&&A(a.getRoot(),!0);return b},c.setValue)}function t(a,
b){var c=a.getRoot(),d=c.__rememberedObjects.indexOf(b.object);if(-1!=d){var e=c.__rememberedObjectIndecesToControllers[d];void 0===e&&(e={},c.__rememberedObjectIndecesToControllers[d]=e);e[b.property]=b;if(c.load&&c.load.remembered){c=c.load.remembered;if(c[a.preset])c=c[a.preset];else if(c[w])c=c[w];else return;c[d]&&void 0!==c[d][b.property]&&(d=c[d][b.property],b.initialValue=d,b.setValue(d))}}}function G(a){var b=a.__save_row=document.createElement("li");j.addClass(a.domElement,"has-save");a.__ul.insertBefore(b,
a.__ul.firstChild);j.addClass(b,"save-row");var c=document.createElement("span");c.innerHTML="&nbsp;";j.addClass(c,"button gears");var d=document.createElement("span");d.innerHTML="Save";j.addClass(d,"button");j.addClass(d,"save");var e=document.createElement("span");e.innerHTML="New";j.addClass(e,"button");j.addClass(e,"save-as");var f=document.createElement("span");f.innerHTML="Revert";j.addClass(f,"button");j.addClass(f,"revert");var g=a.__preset_select=document.createElement("select");a.load&&
a.load.remembered?m.each(a.load.remembered,function(b,c){B(a,c,c==a.preset)}):B(a,w,!1);j.bind(g,"change",function(){for(var b=0;b<a.__preset_select.length;b++)a.__preset_select[b].innerHTML=a.__preset_select[b].value;a.preset=this.value});b.appendChild(g);b.appendChild(c);b.appendChild(d);b.appendChild(e);b.appendChild(f);if(u){var b=document.getElementById("dg-save-locally"),h=document.getElementById("dg-local-explain");b.style.display="block";b=document.getElementById("dg-local-storage");"true"===
localStorage.getItem(document.location.href+".isLocal")&&b.setAttribute("checked","checked");var l=function(){h.style.display=a.useLocalStorage?"block":"none"};l();j.bind(b,"change",function(){a.useLocalStorage=!a.useLocalStorage;l()})}var i=document.getElementById("dg-new-constructor");j.bind(i,"keydown",function(a){a.metaKey&&(67===a.which||67==a.keyCode)&&x.hide()});j.bind(c,"click",function(){i.innerHTML=JSON.stringify(a.getSaveObject(),void 0,2);x.show();i.focus();i.select()});j.bind(d,"click",
function(){a.save()});j.bind(e,"click",function(){var b=prompt("Enter a new preset name.");b&&a.saveAs(b)});j.bind(f,"click",function(){a.revert()})}function H(a){function b(f){f.preventDefault();e=f.clientX;j.addClass(a.__closeButton,o.CLASS_DRAG);j.bind(window,"mousemove",c);j.bind(window,"mouseup",d);return!1}function c(b){b.preventDefault();a.width+=e-b.clientX;a.onResize();e=b.clientX;return!1}function d(){j.removeClass(a.__closeButton,o.CLASS_DRAG);j.unbind(window,"mousemove",c);j.unbind(window,
"mouseup",d)}a.__resize_handle=document.createElement("div");m.extend(a.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});var e;j.bind(a.__resize_handle,"mousedown",b);j.bind(a.__closeButton,"mousedown",b);a.domElement.insertBefore(a.__resize_handle,a.domElement.firstElementChild)}function C(a,b){a.domElement.style.width=b+"px";a.__save_row&&a.autoPlace&&(a.__save_row.style.width=b+"px");a.__closeButton&&(a.__closeButton.style.width=b+"px")}
function y(a,b){var c={};m.each(a.__rememberedObjects,function(d,e){var f={};m.each(a.__rememberedObjectIndecesToControllers[e],function(a,c){f[c]=b?a.initialValue:a.getValue()});c[e]=f});return c}function B(a,b,c){var d=document.createElement("option");d.innerHTML=b;d.value=b;a.__preset_select.appendChild(d);c&&(a.__preset_select.selectedIndex=a.__preset_select.length-1)}function A(a,b){var c=a.__preset_select[a.__preset_select.selectedIndex];c.innerHTML=b?c.value+"*":c.value}function D(a){0!=a.length&&
n(function(){D(a)});m.each(a,function(a){a.updateDisplay()})}c.inject(a);var w="Default",u;try{u="localStorage"in window&&null!==window.localStorage}catch(I){u=!1}var x,E=!0,v,z=!1,F=[],o=function(a){function b(){localStorage.setItem(document.location.href+".gui",JSON.stringify(d.getSaveObject()))}function c(){var a=d.getRoot();a.width+=1;m.defer(function(){a.width-=1})}var d=this;this.domElement=document.createElement("div");this.__ul=document.createElement("ul");this.domElement.appendChild(this.__ul);
j.addClass(this.domElement,"dg");this.__folders={};this.__controllers=[];this.__rememberedObjects=[];this.__rememberedObjectIndecesToControllers=[];this.__listening=[];a=a||{};a=m.defaults(a,{autoPlace:!0,width:o.DEFAULT_WIDTH});a=m.defaults(a,{resizable:a.autoPlace,hideable:a.autoPlace});m.isUndefined(a.load)?a.load={preset:w}:a.preset&&(a.load.preset=a.preset);m.isUndefined(a.parent)&&a.hideable&&F.push(this);a.resizable=m.isUndefined(a.parent)&&a.resizable;a.autoPlace&&m.isUndefined(a.scrollable)&&
(a.scrollable=!0);var e=u&&"true"===localStorage.getItem(document.location.href+".isLocal");Object.defineProperties(this,{parent:{get:function(){return a.parent}},scrollable:{get:function(){return a.scrollable}},autoPlace:{get:function(){return a.autoPlace}},preset:{get:function(){return d.parent?d.getRoot().preset:a.load.preset},set:function(b){d.parent?d.getRoot().preset=b:a.load.preset=b;for(b=0;b<this.__preset_select.length;b++)if(this.__preset_select[b].value==this.preset)this.__preset_select.selectedIndex=
b;d.revert()}},width:{get:function(){return a.width},set:function(b){a.width=b;C(d,b)}},name:{get:function(){return a.name},set:function(b){a.name=b;if(g)g.innerHTML=a.name}},closed:{get:function(){return a.closed},set:function(b){a.closed=b;a.closed?j.addClass(d.__ul,o.CLASS_CLOSED):j.removeClass(d.__ul,o.CLASS_CLOSED);this.onResize();if(d.__closeButton)d.__closeButton.innerHTML=b?o.TEXT_OPEN:o.TEXT_CLOSED}},load:{get:function(){return a.load}},useLocalStorage:{get:function(){return e},set:function(a){if(u){(e=
a)?j.bind(window,"unload",b):j.unbind(window,"unload",b);localStorage.setItem(document.location.href+".isLocal",a)}}}});if(m.isUndefined(a.parent)){a.closed=!1;j.addClass(this.domElement,o.CLASS_MAIN);j.makeSelectable(this.domElement,!1);if(u&&e){d.useLocalStorage=!0;var f=localStorage.getItem(document.location.href+".gui");f&&(a.load=JSON.parse(f))}this.__closeButton=document.createElement("div");this.__closeButton.innerHTML=o.TEXT_CLOSED;j.addClass(this.__closeButton,o.CLASS_CLOSE_BUTTON);this.domElement.appendChild(this.__closeButton);
j.bind(this.__closeButton,"click",function(){d.closed=!d.closed})}else{void 0===a.closed&&(a.closed=!0);var g=document.createTextNode(a.name);j.addClass(g,"controller-name");f=s(d,g);j.addClass(this.__ul,o.CLASS_CLOSED);j.addClass(f,"title");j.bind(f,"click",function(a){a.preventDefault();d.closed=!d.closed;return false});a.closed||(this.closed=!1)}a.autoPlace&&(m.isUndefined(a.parent)&&(E&&(v=document.createElement("div"),j.addClass(v,"dg"),j.addClass(v,o.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(v),
E=!1),v.appendChild(this.domElement),j.addClass(this.domElement,o.CLASS_AUTO_PLACE)),this.parent||C(d,a.width));j.bind(window,"resize",function(){d.onResize()});j.bind(this.__ul,"webkitTransitionEnd",function(){d.onResize()});j.bind(this.__ul,"transitionend",function(){d.onResize()});j.bind(this.__ul,"oTransitionEnd",function(){d.onResize()});this.onResize();a.resizable&&H(this);d.getRoot();a.parent||c()};o.toggleHide=function(){z=!z;m.each(F,function(a){a.domElement.style.zIndex=z?-999:999;a.domElement.style.opacity=
z?0:1})};o.CLASS_AUTO_PLACE="a";o.CLASS_AUTO_PLACE_CONTAINER="ac";o.CLASS_MAIN="main";o.CLASS_CONTROLLER_ROW="cr";o.CLASS_TOO_TALL="taller-than-window";o.CLASS_CLOSED="closed";o.CLASS_CLOSE_BUTTON="close-button";o.CLASS_DRAG="drag";o.DEFAULT_WIDTH=245;o.TEXT_CLOSED="Close Controls";o.TEXT_OPEN="Open Controls";j.bind(window,"keydown",function(a){"text"!==document.activeElement.type&&(72===a.which||72==a.keyCode)&&o.toggleHide()},!1);m.extend(o.prototype,{add:function(a,b){return r(this,a,b,{factoryArgs:Array.prototype.slice.call(arguments,
2)})},addColor:function(a,b){return r(this,a,b,{color:!0})},remove:function(a){this.__ul.removeChild(a.__li);this.__controllers.slice(this.__controllers.indexOf(a),1);var b=this;m.defer(function(){b.onResize()})},destroy:function(){this.autoPlace&&v.removeChild(this.domElement)},addFolder:function(a){if(void 0!==this.__folders[a])throw Error('You already have a folder in this GUI by the name "'+a+'"');var b={name:a,parent:this};b.autoPlace=this.autoPlace;this.load&&(this.load.folders&&this.load.folders[a])&&
(b.closed=this.load.folders[a].closed,b.load=this.load.folders[a]);b=new o(b);this.__folders[a]=b;a=s(this,b.domElement);j.addClass(a,"folder");return b},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var a=this.getRoot();if(a.scrollable){var b=j.getOffset(a.__ul).top,c=0;m.each(a.__ul.childNodes,function(b){a.autoPlace&&b===a.__save_row||(c+=j.getHeight(b))});window.innerHeight-b-20<c?(j.addClass(a.domElement,o.CLASS_TOO_TALL),a.__ul.style.height=window.innerHeight-
b-20+"px"):(j.removeClass(a.domElement,o.CLASS_TOO_TALL),a.__ul.style.height="auto")}a.__resize_handle&&m.defer(function(){a.__resize_handle.style.height=a.__ul.offsetHeight+"px"});a.__closeButton&&(a.__closeButton.style.width=a.width+"px")},remember:function(){m.isUndefined(x)&&(x=new q,x.domElement.innerHTML=b);if(this.parent)throw Error("You can only call remember on a top level GUI.");var a=this;m.each(Array.prototype.slice.call(arguments),function(b){a.__rememberedObjects.length==0&&G(a);a.__rememberedObjects.indexOf(b)==
-1&&a.__rememberedObjects.push(b)});this.autoPlace&&C(this,this.width)},getRoot:function(){for(var a=this;a.parent;)a=a.parent;return a},getSaveObject:function(){var a=this.load;a.closed=this.closed;0<this.__rememberedObjects.length&&(a.preset=this.preset,a.remembered||(a.remembered={}),a.remembered[this.preset]=y(this));a.folders={};m.each(this.__folders,function(b,c){a.folders[c]=b.getSaveObject()});return a},save:function(){this.load.remembered||(this.load.remembered={});this.load.remembered[this.preset]=
y(this);A(this,!1)},saveAs:function(a){this.load.remembered||(this.load.remembered={},this.load.remembered[w]=y(this,!0));this.load.remembered[a]=y(this);this.preset=a;B(this,a,!0)},revert:function(a){m.each(this.__controllers,function(b){this.getRoot().load.remembered?t(a||this.getRoot(),b):b.setValue(b.initialValue)},this);m.each(this.__folders,function(a){a.revert(a)});a||A(this.getRoot(),!1)},listen:function(a){var b=0==this.__listening.length;this.__listening.push(a);b&&D(this.__listening)}});
return o}(dat.utils.css,'<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n      \n    </div>\n    \n  </div>\n\n</div>',
".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear;border:0;position:absolute;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-x:hidden}.dg.a.has-save ul{margin-top:27px}.dg.a.has-save ul.closed{margin-top:0}.dg.a .save-row{position:fixed;top:0;z-index:1002}.dg li{-webkit-transition:height 0.1s ease-out;-o-transition:height 0.1s ease-out;-moz-transition:height 0.1s ease-out;transition:height 0.1s ease-out}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;overflow:hidden;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li > *{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:9px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2fa1d6}.dg .cr.number input[type=text]{color:#2fa1d6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2fa1d6}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n",
dat.controllers.factory=function(c,b,a,d,e,g,f){return function(h,i,l,k){var n=h[i];if(f.isArray(l)||f.isObject(l))return new c(h,i,l);if(f.isNumber(n))return f.isNumber(l)&&f.isNumber(k)?new a(h,i,l,k):new b(h,i,{min:l,max:k});if(f.isString(n))return new d(h,i);if(f.isFunction(n))return new e(h,i,"");if(f.isBoolean(n))return new g(h,i)}}(dat.controllers.OptionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.StringController=function(c,b,a){var d=
function(a,c){function f(){h.setValue(h.__input.value)}d.superclass.call(this,a,c);var h=this;this.__input=document.createElement("input");this.__input.setAttribute("type","text");b.bind(this.__input,"keyup",f);b.bind(this.__input,"change",f);b.bind(this.__input,"blur",function(){h.__onFinishChange&&h.__onFinishChange.call(h,h.getValue())});b.bind(this.__input,"keydown",function(a){13===a.keyCode&&this.blur()});this.updateDisplay();this.domElement.appendChild(this.__input)};d.superclass=c;a.extend(d.prototype,
c.prototype,{updateDisplay:function(){b.isActive(this.__input)||(this.__input.value=this.getValue());return d.superclass.prototype.updateDisplay.call(this)}});return d}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.controllers.FunctionController,dat.controllers.BooleanController,dat.utils.common),dat.controllers.Controller,dat.controllers.BooleanController,dat.controllers.FunctionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.OptionController,
dat.controllers.ColorController=function(c,b,a,d,e){function g(a,b,c,d){a.style.background="";e.each(i,function(e){a.style.cssText+="background: "+e+"linear-gradient("+b+", "+c+" 0%, "+d+" 100%); "})}function f(a){a.style.background="";a.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);";a.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";
a.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";a.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";a.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var h=function(c,i){function n(a){r(a);b.bind(window,"mousemove",r);b.bind(window,
"mouseup",q)}function q(){b.unbind(window,"mousemove",r);b.unbind(window,"mouseup",q)}function j(){var a=d(this.value);!1!==a?(p.__color.__state=a,p.setValue(p.__color.toOriginal())):this.value=p.__color.toString()}function m(){b.unbind(window,"mousemove",s);b.unbind(window,"mouseup",m)}function r(a){a.preventDefault();var c=b.getWidth(p.__saturation_field),d=b.getOffset(p.__saturation_field),e=(a.clientX-d.left+document.body.scrollLeft)/c,a=1-(a.clientY-d.top+document.body.scrollTop)/c;1<a?a=1:0>
a&&(a=0);1<e?e=1:0>e&&(e=0);p.__color.v=a;p.__color.s=e;p.setValue(p.__color.toOriginal());return!1}function s(a){a.preventDefault();var c=b.getHeight(p.__hue_field),d=b.getOffset(p.__hue_field),a=1-(a.clientY-d.top+document.body.scrollTop)/c;1<a?a=1:0>a&&(a=0);p.__color.h=360*a;p.setValue(p.__color.toOriginal());return!1}h.superclass.call(this,c,i);this.__color=new a(this.getValue());this.__temp=new a(0);var p=this;this.domElement=document.createElement("div");b.makeSelectable(this.domElement,!1);
this.__selector=document.createElement("div");this.__selector.className="selector";this.__saturation_field=document.createElement("div");this.__saturation_field.className="saturation-field";this.__field_knob=document.createElement("div");this.__field_knob.className="field-knob";this.__field_knob_border="2px solid ";this.__hue_knob=document.createElement("div");this.__hue_knob.className="hue-knob";this.__hue_field=document.createElement("div");this.__hue_field.className="hue-field";this.__input=document.createElement("input");
this.__input.type="text";this.__input_textShadow="0 1px 1px ";b.bind(this.__input,"keydown",function(a){13===a.keyCode&&j.call(this)});b.bind(this.__input,"blur",j);b.bind(this.__selector,"mousedown",function(){b.addClass(this,"drag").bind(window,"mouseup",function(){b.removeClass(p.__selector,"drag")})});var t=document.createElement("div");e.extend(this.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"});e.extend(this.__field_knob.style,
{position:"absolute",width:"12px",height:"12px",border:this.__field_knob_border+(0.5>this.__color.v?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1});e.extend(this.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1});e.extend(this.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"});e.extend(t.style,{width:"100%",height:"100%",
background:"none"});g(t,"top","rgba(0,0,0,0)","#000");e.extend(this.__hue_field.style,{width:"15px",height:"100px",display:"inline-block",border:"1px solid #555",cursor:"ns-resize"});f(this.__hue_field);e.extend(this.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:this.__input_textShadow+"rgba(0,0,0,0.7)"});b.bind(this.__saturation_field,"mousedown",n);b.bind(this.__field_knob,"mousedown",n);b.bind(this.__hue_field,"mousedown",function(a){s(a);b.bind(window,
"mousemove",s);b.bind(window,"mouseup",m)});this.__saturation_field.appendChild(t);this.__selector.appendChild(this.__field_knob);this.__selector.appendChild(this.__saturation_field);this.__selector.appendChild(this.__hue_field);this.__hue_field.appendChild(this.__hue_knob);this.domElement.appendChild(this.__input);this.domElement.appendChild(this.__selector);this.updateDisplay()};h.superclass=c;e.extend(h.prototype,c.prototype,{updateDisplay:function(){var b=d(this.getValue());if(!1!==b){var c=!1;
e.each(a.COMPONENTS,function(a){if(!e.isUndefined(b[a])&&!e.isUndefined(this.__color.__state[a])&&b[a]!==this.__color.__state[a])return c=!0,{}},this);c&&e.extend(this.__color.__state,b)}e.extend(this.__temp.__state,this.__color.__state);this.__temp.a=1;var f=0.5>this.__color.v||0.5<this.__color.s?255:0,h=255-f;e.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toString(),border:this.__field_knob_border+"rgb("+
f+","+f+","+f+")"});this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px";this.__temp.s=1;this.__temp.v=1;g(this.__saturation_field,"left","#fff",this.__temp.toString());e.extend(this.__input.style,{backgroundColor:this.__input.value=this.__color.toString(),color:"rgb("+f+","+f+","+f+")",textShadow:this.__input_textShadow+"rgba("+h+","+h+","+h+",.7)"})}});var i=["-moz-","-o-","-webkit-","-ms-",""];return h}(dat.controllers.Controller,dat.dom.dom,dat.color.Color=function(c,b,a,d){function e(a,
b,c){Object.defineProperty(a,b,{get:function(){if("RGB"===this.__state.space)return this.__state[b];f(this,b,c);return this.__state[b]},set:function(a){"RGB"!==this.__state.space&&(f(this,b,c),this.__state.space="RGB");this.__state[b]=a}})}function g(a,b){Object.defineProperty(a,b,{get:function(){if("HSV"===this.__state.space)return this.__state[b];h(this);return this.__state[b]},set:function(a){"HSV"!==this.__state.space&&(h(this),this.__state.space="HSV");this.__state[b]=a}})}function f(a,c,e){if("HEX"===
a.__state.space)a.__state[c]=b.component_from_hex(a.__state.hex,e);else if("HSV"===a.__state.space)d.extend(a.__state,b.hsv_to_rgb(a.__state.h,a.__state.s,a.__state.v));else throw"Corrupted color state";}function h(a){var c=b.rgb_to_hsv(a.r,a.g,a.b);d.extend(a.__state,{s:c.s,v:c.v});d.isNaN(c.h)?d.isUndefined(a.__state.h)&&(a.__state.h=0):a.__state.h=c.h}var i=function(){this.__state=c.apply(this,arguments);if(!1===this.__state)throw"Failed to interpret color arguments";this.__state.a=this.__state.a||
1};i.COMPONENTS="r g b h s v hex a".split(" ");d.extend(i.prototype,{toString:function(){return a(this)},toOriginal:function(){return this.__state.conversion.write(this)}});e(i.prototype,"r",2);e(i.prototype,"g",1);e(i.prototype,"b",0);g(i.prototype,"h");g(i.prototype,"s");g(i.prototype,"v");Object.defineProperty(i.prototype,"a",{get:function(){return this.__state.a},set:function(a){this.__state.a=a}});Object.defineProperty(i.prototype,"hex",{get:function(){"HEX"!==!this.__state.space&&(this.__state.hex=
b.rgb_to_hex(this.r,this.g,this.b));return this.__state.hex},set:function(a){this.__state.space="HEX";this.__state.hex=a}});return i}(dat.color.interpret,dat.color.math=function(){var c;return{hsv_to_rgb:function(b,a,c){var e=b/60-Math.floor(b/60),g=c*(1-a),f=c*(1-e*a),a=c*(1-(1-e)*a),b=[[c,a,g],[f,c,g],[g,c,a],[g,f,c],[a,g,c],[c,g,f]][Math.floor(b/60)%6];return{r:255*b[0],g:255*b[1],b:255*b[2]}},rgb_to_hsv:function(b,a,c){var e=Math.min(b,a,c),g=Math.max(b,a,c),e=g-e;if(0==g)return{h:NaN,s:0,v:0};
b=(b==g?(a-c)/e:a==g?2+(c-b)/e:4+(b-a)/e)/6;0>b&&(b+=1);return{h:360*b,s:e/g,v:g/255}},rgb_to_hex:function(b,a,c){b=this.hex_with_component(0,2,b);b=this.hex_with_component(b,1,a);return b=this.hex_with_component(b,0,c)},component_from_hex:function(b,a){return b>>8*a&255},hex_with_component:function(b,a,d){return d<<(c=8*a)|b&~(255<<c)}}}(),dat.color.toString,dat.utils.common),dat.color.interpret,dat.utils.common),dat.utils.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||
window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(c){window.setTimeout(c,1E3/60)}}(),dat.dom.CenteredDiv=function(c,b){var a=function(){this.backgroundElement=document.createElement("div");b.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear"});c.makeFullscreen(this.backgroundElement);this.backgroundElement.style.position="fixed";this.domElement=
document.createElement("div");b.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear"});document.body.appendChild(this.backgroundElement);document.body.appendChild(this.domElement);var a=this;c.bind(this.backgroundElement,"click",function(){a.hide()})};a.prototype.show=function(){var a=this;this.backgroundElement.style.display="block";this.domElement.style.display="block";this.domElement.style.opacity=
0;this.domElement.style.webkitTransform="scale(1.1)";this.layout();b.defer(function(){a.backgroundElement.style.opacity=1;a.domElement.style.opacity=1;a.domElement.style.webkitTransform="scale(1)"})};a.prototype.hide=function(){var a=this,b=function(){a.domElement.style.display="none";a.backgroundElement.style.display="none";c.unbind(a.domElement,"webkitTransitionEnd",b);c.unbind(a.domElement,"transitionend",b);c.unbind(a.domElement,"oTransitionEnd",b)};c.bind(this.domElement,"webkitTransitionEnd",
b);c.bind(this.domElement,"transitionend",b);c.bind(this.domElement,"oTransitionEnd",b);this.backgroundElement.style.opacity=0;this.domElement.style.opacity=0;this.domElement.style.webkitTransform="scale(1.1)"};a.prototype.layout=function(){this.domElement.style.left=window.innerWidth/2-c.getWidth(this.domElement)/2+"px";this.domElement.style.top=window.innerHeight/2-c.getHeight(this.domElement)/2+"px"};return a}(dat.dom.dom,dat.utils.common),dat.dom.dom,dat.utils.common);
