<!doctype html><title>augmented gesture examples</title>
<script src="../../vendor/requestanimationframe.js"></script>

<script src="../../vendor/imageprocessing.js"></script>

<script src="../../vendor/dat.gui/dat.gui.js"></script>

<script src="../../src/augmentedgesture.js"></script>
<script src="../../src/gesturerecognition.js"></script>

<script src="../../vendor/Stats.js"></script>

<script src="tquery-bundle.js"></script>

<script src="ball.js"></script>

<!--<script src="../../build/augmentedgesture.js"></script>
-->
<body><script>
	// create a AugmentedGesture
	var aGesture	= new AugmentedGesture().enableDatGui().start().domElementThumbnail();
	// create a tQuery.World
	var world	= tQuery.createWorld().boilerplate().start();
	world.renderer().domElement.style.zIndex	= 10000;
	world.removeCameraControls();

	// some constants for players
	var players	= { 'right' : {}, 'left': {} };	
	var racketW	= 0.25*0.5;
	var racketH	= 1.00*0.5;
	var racketRangeY= 2;
	// init each player
	Object.keys(players).forEach(function(playerId){
		var player	= players[playerId];

		// create tQuery.Object3D for a racket
		var object3d	= tQuery.createCube().addTo(world).scale(0.25,1,0.5).scaleBy(0.5);
		player.object3d	= object3d;
		object3d.translateX(1.3 * (playerId === "right" ? +1 : -1));
		// add a pointer for this player
		var pointerId	= playerId;
		var pointerOpts	= new AugmentedGesture.OptionPointer();
		aGesture.addPointer(pointerId, pointerOpts);
		// tune the pointer for each player
		if( playerId === 'right' ){
			pointerOpts.pointer.crossColor	= {r:  255, g:  50, b:   50};
			pointerOpts.colorFilter.r	= {min: 160, max: 255};
			pointerOpts.colorFilter.g	= {min:   0, max: 255};
			pointerOpts.colorFilter.b	= {min:   0, max: 100};			
		}else{
			pointerOpts.pointer.crossColor	= {r:   50, g: 255, b:   50};
			pointerOpts.colorFilter.r	= {min:   0, max: 145};
			pointerOpts.colorFilter.g	= {min: 165, max: 255};
			pointerOpts.colorFilter.b	= {min:  60, max: 200};						
		}
		// bind aGesture 'mousemove' and update object3d position with it
		aGesture.bind("mousemove."+pointerId, function(e){
			var x	= e.x / (320/4);
			var y	= e.y / (240/4);
			
			object3d.get(0).position.y	= -(-racketRangeY/2 + y*racketRangeY);
		});

	})

	// constant for the field
	var fieldW	= 2.7;
	var fieldH	= 1.8;
	// constant for the ball
	var ballRadius	= 1/5;
	var angle	= Math.random()*Math.PI*2;
	var ballVelX	= Math.cos(angle)*0.03;
	var ballVelY	= Math.sin(angle)*0.03;
	// create a tQuery.Object3d for the ball
	var ballObject3d= tQuery.createSphere().addTo(world).scaleBy(ballRadius);
	world.loop().hook(function(){
		// get ball position
		var position	= ballObject3d.get(0).position;
		// update position
		position.x	+= ballVelX;	
		position.y	+= ballVelY;
		// bounce the ball if it reach the border
		if( position.x < -fieldW/2 )	ballVelX	*= -1;
		if( position.x > +fieldW/2 )	ballVelX	*= -1;
		if( position.y < -fieldH/2 )	ballVelY	*= -1;
		if( position.y > +fieldH/2 )	ballVelY	*= -1;
		// get the boundaries
		position.x	= Math.max(position.x, -fieldW/2);
		position.x	= Math.min(position.x, +fieldW/2);
		position.y	= Math.max(position.y, -fieldH/2);
		position.y	= Math.min(position.y, +fieldH/2);
		// check collision with each player racket
		['right', 'left'].forEach(function(playerId){
			var object3d	= players[playerId].object3d;
			var racketX	= object3d.get(0).position.x;
			var racketY	= object3d.get(0).position.y;
			var mayHitLeft	= (position.x+ballRadius/2) >= (racketX-racketW/2);
			var mayHitRight	= (position.x-ballRadius/2) <= (racketX+racketW/2);
			var mayHitTop	= (position.y+ballRadius/2) >= (racketY-racketH/2);
			var mayHitBottom= (position.y-ballRadius/2) <= (racketY+racketH/2);
			if( mayHitLeft && mayHitRight && mayHitTop && mayHitBottom ){
				ballVelX	*= -1;
				var deltaX	= racketW/2 + ballRadius/2;
				position.x	= racketX + (playerId === 'right'? -deltaX : +deltaX);
			}		
		});
	});
</script></body>